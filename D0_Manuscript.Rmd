---
title: "" # needs to be empty since it is specified in Title.Rmd
author: ""
date: ""
documentclass: "report"
classoption: twoside
fontsize: 10pt
glossary: true
output: 
  pdf_document:
    keep_tex: true
    includes:
      in_header: MSc_Style.tex
subparagraph: true # this is needed as a workaround to get titlesec to work
graphics: yes
geometry: "left= 2cm,right = 2cm, bottom = 1.5cm, top = 2cm"
---

```{r setup, include=FALSE}
####--------------- PACKAGES ----
install.load.package <- function(x) {
  if (!require(x, character.only = TRUE))
    install.packages(x, repos='http://cran.us.r-project.org')
  require(x, character.only = TRUE)
}
package_vec <- c("knitr", "raster", "pracma", "gameofthrones", "ggplot2", "cowplot", 
                 "grid", "gridExtra", "xlsx", "kableExtra")
sapply(package_vec, install.load.package)
oldSource <- knit_hooks$get("source")
knit_hooks$set(source = function(x, options) {
  x <- oldSource(x, options)
  x <- ifelse(!is.null(options$ref), paste0("\\label{", options$ref,"}", x), x)
  ifelse(!is.null(options$codecap), paste0("\\captionof{chunk}{", options$codecap,"}", x), x)
})
knitr::opts_chunk$set(echo = TRUE, message = FALSE, warning = FALSE, cache = TRUE, cache.lazy=FALSE, tidy.opts=list(width.cutoff=80),tidy=TRUE, fig.height=5.5)
options(digits=4, width = 90)

source("Y - Codes/S0b_Directories.R") # setting directories
source("Y - Codes/S0c_Functions.R") # Loading miscellaneous functions

SR_Titles <- list("NDVI", "Air Temperature", "Soil Moisture (0-7cm)", "Soil Moisture (7-28cm)", "Soil Moisture (28-100cm)", "Soil Moisture (100-255cm)")
setwd(Dir.KrigCov)
Elevation <- raster(list.files()[2], varname = "Elevation")
ElevationF <- raster(list.files()[1], varname = "Elevation")
```

```{r StudRegFun, echo = FALSE}
col.NDVI <- rev(terrain.colors(100))
col.qsoil <- colorRampPalette(c("yellow", "burlywood", "beige", "turquoise", "deepskyblue"))(100)
col.tair <- colorRampPalette(c("blue","turquoise", "yellow", "orange", "red"))(100)
SR_cols <- list(col.NDVI, col.tair, col.qsoil, col.qsoil, col.qsoil, col.qsoil)
SRData <- function(Region){
  ### LOADING DATA ---- 
  setwd(Dir.Gimms.Monthly)
  SR_NDVI <- mean(brick(list.files()[grep(pattern = Region, list.files())]), na.rm = TRUE)
  setwd(Dir.ERA.Monthly)
  SR_Qsoil1 <- mean(brick(list.files()[grep(pattern = paste("Qsoil1_mean_", Region, sep=""), list.files())]), na.rm = TRUE)
  SR_Qsoil2 <- mean(brick(list.files()[grep(pattern = paste("Qsoil2_mean_", Region, sep=""), list.files())]), na.rm = TRUE)
  SR_Qsoil3 <- mean(brick(list.files()[grep(pattern = paste("Qsoil3_mean_", Region, sep=""), list.files())]), na.rm = TRUE)
  SR_Qsoil4 <- mean(brick(list.files()[grep(pattern = paste("Qsoil4_mean_", Region, sep=""), list.files())]), na.rm = TRUE)
  SR_Tair <- mean(brick(list.files()[grep(pattern = paste("Tair_mean_", Region, sep=""), list.files())]), na.rm = TRUE)
  ### FIXING VALUES ---- 
  QsoilStack <- stack(SR_Qsoil1, SR_Qsoil2, SR_Qsoil3, SR_Qsoil4)
  SR_Qsoil1[1:2] <- c(min(QsoilStack, na.rm = TRUE)@data@min, max(QsoilStack, na.rm = TRUE)@data@max)
  SR_Qsoil2[1:2] <- c(min(QsoilStack, na.rm = TRUE)@data@min, max(QsoilStack, na.rm = TRUE)@data@max)
  SR_Qsoil3[1:2] <- c(min(QsoilStack, na.rm = TRUE)@data@min, max(QsoilStack, na.rm = TRUE)@data@max)
  SR_Qsoil4[1:2] <- c(min(QsoilStack, na.rm = TRUE)@data@min, max(QsoilStack, na.rm = TRUE)@data@max)
  ### PLOTTING ---- 
  Plot_Stack <- stack(SR_NDVI, SR_Tair, SR_Qsoil1, SR_Qsoil2, SR_Qsoil3, SR_Qsoil4)
  par(mfrow = c(3,2), mai = c(1, 0, 0.5, 0))
  for(i in 1:length(SR_cols)){
    if(i == 1){
      plot(Plot_Stack[[i]], colNA = "black", main = paste("Mean", SR_Titles[[i]], "1982 - 2015"), cex.main = 3, legend.width = 3, legend.shrink=1, axis.args=list(cex.axis=2.5), cex.axis = 2,
     col =SR_cols[[i]], axes = TRUE, legend = FALSE)
    } else{
      plot(Plot_Stack[[i]], colNA = "black", main = paste("Mean", SR_Titles[[i]], "1981 - 2015"), cex.main = 3, legend.width = 3, legend.shrink=1, axis.args=list(cex.axis=2.5), cex.axis = 2,
     col =SR_cols[[i]], axes = TRUE, legend = FALSE)
    } 
    if(i <= 2){
    plot(Plot_Stack[[i]], legend.only=TRUE, smallplot=c(0.0,.93,.12,.16), horizontal = TRUE, axis.args=list(cex.axis=2.5), col = SR_cols[[i]])
    }
    if(i == 2){
      par(mai = c(.5, 0, 0.5, 0))
    }
    }
  return(SR_Qsoil4)
}
```

```{r SRTRY, echo = FALSE}
col.tair <- colorRampPalette(c("blue","turquoise", "yellow", "orange", "red"))(100)
TRYRegions <- function(Region){
### LOADING DATA ----
setwd(Dir.Gimms.Monthly)
Back_ras <- mean(brick(list.files()[1:7]), na.rm = TRUE) # background raster for later plots
values(Back_ras)[which(!is.na(values(Back_ras)))] <- 8888
Titles <- c("Height", "Nitrogen Content")
### PLOTTING ----
par(mfrow = c(2,2), mai = c(1, 0, 0.5, 0))
  setwd(Dir.TRY)
  Plot_ras <- brick(list.files(Dir.TRY)[grep(pattern = Region, list.files(Dir.TRY))][1]) # Raw file
  Plot1_ras <- brick(list.files(Dir.TRY)[grep(pattern = Region, list.files(Dir.TRY))][2]) # Distrib file
  Back_ras1 <- crop(Back_ras, extent(Plot_ras))
  Back_ras1 <- stack(Back_ras1, Back_ras1)
  names(Back_ras1) <- c("Height", "Nitrogen")
  for(i in 1:2){
  plot(Back_ras1[[i]], colNA = "black", main = Titles[i], cex.main = 3, legend = FALSE, col = "grey")
  plot(Plot_ras[[i]], add = TRUE, legend = FALSE, col = col.tair, axes = TRUE)
  plot(Plot_ras[[i]], legend.only=TRUE, smallplot=c(0,.95,.075,.115), horizontal = TRUE, axis.args=list(cex.axis=2.5), col = col.tair)
  }
  for(i in 1:2){
  plot(Back_ras1[[i]], colNA = "black", main = Titles[i], cex.main = 3, legend = FALSE, col = "grey")
  plot(Plot1_ras[[i]], add = TRUE, legend = FALSE, col = col.tair, axes = TRUE)
  plot(Plot1_ras[[i]], legend.only=TRUE, smallplot=c(0,.95,.075,.115), horizontal = TRUE, axis.args=list(cex.axis=2.5), col = col.tair)
  }
}
```

```{r ModelRes, echo = FALSE}
ModelRes <- function(Region, SoilLayer){
  col.signeg <- got(n = 100, alpha = 1, begin = 0, end = 1, direction = -1, option = "targaryen2")
col.sigpos <- got(n = 100, alpha = 1, begin = 0, end = 1, direction = -1, option = "tyrell")
col.nonsig <- colorRampPalette(c("grey"))(1)
col.lags <- got(n = 12, alpha = 1, begin = 0, end = 1, direction = 1, option = "daenerys")
smallplotxpos <- c(0.5,.93,.03,.065) # where to put colour scales
smallplotxneg <- c(0.05,.5,.03,.065) # where to put colour scales
  Files <- list.files(Dir.Memory)[grep(list.files(Dir.Memory), pattern = Region)]
  Files <- Files[grep(Files, pattern = ".nc")]
  plot_ras <- brick(paste(Dir.Memory, Files[SoilLayer], sep="/"))
  plot(plot_ras[[1]], col = col.lags, colNA = "black", legend=FALSE, axes=FALSE)
  plot(plot_ras[[1]], legend.only=TRUE, col=col.lags, smallplot=c(.05, .93, .03, .065), horizontal = TRUE, axis.args=list(cex.axis=2.5))
  if(SoilLayer == 1){
    RasLay <- 4:6
  }else{
    RasLay <- c(5)
  }
  for(Plot in RasLay){
    Neg_ras <- plot_ras[[Plot]]
    Neg_ras[which(values(Neg_ras) >= 0)] <- NA
    Pos_ras <- plot_ras[[Plot]]
    Pos_ras[which(values(Pos_ras) < 0)] <- NA
    plot(Neg_ras, col=col.signeg, colNA = "black", legend=FALSE, axes=FALSE)
    if(Plot == 4 & Region == "Iberian Region"){
      plot(Pos_ras, col=col.sigpos, colNA = "black", legend=FALSE, axes=FALSE, add=TRUE)
    }else{
      plot(Pos_ras, col=col.sigpos, legend=FALSE, axes=FALSE, add=TRUE) 
    }
    plot(Neg_ras, legend.only=TRUE, col=col.signeg, colNA = "black", smallplot=smallplotxneg, horizontal = TRUE, axis.args=list(cex.axis=2.5))
    if(Plot == 4 & Region == "Iberian Region"){
      plot(Pos_ras, legend.only=TRUE, col=col.sigpos, smallplot=c(.05, .93, .03, .065), horizontal = TRUE, axis.args=list(cex.axis=2.5))
    }else{
      plot(Pos_ras, legend.only=TRUE, col=col.sigpos, smallplot=smallplotxpos, horizontal = TRUE, axis.args=list(cex.axis=2.5))
    }
  }
}
```

```{r VarParRes, echo = FALSE}
VarParRes <- function(Region, SoilLayer, Plot = 1, Legend = TRUE){
  col.varpar1 <- got(n = 100, alpha = 1, begin = 0, end = 1, direction = -1, option = "wildfire")
col.varpar2 <- got(n = 100, alpha = 1, begin = 0, end = 1, direction = -1, option = "targaryen")
col.varpar3 <- got(n = 100, alpha = 1, begin = 0, end = 1, direction = -1, option = "jon_snow")
col.list <- list(col.varpar1, col.varpar2, col.varpar3) 
  Files <- list.files(Dir.Memory)[grep(list.files(Dir.Memory), pattern = Region)]
  Files <- Files[grep(Files, pattern = ".nc")]
  Alter_ras <- brick(paste(Dir.Memory, Files[SoilLayer], sep="/"))[[7:10]]
  Alter_ras[2] <- 0
  values(Alter_ras)[which(values(Alter_ras) < 0)] <- 0
  cells <- order(values(Alter_ras[[1]]))
  plot_df <- data.frame(Data =NA, 
                        Cell =NA,
                        Variance =NA)
  Idents <- c(NA, "t-1", "Shared", "Qsoil")
  for(i in 1:4){
    Alter_ras[[i]][which(values(Alter_ras[[i]])>quantile(values(Alter_ras[[1]]),.95, na.rm=TRUE))] <- quantile(values(Alter_ras[[1]]),.95, na.rm=TRUE)
    if(i > 1){
      plot_df1 <- data.frame(Data = values(Alter_ras[[i]])[cells],
                             Cell = 1:length(cells), 
                             Variance = rep(Idents[i], length(cells)))
      plot_df <- rbind(plot_df, plot_df1)
    }
  }
  plot_df <- na.omit(plot_df)
  if(Legend == TRUE){
   p <- ggplot(data = plot_df, aes(y = Data, x = Cell, fill = Variance)) + geom_bar(stat = "identity") + ylim(0, quantile(values(Alter_ras[[1]]),.95, na.rm=TRUE)) + theme_bw(base_size= 35) + xlab("Raster Cells") + ylab("Variance") + scale_fill_manual(values=c(col.list[[3]][1], col.list[[2]][50], col.list[[1]][30])) 
  }else{
   p <- ggplot(data = plot_df, aes(y = Data, x = Cell, fill = Variance)) + geom_bar(stat = "identity") + ylim(0, quantile(values(Alter_ras[[1]]),.95, na.rm=TRUE)) + theme_bw(base_size= 35) + xlab("Raster Cells") + ylab("Variance") + scale_fill_manual(values=c(col.list[[3]][1], col.list[[2]][50], col.list[[1]][30])) + theme(legend.position = "none")
  }
  if(Plot == 1){
    return(p)
  }else{
   for(i in 2:4){
    col.varpar <- col.list[[i-1]]
    plot(Alter_ras[[i]], col=col.varpar, colNA = "black", legend=FALSE, axes=FALSE)
    plot(Alter_ras[[i]], legend.only=TRUE, col=col.varpar, smallplot=c(.05, .93, .03, .065), horizontal = TRUE, axis.args=list(cex.axis=2.5))
  } 
  }
}
```

```{r SoilLayersRes, echo = FALSE}
SoilLayersRes <- function(Region){
  col.signeg <- got(n = 100, alpha = 1, begin = 0, end = 1, direction = -1, option = "targaryen2")
col.sigpos <- got(n = 100, alpha = 1, begin = 0, end = 1, direction = -1, option = "tyrell")
col.nonsig <- colorRampPalette(c("grey"))(1)
smallplotxpos <- c(0.5,.93,.03,.065) # where to put colour scales
smallplotxneg <- c(0.05,.5,.03,.065) # where to put colour scales
  Dir.Reg <- paste(Dir.Memory, "/", Region, "-1981_2015", sep="")
  Files <- list.files(Dir.Reg)[grep(list.files(Dir.Reg), pattern = ".nc")]
  SoilLayer <- 1
  Alter_ras <- brick(paste(Dir.Reg, Files[SoilLayer], sep="/"))[[3]]
  for(SoilLayer in 2:4){
    Add_ras <- brick(paste(Dir.Reg, Files[SoilLayer], sep="/"))[[3]]
    Alter_ras <- stack(Alter_ras, Add_ras)
  }
  for(Plot in 1:4){
    Neg_ras <- Alter_ras[[Plot]]
    Neg_ras[which(values(Neg_ras) >= 0)] <- NA
    Pos_ras <- Alter_ras[[Plot]]
    Pos_ras[which(values(Pos_ras) < 0)] <- NA
    plot(Neg_ras, col=col.signeg, colNA = "black", legend=FALSE, axes=FALSE)
    plot(Pos_ras, col=col.sigpos, legend=FALSE, axes=FALSE, add=TRUE) 
    plot(Neg_ras, legend.only=TRUE, col=col.signeg, colNA = "black", smallplot=smallplotxneg, horizontal = TRUE, axis.args=list(cex.axis=2.5))
    plot(Pos_ras, legend.only=TRUE, col=col.sigpos, smallplot=smallplotxpos, horizontal = TRUE, axis.args=list(cex.axis=2.5))
  }
}
```

```{r PatCausRes, echo = FALSE}
PatcausRes <- function(SoilLayer = 1, X, Y){
  Regions <- c("Iberian Region", "Caatinga", "Australia")
  Idents <- c("NDVI", "ENDVI", "Qsoil", "EQsoil", "Tair", "ETair", "Memory")
  Labs <- c("NDVI [t-1] Coefficients", "Mean NDVI ", paste("Qsoil", SoilLayer, " Coefficients", sep=""), paste("Mean  Qsoil", SoilLayer, sep=""), "Tair Coefficients", "Mean Tair", paste("Qsoil", SoilLayer, " Memory Lags", sep=""))
  # data
  plot_df <- data.frame(X = NA, Y = NA, Region = NA)
  for(i in 1:length(Regions)){
    Region <- Regions[i]
    Dir.Reg <- paste(Dir.Memory, "/", Region, "-1981_2015", sep="")
    Files <- list.files(Dir.Reg)[grep(list.files(Dir.Reg), pattern = ".nc")]
    Alter_ras <- brick(paste(Dir.Reg, Files[SoilLayer], sep="/"))
    Files <- list.files(Dir.ERA.Monthly)[grep(list.files(Dir.ERA.Monthly),
                                              pattern = Region)]
    Files <- Files[grep(Files, pattern = ".nc")]
    EQsoil <- Files[grep(Files, pattern = "Qsoil")]
    EQsoil <- brick(paste(Dir.ERA.Monthly, EQsoil[SoilLayer], sep="/"))
    EQsoil <- values(mean(EQsoil))
    ETair <- Files[grep(Files, pattern = "Tair")]
    ETair <- brick(paste(Dir.ERA.Monthly, ETair, sep="/"))
    ETair <- values(mean(ETair))
    ENDVI <- list.files(Dir.Gimms.Monthly)[grep(list.files(Dir.Gimms.Monthly),
                                                pattern =Region)]
    ENDVI <- brick(paste(Dir.Gimms.Monthly, ENDVI, sep="/"))
    ENDVI <- values(mean(ENDVI))
    values <- list(values(Alter_ras[[2]]), ENDVI,
                   values(Alter_ras[[3]]), EQsoil,
                   values(Alter_ras[[4]]), ETair,
                   values(Alter_ras[[1]])
                   )
    plot_df1 <- data.frame(X = values[[which(Idents == X)]],
                          Y = values[[which(Idents == Y)]],
                          Region = rep(Region, length(values[[which(Idents == X)]])))
    plot_df1 <- na.omit(plot_df1)
    plot_df <- rbind(plot_df, plot_df1)
  QsoilTitle <- c("(0-7cm)", "(7-28cm)", "(28-100cm)", "(100-255cm)")
  }
  plot_df <- na.omit(plot_df)
  # plotting
  p <- ggplot(plot_df, aes(x = X, y = Y, col = Region)) + 
    geom_point(shape = ".", alpha = 0.4, size = 0.5) + 
  theme_bw(base_size = 35) + ylab(Labs[which(Idents == Y)]) + xlab(Labs[which(Idents == X)]) +
  stat_smooth(method = "lm",level = 0.95)+
  geom_hline(yintercept = 0, linetype="dotted") + 
    scale_color_manual(values=got(n = length(Regions), alpha = 1, direction = -1, option = "margaery"))
  if(X == "Memory"){
   p <- ggplot(plot_df, aes(x = as.factor(X), y = Y, col = Region)) + geom_boxplot() + theme_bw(base_size = 35) + ylab(Labs[which(Idents == Y)]) + xlab(Labs[which(Idents == X)]) + 
  geom_hline(yintercept = 0, linetype="dotted") + 
    scale_color_manual(values=got(n = length(Regions), alpha = 1, direction = -1, option = "margaery")) + 
     stat_smooth(method = "lm",level = 0.95, aes(group=plot_df$Region))
  }
  if(Y == "Memory"){
   p <- ggplot(plot_df, aes(x = as.factor(Y), y = X, col = Region)) + geom_boxplot() + theme_bw(base_size = 35) + xlab(Labs[which(Idents == Y)]) + ylab(Labs[which(Idents == X)]) + coord_flip() +
  geom_hline(yintercept = 0, linetype="dotted") + 
    scale_color_manual(values=got(n = length(Regions), alpha = 1, direction = -1, option = "margaery")) + 
       stat_smooth(method = "lm",level = 0.95, aes(group=plot_df$Region))
  }
  print(p)
  # Regressions
  Output <- as.list(rep(NA, 4*length(Regions)))
  pos <- 1
  for(i in 1:length(Regions)){
    Output[[pos]] <- summary(lm(Y ~ X, data = plot_df[which(plot_df$Region == Regions[i]),]))[["coefficients"]][1,1]
    pos <- pos+1
    Output[[pos]] <- summary(lm(Y ~ X, data = plot_df[which(plot_df$Region == Regions[i]),]))[["coefficients"]][1,4]
    pos <- pos+1
    Output[[pos]] <- summary(lm(Y ~ X, data = plot_df[which(plot_df$Region == Regions[i]),]))[["coefficients"]][2,1]
    pos <- pos+1
    Output[[pos]] <- summary(lm(Y ~ X, data = plot_df[which(plot_df$Region == Regions[i]),]))[["coefficients"]][2,4]
    pos <- pos+1
  }
  return(Output)
}
```

```{r Patcaustab, echo = FALSE}
PatCauseTab <- function(ModelCoeffs, SoilLayer = 1, X, Y){ # using Outputs of PatcauseRes for ModelCoeffs argument
  tabout <- data.frame(Column = ModelCoeffs[1:2])
  starts <- seq(1,length(ModelCoeffs), by = 2)
for(i in 2:(length(ModelCoeffs)/2)){
  tabout <- cbind(tabout, ModelCoeffs[starts[i]:(starts[i]+1)])
}
Idents <- c("NDVI", "ENDVI", "Qsoil", "EQsoil", "Tair", "ETair", "Memory")
Labs <- c("$NDVI_{[t-1]}$ Coefficients", "Mean NDVI ", paste("Qsoil", SoilLayer, " Coefficients", sep=""), paste("Mean  Qsoil", SoilLayer, sep=""), "Tair Coefficients", "Mean Tair", paste("Qsoil", SoilLayer, " Memory Lags", sep=""))
X <- Labs[which(Idents == X)]
Y <- Labs[which(Idents == Y)]
colnames(tabout) <- rep(c("$I$", "$S$"), 3)
rownames(tabout) <- c("Value", "$p_{Value}$")
Short <- paste("Vegetation Memory Sensitivity (",X," and ", Y,")", sep="")
Long <- paste("Coefficients of linear regressions of vegetation sensitivity. The intercept is marked as $I$, the slope of the regression as $S$. 
              Established via \\ref{rPatcaustab}.", sep="")
kab <- kable(tabout, 
            booktabs = TRUE,
            caption = paste("\\textbf{",Short, " -} ",Long, sep=""),
            caption.short = Short,
            escape = FALSE,
            format = 'latex')
kab <- add_header_above(kable_input = kab, header = c(" " = 1, "Iberian Region" = 2, "Caatinga" = 2, "Australia" = 2), bold = TRUE, align = 'c')
kab <- kable_styling(kab, latex_options = c("hold_position"))
print(kab)
}
```

```{r TRYRes, echo = FALSE}
Tryres <- function(Region, SoilLayer, Variable){
  Dir.Reg <- paste(Dir.Memory, "/", Region, "-1981_2015", sep="")
  Variable_vec <- c("t-1", "Qsoil", "Tair")
  LocVar <- which(Variable_vec == Variable) + 1
  TryFiles <-  list.files(Dir.TRY)[grep(list.files(Dir.TRY), pattern = Region)]
  TryRaw <- brick(paste(Dir.TRY, TryFiles[1], sep="/"))
  values(TryRaw)[which(values(TryRaw) > quantile(values(TryRaw), .99, na.rm = TRUE))] <- NA
  TryDis <- brick(paste(Dir.TRY, TryFiles[2], sep="/"))
  Files <- list.files(Dir.Reg)[grep(list.files(Dir.Reg), pattern = ".nc")]
  Alter_ras <- brick(paste(Dir.Reg, Files[SoilLayer], sep="/"))[[LocVar]]
  Memory_ras <- brick(paste(Dir.Reg, Files[SoilLayer], sep="/"))[[1]]
  data_df <- data.frame(Height = c(values(TryRaw[[1]]), values(TryDis[[1]])), 
                     Nitrogen = c(values(TryRaw[[2]]), values(TryDis[[2]])),
                     Qsoil = c(values(Alter_ras), values(Alter_ras)),
                     Memory = c(values(Memory_ras), values(Memory_ras)),
                     TRY = c(rep("Raw", length(values(Alter_ras))), rep("Mapped", length(values(Alter_ras)))))

  VarTitle <- c("NDVI [t-1] Coefficients", "Qsoil", "Air Temperature Coefficients")[(LocVar-1)]
  if(LocVar == 3){
    VarTitle <- c("Soil Moisture (0-7cm) Coefficients", "Soil Moisture (7-28cm) Coefficients", "Soil Moisture (28-100cm) Coefficients", "Soil Moisture (100-255cm) Coefficients")[SoilLayer]
  }
  if(Variable != "Qsoil"){
   Output <- as.list(rep(NA, 16)) 
  }else{
   Output <- as.list(rep(NA, 32)) 
  }
p1 <- ggplot(data_df, aes(x = Height, y = Qsoil, col = TRY)) +
  geom_point(shape = ".", alpha = 0.5, size = 3.5) + theme_bw(base_size = 35) +  xlab("Vegetative Height") + ylab(VarTitle) + geom_hline(yintercept = 0, linetype="dotted") + stat_smooth(method = "lm") + scale_color_manual(values=c("lightgreen", "black"))
print(p1)
if(length(which(!is.na(data_df$Height[which(data_df$TRY == "Raw")]))) < 2){
  Output[[1]] <- NA
  Output[[2]] <- NA
  Output[[3]] <- NA
  Output[[4]] <- NA
}else{
  Output[[1]] <- summary(lm(Qsoil ~ Height, data = data_df[which(data_df$TRY == "Raw"),]))[["coefficients"]][1,1]
  Output[[2]] <- summary(lm(Qsoil ~ Height, data = data_df[which(data_df$TRY == "Raw"),]))[["coefficients"]][1,4]
  Output[[3]] <- summary(lm(Qsoil ~ Height, data = data_df[which(data_df$TRY == "Raw"),]))[["coefficients"]][2,1]
  Output[[4]] <- summary(lm(Qsoil ~ Height, data = data_df[which(data_df$TRY == "Raw"),]))[["coefficients"]][2,4]
}
  Output[[5]] <- summary(lm(Qsoil ~ Height, data = data_df[which(data_df$TRY == "Mapped"),]))[["coefficients"]][1,1]
  Output[[6]] <- summary(lm(Qsoil ~ Height, data = data_df[which(data_df$TRY == "Mapped"),]))[["coefficients"]][1,4]
  Output[[7]] <- summary(lm(Qsoil ~ Height, data = data_df[which(data_df$TRY == "Mapped"),]))[["coefficients"]][2,1]
  Output[[8]] <- summary(lm(Qsoil ~ Height, data = data_df[which(data_df$TRY == "Mapped"),]))[["coefficients"]][2,4]
p2 <- ggplot(data_df, aes(x = Nitrogen, y = Qsoil, col = TRY)) +
  geom_point(shape = ".", alpha = 0.5, size = 3.5) + theme_bw(base_size = 35) +  xlab("Leaf Nitrogen Content") + ylab(VarTitle) + geom_hline(yintercept = 0, linetype="dotted") + stat_smooth(method = "lm") + scale_color_manual(values=c("orange", "black"))
print(p2)
  Output[[9]] <- summary(lm(Qsoil ~ Nitrogen, data = data_df[which(data_df$TRY == "Raw"),]))[["coefficients"]][1,1]
  Output[[10]] <- summary(lm(Qsoil ~ Nitrogen, data = data_df[which(data_df$TRY == "Raw"),]))[["coefficients"]][1,4]
  Output[[11]] <- summary(lm(Qsoil ~ Nitrogen, data = data_df[which(data_df$TRY == "Raw"),]))[["coefficients"]][2,1]
  Output[[12]] <- summary(lm(Qsoil ~ Nitrogen, data = data_df[which(data_df$TRY == "Raw"),]))[["coefficients"]][2,4]
  Output[[13]] <- summary(lm(Qsoil ~ Nitrogen, data = data_df[which(data_df$TRY == "Mapped"),]))[["coefficients"]][1,1]
  Output[[14]] <- summary(lm(Qsoil ~ Nitrogen, data = data_df[which(data_df$TRY == "Mapped"),]))[["coefficients"]][1,4]
  Output[[15]] <- summary(lm(Qsoil ~ Nitrogen, data = data_df[which(data_df$TRY == "Mapped"),]))[["coefficients"]][2,1]
  Output[[16]] <- summary(lm(Qsoil ~ Nitrogen, data = data_df[which(data_df$TRY == "Mapped"),]))[["coefficients"]][2,4]
  if(Variable == "Qsoil"){
    if(length(which(!is.na(data_df$Height[which(data_df$TRY == "Raw")]))) < 2){
  Output[[17]] <- NA
  Output[[18]] <- NA
  Output[[19]] <- NA
  Output[[20]] <- NA
}else{
  Output[[17]] <- summary(lm(Memory ~ Height, data = data_df[which(data_df$TRY == "Raw"),]))[["coefficients"]][1,1]
  Output[[18]] <- summary(lm(Memory ~ Height, data = data_df[which(data_df$TRY == "Raw"),]))[["coefficients"]][1,4]
  Output[[19]] <- summary(lm(Memory ~ Height, data = data_df[which(data_df$TRY == "Raw"),]))[["coefficients"]][2,1]
  Output[[20]] <- summary(lm(Memory ~ Height, data = data_df[which(data_df$TRY == "Raw"),]))[["coefficients"]][2,4]
}
  Output[[21]] <- summary(lm(Memory ~ Height, data = data_df[which(data_df$TRY == "Mapped"),]))[["coefficients"]][1,1]
  Output[[22]] <- summary(lm(Memory ~ Height, data = data_df[which(data_df$TRY == "Mapped"),]))[["coefficients"]][1,4]
  Output[[23]] <- summary(lm(Memory ~ Height, data = data_df[which(data_df$TRY == "Mapped"),]))[["coefficients"]][2,1]
  Output[[24]] <- summary(lm(Memory ~ Height, data = data_df[which(data_df$TRY == "Mapped"),]))[["coefficients"]][2,4]
  Output[[25]] <- summary(lm(Memory ~ Nitrogen, data = data_df[which(data_df$TRY == "Raw"),]))[["coefficients"]][1,1]
  Output[[26]] <- summary(lm(Memory ~ Nitrogen, data = data_df[which(data_df$TRY == "Raw"),]))[["coefficients"]][1,4]
  Output[[27]] <- summary(lm(Memory ~ Nitrogen, data = data_df[which(data_df$TRY == "Raw"),]))[["coefficients"]][2,1]
  Output[[28]] <- summary(lm(Memory ~ Nitrogen, data = data_df[which(data_df$TRY == "Raw"),]))[["coefficients"]][2,4]
  Output[[29]] <- summary(lm(Memory ~ Nitrogen, data = data_df[which(data_df$TRY == "Mapped"),]))[["coefficients"]][1,1]
  Output[[30]] <- summary(lm(Memory ~ Nitrogen, data = data_df[which(data_df$TRY == "Mapped"),]))[["coefficients"]][1,4]
  Output[[31]] <- summary(lm(Memory ~ Nitrogen, data = data_df[which(data_df$TRY == "Mapped"),]))[["coefficients"]][2,1]
  Output[[32]] <- summary(lm(Memory ~ Nitrogen, data = data_df[which(data_df$TRY == "Mapped"),]))[["coefficients"]][2,4]
  }
  return(Output)
}
```

```{r TRYresTab, echo = FALSE}
TryTab <- function(ModelCoeffs, SoilLayer, Region, Variable){
  ModelCoeffs <- unlist(ModelCoeffs)
  if(Variable != "Qsoil"){
    tabout <- data.frame(Column = ModelCoeffs[1:2])
    starts <- seq(1,length(ModelCoeffs), by = 2)
  for(i in 2:(length(ModelCoeffs)/2)){
    tabout <- cbind(tabout, ModelCoeffs[starts[i]:(starts[i]+1)])
  }
  colnames(tabout) <- rep(c("$I$", "$S$"), 4)
  rownames(tabout) <- c("Value", "$p_{Value}$")
  tabout <- round(tabout,5)
  Short <- paste("PFTs and ", Variable, " Memory (", Region, ")", sep="")
Long <- paste("Coefficients of linear regressions of ", Variable, " memory coefficients against PFT data 
              (vegetative height H, and leaf nitrogen mass Nmass) both as raw geo-referenced data (R), 
              and extended maps of species-specific trait means (M). 
              Established via \\ref{rTRYresTab}.", sep="")
  kab <- kable(tabout, 
            booktabs = TRUE,
            caption = paste("\\textbf{",Short, " -} ",Long, sep=""),
            caption.short = Short,
            escape = FALSE,
            format = 'latex')
  kab <- add_header_above(kable_input = kab, header = c(" " = 1, "R" = 2, "M" = 2, "R" = 2, "M" = 2), align = 'c')
  kab <- add_header_above(kable_input = kab, header = c(" " = 1, "Vegetative Height" = 4, "Nitrogen Content" = 4), bold = TRUE, align = 'c')
  }else{
tabout <- data.frame(Column = ModelCoeffs[1:4])
starts <- seq(1,length(ModelCoeffs), by = 4)
for(i in 2:(length(ModelCoeffs)/4)){
  tabout <- cbind(tabout, ModelCoeffs[starts[i]:(starts[i]+3)])
}
colnames(tabout) <- rep(c("R", "M"), 4)
rownames(tabout) <- c("Intercept", "$p_{Intercept}$", "Slope", "$p_{Slope}$")
Short <- paste("PFTs and Qsoil", SoilLayer, " Memory (", Region, ")", sep="")
Long <- paste("Coefficients of linear regressions of Qsoil", SoilLayer, " memory coefficients against PFT data 
              (vegetative height H, and leaf nitrogen mass Nmass) both as raw geo-referenced data (R), 
              and extended maps of species-specific trait means (M). 
              Established via \\ref{rTRYresTab}.", sep="")
kab <- kable(tabout, 
            booktabs = TRUE,
            caption = paste("\\textbf{",Short, " -} ",Long, sep=""),
            caption.short = Short,
            escape = FALSE,
            format = 'latex')
kab <- add_header_above(kable_input = kab, header = c(" " = 1, "H" = 2, "Nmass" = 2,
                                                      "H" = 2, "Nmass" = 2), italic = FALSE, align = 'c')
kab <- add_header_above(kable_input = kab, header = c(" " = 1, "Qsoil" = 4, "Lag" = 4), bold = TRUE, align = 'c')
}
kab <- kable_styling(kab, latex_options = c("hold_position"))
print(kab)
}
```

```{r COMRes, echo = FALSE}
Comres <- function(Variable, Region, Legend = FALSE){
  col.tair <- got(n = 1, alpha = 1, begin = 0, end = 1, direction = -1, option = "tully")
col.ndvi <- got(n = 1, alpha = 1, begin = 0, end = 1, direction = 1, option = "tyrell")
col.qsoil <- got(n = 1, alpha = 1, begin = 0, end = 1, direction = 1, option = "white_walkers")
col.mem <- got(n = 1, alpha = 1, begin = 0, end = 1, direction = -1, option = "greyjoy")
  VarHold <- Variable
  if(Variable == "FSC-1" | Variable == "FSC-2"){
    Variable <- "FastSlow"
  }
  ## Memory Data
  # Memory
  Dir.Reg <- paste(Dir.Memory, "/", Region, "-1981_2015", sep="")
  Files <- list.files(Dir.Reg)[grep(list.files(Dir.Reg), pattern = ".nc")]
  SoilLayer <- 1
  Memory_ras <- brick(paste(Dir.Reg, Files[SoilLayer], sep="/"))[[1]]
  # t-1
  Dir.Reg <- paste(Dir.Memory, "/", Region, "-1981_2015", sep="")
  Files <- list.files(Dir.Reg)[grep(list.files(Dir.Reg), pattern = ".nc")]
  SoilLayer <- 1
  NDVI_ras <- brick(paste(Dir.Reg, Files[SoilLayer], sep="/"))[[2]]
  # Qsoil
  Dir.Reg <- paste(Dir.Memory, "/", Region, "-1981_2015", sep="")
  Files <- list.files(Dir.Reg)[grep(list.files(Dir.Reg), pattern = ".nc")]
  SoilLayer <- 1
  Qsoil_ras <- brick(paste(Dir.Reg, Files[SoilLayer], sep="/"))[[3]]
  # Tair
  Dir.Reg <- paste(Dir.Memory, "/", Region, "-1981_2015", sep="")
  Files <- list.files(Dir.Reg)[grep(list.files(Dir.Reg), pattern = ".nc")]
  SoilLayer <- 1
  Tair_ras <- brick(paste(Dir.Reg, Files[SoilLayer], sep="/"))[[4]]
  ## COMPADRE data
  Dir.Comp <- paste(Dir.Compadre, Variable, sep="/")
  Compad_ras <- list.files(Dir.Comp)[grep(list.files(Dir.Comp), pattern = Region)]
  if(VarHold != "FSC-2"){
    Compad_ras <- raster(paste(Dir.Comp, Compad_ras, sep="/"))[[1]]
  }else{
    Compad_ras <- brick(paste(Dir.Comp, Compad_ras, sep="/"))[[2]]
  }
  values(Compad_ras)[which(values(Compad_ras) > quantile(values(Compad_ras), .66, na.rm = TRUE))] <- quantile(values(Compad_ras), .66, na.rm = TRUE)
  if(VarHold == "FSC-1" | VarHold == "FSC-2"){
   values(Compad_ras)[which(values(Compad_ras) < quantile(values(Compad_ras), .05, na.rm = TRUE))] <- quantile(values(Compad_ras), .05, na.rm = TRUE) 
  }
  plot_df <- data.frame(
    Data = c(values(Memory_ras), values(NDVI_ras), values(Qsoil_ras), values(Tair_ras)), 
    Identifiers = rep(c("Lag", "t-1", "Qsoil1", "Tair"), each = length(values(Memory_ras))),
   Compadre = rep(values(Compad_ras), 4)
  )
  Variable <- VarHold
  plot_df <- na.omit(plot_df)
  Output <- as.list(rep(NA,16))
  
  if(Legend == TRUE){
   plot <- ggplot(data = plot_df, aes(x = Compadre, y = Data, col = Identifiers)) + geom_point(alpha = 0.5, size = 3.5) + theme_bw(base_size = 35) +  xlab(paste("COMPADRE", Variable)) + ylab("Vegetation Memory Coefficients") + geom_hline(yintercept = 0, linetype="dotted") + stat_smooth(method = "lm", level = 0.66) + scale_color_manual(values=c(col.mem, col.qsoil, col.ndvi, col.tair))
  }else{
   plot <- ggplot(data = plot_df, aes(x = Compadre, y = Data, col = Identifiers)) + geom_point(alpha = 0.5, size = 3.5) + theme_bw(base_size = 35) +  xlab(paste("COMPADRE", Variable)) + ylab("Vegetation Memory Coefficients") + geom_hline(yintercept = 0, linetype="dotted") + stat_smooth(method = "lm", level = 0.66) + scale_color_manual(values=c(col.mem, col.qsoil, col.ndvi, col.tair)) + theme(legend.position = "none")
  }
  Idents <- c("t-1", "Tair", "Qsoil1", "Lag")
  for(i in 0:(length(Idents)-1)){
    Output[[(4*i+1)]] <- summary(lm(Data ~ Compadre, data = plot_df[which(plot_df$Identifiers == Idents[(i+1)]),]))[["coefficients"]][1,1]
    Output[[(4*i+2)]] <- summary(lm(Data ~ Compadre, data = plot_df[which(plot_df$Identifiers == Idents[(i+1)]),]))[["coefficients"]][1,4]
    Output[[(4*i+3)]] <- summary(lm(Data ~ Compadre, data = plot_df[which(plot_df$Identifiers == Idents[(i+1)]),]))[["coefficients"]][2,1]
    Output[[(4*i+4)]] <- summary(lm(Data ~ Compadre, data = plot_df[which(plot_df$Identifiers == Idents[(i+1)]),]))[["coefficients"]][2,4]
  }
  return(list(plot,Output,dim(plot_df)[1]/4))
}
```

```{r URes, echo = FALSE}
Ures <- function(Region, SoilLayer){
Dir.Reg <- paste(Dir.Memory, "/", Region, "-1981_2015", sep="")
Files <- list.files(Dir.Reg)[grep(list.files(Dir.Reg), pattern = ".xlsx")]
Utab <- read.xlsx(file = paste(Dir.Reg, Files, sep="/"), sheetName = paste("Model", SoilLayer))
Medians <- read.xlsx(file = paste(Dir.Reg, Files, sep="/"), sheetName = "Variable medians")[SoilLayer,]
Medians <- as.vector(Medians[1,c(2:4)])
rownames(Utab)  <- Utab[,1]
Utab[,1] <- c(round(Medians,4))
colnames(Utab) <- c("Medians" ,"NDVI [t-1]", paste("Qsoil", SoilLayer, sep=""), "Tair")
Utab <- round(Utab, 4)
Short <- paste("Mann-Whitney U-Test (", Region, ", Qsoil", SoilLayer, " Model)", sep="")
Long <- paste("U-Test statistics of vegetation memory coefficient values are contained within the upper-righthand 
              cells. This statistic is the sum of of all pixels in which the rowname variable is bigger than the 
              column name variable. $p$-values belonging to these $U$-values are represented in the lower-lefthand 
              block of cells. Established via \\ref{rUresChunk}.")
kab <- kable(Utab, 
            booktabs = TRUE,
            caption = paste("\\textbf{",Short, " -} ",Long, sep=""),
            caption.short = Short,
            escape = FALSE,
            format = 'latex')
kab <- add_header_above(kable_input = kab, header = c(" " = 2, "U-Test" = 3),bold = TRUE, align = 'c')
kab <- kable_styling(kab, latex_options = c("hold_position"))
print(kab)
}
```

```{r UQsoilRes, echo = FALSE}
UQsoilres <- function(Region){
Dir.Reg <- paste(Dir.Memory, "/", Region, "-1981_2015", sep="")
Files <- list.files(Dir.Reg)[grep(list.files(Dir.Reg), pattern = ".xlsx")]
Utab <- read.xlsx(file = paste(Dir.Reg, Files, sep="/"), sheetName = "Qsoil")
Medians <- read.xlsx(file = paste(Dir.Reg, Files, sep="/"), sheetName = "Variable medians")[,3]
rownames(Utab) <- paste("Qsoil", c(1:4), sep="")
Utab[,1] <- c(round(Medians,4))
colnames(Utab) <- c("Medians", paste("Qsoil", c(1:4), sep=""))
Utab <- round(Utab, 4)
Short <- paste("Mann-Whitney U-Test (", Region, ", Qsoil Layers)", sep="")
Long <- paste("U-Test statistics of vegetation memory coefficient values are contained within the upper-righthand cells. 
              $p$-values belonging to these $U$-values are represented in the lower-lefthand block of cells. 
              Established via \\ref{rUQsoilRes}.")
kab <- kable(Utab, 
            booktabs = TRUE,
            caption = paste("\\textbf{",Short, " -} ",Long, sep=""),
            caption.short = Short,
            escape = FALSE,
            format = 'latex')
kab <- kable_styling(kab, latex_options = c("hold_position"))
kab <- add_header_above(kable_input = kab, header = c(" " = 2, "U-Test" = 4),bold = TRUE, align = 'c')
print(kab)
}
```

```{r COMPADTab, echo = FALSE}
CompadTab <- function(Region, ModelCoeffs, Variable){
  tabout <- data.frame(Column = ModelCoeffs[1:2])
starts <- seq(1,length(ModelCoeffs), by = 2)
for(i in 2:(length(ModelCoeffs)/2)){
  tabout <- cbind(tabout, ModelCoeffs[starts[i]:(starts[i]+1)])
}
colnames(tabout) <- rep(c("$I$", "$S$"), 4)
rownames(tabout) <- c("Value", "$p_{Value}$")
tabout <- round(tabout,5)
Short <- paste("COMPADRE ", Variable, " and Vegetation Memory (", Region, ")", sep="")
Long <- paste("Linear regression coefficients of COMPADRE data and vegetation memory coefficients. 
              Established via \\ref{rCOMPADTab}.", sep="")
kab <- kable(tabout, 
            booktabs = TRUE,
            caption = paste("\\textbf{",Short, " -} ",Long, sep=""),
            caption.short = Short,
            escape = FALSE,
            format = 'latex')
kab <- add_header_above(kable_input = kab, header = c(" " = 1, "NDVI [t-1]" = 2, "Tair" = 2, "Qsoil1" = 2, "Lag1" = 2), bold = TRUE, align = 'c')
kab <- kable_styling(kab, latex_options = c("hold_position"))
print(kab)
}
```

```{r PFTTab, echo = FALSE}
PFTTab <- function(ModelCoeffs, Region, Data){ # Outputs of Tryres to ModelCOeffs
    tabout <- data.frame(Column = ModelCoeffs[1:4])
starts <- seq(1,length(ModelCoeffs), by = 4)
for(i in 2:(length(ModelCoeffs)/4)){
  tabout <- cbind(tabout, ModelCoeffs[starts[i]:(starts[i]+3)])
}
colnames(tabout) <- rep(c("H", "$N_{mass}$"), 6)
rownames(tabout) <- c("Intercept", "$p_{Intercept}$", "Slope", "$p_{Slope}$")
Short <- paste(Data, " PFTs and Vegetation Memory (",Region,")", sep="")
Long <- paste("Linear regression coefficients of vegetative height ($H$) and leaf nitrogen mass ($Nmass$) against 
              vegetation memory coefficients. 
              Established via \\ref{rPFTTab}.", sep="")
kab <- kable(tabout, 
            booktabs = TRUE,
            caption = paste("\\textbf{",Short, " -} ",Long, sep=""),
            caption.short = Short,
            escape = FALSE,
            format = 'latex')
kab <- add_header_above(kable_input = kab, header = c(" " = 1, "t-1" = 2, "Tair" = 2, 
                                                      "1" = 2, "2" = 2, "3" = 2, "4" = 2), italic = TRUE, align = 'c')
kab <- add_header_above(kable_input = kab, header = c(" " = 5, "Qsoil" = 8), bold = TRUE, align = 'c')
kab <- kable_styling(kab, latex_options = c("hold_position"))
print(kab)
}
```

<!--- ####### PREAMBLE -----------
--------------------------------------------->

\begin{titlepage}
%\maketitle % this is the default. it does not comply with the requirements by UiB
\includegraphics[height=2cm]{3 - Figures/uib-logo.png}
\hspace{6cm}
\includegraphics[height=2cm]{3 - Figures/Nansen-logo.jpg}\\
\line(1,0){500} \\
\begin{center}
%	\line(1,0){500} \\
%	\vspace{0.1cm}
	\Huge{Inferring Vegetation Memory from Remote Sensing Data using novel Climate Reconstruction Products}
%	\vspace{0.1cm}
%	\line(1,0){300} \\
	\vspace{2.5cm}\\
	\Large{\textbf{Master's Thesis (M.Sc.)}}\\
	\vspace{2.cm}
	\large{31/05/2019}\\
	\vspace{0.2cm}
	\large{at Universitetet i Bergen}\\
	\vspace{2cm}
	\large{In Partial Fulfilment of the Requirements for the Degree Master of Science (M.Sc.)}\\
	\vspace{3.5cm}
   \hfill \textbf{by} \linebreak 
    Primary Supervisor: Dr. Alistair Seddon \hfill  Erik Kusch  \linebreak 
    Secondary Supervisor: Dr. Richard Davy \hfill born 03/01/1995 in Eilenburg, Germany \\ 
    \hfill Enrolment number: 239977
\end{center}
\end{titlepage}


\clearpage

<!--- ####### TOC, TOF, TOT, TOL ------------------------------------------------>  
\pagenumbering{gobble}
\blankpage

\begin{abstract}

\end{abstract}

\chapter*{Acknowledgements}
First and foremost I would like to express my utmost gratitude to my two supervisors - Dr. Alistair Seddon, and Dr. Richard Davy - for supervising my thesis. Thank you for your valuable input and many lessons on research practices as well as your keeping up with my frequent emailing of revised manuscripts. I'd also like to thank Roberto Salguero-Gómez for supplying me with the data for the COMPADRE data base.

I never could've done the work presented in the following without the support of friends and family whom I owe massive thanks to. My family, for your unrelenting support in the form of goodie parcels shipped from Germany. Peter, for the many hikes and drinks we shared; our heart-to-heart conversations never fail to make me feel understood and supported. Rachel, for being a great friend, hosting me in your guest bed room and helping me bake awesome cake. Jenny, for calming the seas of life telling me to navigate them myself as best I can but never abandoning ship; it's great to have you on deck. Deborah, for genueinely outstanding advice on life, the universe, and everything; also for introducing me to two prime specimen of \textit{Felis Devilis}.

From the bottom of my heart - Thank all of you! I'd be delighted to have you around for the next big project.

\pagenumbering{roman} 
\setcounter{tocdepth}{3}
\tableofcontents
\listoffigures
\listoftables
\clearpage
\printglossary[title=List of Abbreviations and Acronyms,toctitle=List of Abbreviations and Acronyms]
\clearpage

<!--- ####### DOCUMENT ---------------------------------------------------------->
\pagenumbering{arabic}

\fancypagestyle{plain}{%
\fancyhead[OR]{\thepage}
\fancyhead[EL]{\thepage}
}
\pagestyle{fancy}

\titleformat{\chapter}{\normalfont\huge\bfseries}{}{0pt}{\thechapter. \Huge}
\titlespacing*{\chapter}{0pt}{00pt}{20pt}


\clearpage

# Introduction
Ecosystems are subject to disturbance regimes which can undergo substantial alterations, especially due to climate change\cite{Johnstone2016}. Widespread bioclimatic impacts which can be attributed to these climatic changes include\cite{CoreWritingTeam2014}: (1) increased frequency and intensity of climate extremes\cite{Santiago2016}, (2) increasing temperatures and levels of aridity in dryland regions\cite{Allen2010}, and (3) shifts in environemntal and ecosystem processes\cite{Kefi2016,Johnstone2016,Seidl2016b}. This has raised growing concern that future disturbance dynamics will exceed tipping points and cause non-linear shifts in ecosystem state in relation to **attractors**\cite{Senf2017} (see table \ref{tab:ResTerm} for definitions of bold font terms relating to the resilience debate). Such a **regime shift**\cite{Scheffer2010,Xu2015,Vasilakopoulos2015} can have major impacts on local as well as global welfare of mankind\cite{Cote2010,Scheffer2001,Genkai-Kato2007}. Therefore, policy makers have made it their mission statement to enforce actions which serve to maintain or boost **resilience**; a biological property which can safeguard against regime shifts. The Aichi biodiversity targets, for example, include the following statement: \textit{"By 2020, ecosystem resilience [...] has been enhanced, [...] thereby contributing to climate change mitigation and adaptation and to combating desertification"} as target 15\cite{CBD2013}. Whilst the Aichi targets are set to encompass global action, national policy makers, such as the Australian Government, are also recognising the importance of achieving climate resilience: \textit{"We achieve climate resilience when short, medium and long-term decision making considers current climate risks and a changing climate"}\cite{GovernmentDepartmentoftheEnvironment2015}. 
Conceiving such strategies and evaluating their respective efficacies requires a thorough understanding of resilience theory and a robust set of tools to measure the resilience of ecosystems.  

Generally, resilience can be understood as the capacity of a system to absorb **disturbances** and respond to changing conditions so as to still retain the same function, structure, identity and feedbacks\cite{Vasilakopoulos2015,Holling1973}. First introduced to biological sciences in 1973 by Holling resilience thinking encompassed two separate characteristics of ecosystems\cite{Holling1973}:

\begin{enumerate}
\item \textit{Stability} was defined as the ability of a system to return to its original state after a temporary disturbance. The more stable a system, the less it fluctuates in its characteristics and the faster it returns to its initial conditions after a perturbation. Contemporary literature usually refers to this property as \textbf{engineering resilience}\cite{Liu2018,Mumby2015,Seidl2016b}. 
\item \textit{Resilience}, on the other hand, was characterised as the property of a system that allowed it to withstand disturbances without collapsing. The more resilient a system, the higher its chances of persisting under changing conditions. Today this is mostly referred to as \textbf{ecological resilience}\cite{Scheffer2015,Standish2014,Gunderson2000}.  
\end{enumerate}

Within this early context on resilience thinking, a system could be resilient whilst not being very stable and fluctuating in its properties a great deal\cite{Holling1973}. Consider Andean grasslands as an example: wildfires lead to immense fluctuations in vegetation cover without making it impossible for the system to recover\cite{Oliveras2014}. As such, resilience thinking often considers large spatial and temporal extents\cite{Foley2003} which lend themselves well to remote sensing approaches\cite{Ares2001,Harris2014}.

<!-- It has been argued that, since then, the term 'resilience' itself has undergone a 'greenwash'\cite{Newton2016}, which has diminished its direct usefulness to researchers. This process has seen the term 'resilience' being introduced originally to ecological sciences but adapted by other branches of research (e.g. social sciences\cite{Carpenter2001}) and society (e.g. policy makers\cite{Newton2016}), modified for different purposes and re-introduced to ecological sciences with multiple altered definitions\cite{Brown2015}. For example, \textit{coerced resilience} is created and maintained through anthropogenic action\cite{Rist2014}. Novel remote sensing assessments of resilience, however, establish resilience theory largely though mathematical understandings\cite{Papagiannopoulou2017}. -->

<!-- Assumptions on ecosystem functioning that are made without including resilience thinking may result in particularly dire consequences if the systems in question (also referred to as focal systems\cite{Rist2014,Allen2016}) are production ecosystems\cite{Rist2014,Brown2015} (ecosystems which are used by humans for resource allocation). -->

Given the importance of assessing resistance in ecosystems with respect to global sustainability goals, baseline metrics on which to assess and compare resilience in different ecosystems are required\cite{Standish2014}. This poses a **major research challenge** of choosing a measure by which to assess resilience and ecosystem components reliably through time and space. Consequently, recent studies have focussed on identifying and quantifying sub-components of ecosystem  resilience\cite{Seddon2016,Redmond2017,Papagiannopoulou2017,Gazol2017}. This is especially the case in remote sensing research where data availability is largely determined through what data repositories are available.

\renewcommand{\arraystretch}{1.2}
\begin{table*}[h!]
  \centering
  \caption[Basic vocabulary of the ecological stability debate]{\textbf{Basic vocabulary of the ecological stability debate -} A few definitions that are key to the understanding of the resilience framework.}
    \begin{tabular}{|L{2.5cm}L{14cm}|}
    \hline
    \bfseries Term  & \bfseries Definition\\
    \hline
    \textbf{Attractor} 
    & A regime towards which a system moves asymptotically\cite{Scheffer2003, Rist2014, Tabacchi2009, Mumby2014, Angeler2016, Scheffer2001, Vasilakopoulos2015}. Also known as \textit{stable state}\cite{Foley2003}, \textit{(stable) equilibrium}\cite{Mumby2015} or \textit{regime}\cite{Tabacchi2009}. \\ \hdashline
    \textbf{Disturbance} 
    & Any impact that perturbs a systems trajectory from a given attractor\cite{Mouillot2013,Tabacchi2009,Standish2014, Grimm1997,Wardle2014}.
	\\ \hdashline  
    \textbf{Regime shift} 
    & The restructuring of a system from one set of dominant processes and feedbacks governed by one attractor to an alternate set governed by an alternate attractor\cite{Seddon2014,Scheffer2003,Mori2013,Rist2014, Selkoe2015}. Also known as \textit{tipping point}\cite{Scheffer2010} or \textit{bifurcation}\cite{Vasilakopoulos2015}.
	\\ \hline
    \textbf{Ecological Resilience} 
    & '[...] measures the magnitude of disturbance that can be absorbed before the ecosystem's structure changes'\cite{DeKeersmaecker2015}. Also known as \textit{General resilience}\cite{Angeler2016}.
    \linebreak Ecological resilience is a measure of how much a system can be changed until it shifts from one stable state/attractor to another\cite{Hodgson2015, Holling1973, Peterson1997, Angeler2016, DeKeersmaecker2015, Brown2015, Standish2014, Gunderson2000}.\\ \hdashline
    \textbf{Engineering Resilience} 
    & '[...] measures the speed of recovery after the disturbance'\cite{DeKeersmaecker2015}. Also known as \textit{Recovery}\cite{Standish2014}, \textit{Stability}\cite{Holling1973} or \textit{Resiliency}\cite{Angeler2016}.
    \linebreak Engineering resilience is a measure of how fast a system reverts to its pre-change state. It can be measured by assessing the return time\cite{Hodgson2015, Holling1973, Peterson1997, Angeler2016, DeKeersmaecker2015, Brown2015, Standish2014, Gunderson2000, Tabacchi2009}.\\
    \hline
    \end{tabular}%
  \label{tab:ResTerm}%
\end{table*}

One solution to establishing comparable metrics of resilience across ecosystems is to break down ecological resilience into different components. Hodgson et al. propose representing resilience as two separate entities: (1) *Resistance* to perturbation and (2) *Recovery* from perturbation\cite{Hodgson2015}. 

Ecosystem resistance capacities are of vital importance to ecosystem integrity, particularly in agricultural landscapes, and are usually studied in terms of linear regression models\cite{Ares2001}. Recovery rates have been used as proxies for resilience metrics in many study settings including (1) palaeoecological research (e.g. by linking recovery rates of tropical ecosystems and disturbances categories\cite{Cole2014}), (2) observational studies (e.g. drought-impacts across different temporal and spatial scales\cite{Reyer2015}), and (3) experimental research (e.g. through applying small-scale disturbances and recording recovery rates\cite{VanBelzen2017a}). Contemporary research often identifies recovery rates in terms on a fixed point of equilibrium, a perturbation event, and a measure  of time to recover to the euilibrium. Another option is to use autoregressive models, effectively tracking how ecosystem properties drive themselves through time thus enabling ecosystem recovery\cite{DeKeersmaecker2015}.

The *resistance* and *recovery* aspects of the Hodgson et al. framework to resilience can be represented through \textbf{ecological stress memory} (also know as 'ecological memory', see table \ref{tab:MemTerm} for definitions of bold font terms relating to the ecological memory framework). Ecological memory is a compound metric and whilst it is often understood to be synonymous with **adaptation to disturbances** resulting in increased biological fitness in the face of repeated stress events\cite{Walter2013}, other studies employ **ecological memory as a proxy for recovery rates**\cite{DeKeersmaecker2015}.

Nyström \& Folke reported a direct link between spatial resilience and ecological memory of coral reefs\cite{Nystrom2001}. In forest ecosystems, a positive link between ecological memory and ecosystem resilience has been identified by Johnstone et al\cite{Johnstone2016}. Additional support for this argument stems from remote sensing studies such as De Keersmaecker et al.\cite{DeKeersmaecker2015} and Seddon et al.\cite{Seddon2016} who identified autoregressive coefficients of vegetation properties as proxies of engineering resilience (i.e. recovery rates).

However, even quantifying ecological memory of an entire ecosystem is difficult as ecological memory is a compound metric unifying a multitude of sub-processes\cite{Walter2013}. For example, the aforementioned Nyström \& Folke recognised legacies, mobile links, and support areas as parts of ecological memory\cite{Nystrom2001} whilst Jonstone et al. propose information and material legacies as the key factors of ecological memory\cite{Johnstone2016}. Hence, ecosystem-scale studies have refocussed their attention on identifying components of ecological stress memory such as \textbf{vegetation memory}\cite{Walter2013,Johnstone2016}.  

\clearpage

## Vegetation Memory

Ecological memory (hence also vegetation memory) effects can be understood as the influence of antecedent conditions on ecosystem properties given contemporary disturbance regimes\cite{Liu2018,Ogle2015}. The existence of such temporal effects emphasize the necessity of considering time in ecological frameworks by providing a link between antecedent environmental conditions and plant performance\cite{Seddon2016,Munne-Bosch2013,Papagiannopoulou2017a,Walter2013}. In fact, there is empirical evidence that past conditions inform contemporary vegetation morphology\cite{Walter2013}, phenology\cite{Liu2018}, primary productivity\cite{Ogle2015,Rudgers2018}, species composition\cite{Esper2015,Walter2013}, and carbon cycles\cite{Papagiannopoulou2017a,Liu2018}. Studying vegetation memory sheds light on an important set of ecosystem processes which contain an outstanding potential to make ecosystems resilient in the face of climate change\cite{Walter2013} and enhance our capabilities of accurately predicting cosystem responses to a host of bioclimatic stressors.

### Terminology
Vegetation memory can - in the broadest of terms - be understood as:

\begin{center}
\textbf{\textit{The impacts of antecedent conditions on current vegetation
productivity.}}\cite{Liu2018,Ogle2015,Walter2013,DeKeersmaecker2015}
\end{center}

In a comprehensive paper, Ogle et al. expanded on this definition by identifying the following three important characteristics to vegetation memory\cite{Ogle2015}:
\begin{enumerate}
\item \textit{Length} - The extent of time through which past conditions significantly affect the current state of vegetation.
\item \textit{Strength} - The magnitude of the effect that past events/conditions have on the current state of vegetation
\item \textit{Temporal Patterns} - The variation in relative impacts of antecedent conditions at different points in time.
\end{enumerate}

Tackling the characteristic of vegetation memory origin, Ogle et al. introduced the notion of **intrinsic** and **extrinsic** memory effects\cite{Ogle2015} (see table \ref{tab:MemTerm} and figure \ref{fig:SchemaVegMem}). 

Due to the complexity of extrinsic memory components and drivers I find it useful to add another criterion to extrinsic memory characteristics: \textit{Extrinsic Source}. This represents the nature of the antecedent extrinsic conditions that drive current states of vegetation (i.e. the origin/source of the extrinsic memory effect), including (but not limited to): herbivory pressure or climate events.

\renewcommand{\arraystretch}{1.2}
\begin{table*}[h!]
  \centering
  \caption[Basic vocabulary of the vegetation memory framework]{\textbf{Basic vocabulary of the vegetation memory framework -} A few definitions that are key to the understanding of vegetation memory and its components.}
    \begin{tabular}{|L{4cm}L{12.5cm}|}
    \hline
    \bfseries Term  & \bfseries Definition\\
    \hline
    \textbf{Ecological Memory} & Ecological memory is synonymous with information and material legacies: adaptations, individuals, and materials that persist after a disturbance and drive the responses to future disturbances\cite{Johnstone2016,Nystrom2001}.
\\ \hdashline  
    \textbf{Vegetation Memory} & Vegetation memory is defined as any response of a single plant or vegetation compounds after following disturbance event that alters the response of the plant/plant community towards future stress events. This includes a modification of interaction with other ecological components\cite{Walter2013}.\\ \hline
    \textbf{Intrinsic Memory} & Intrinsic memory refers to the influence of antecedent conditions of the focal system in determining contemporary conditions of the same system. Also known as \textit{endogenous memory}.\cite{Ogle2015} \\ \hdashline
    \textbf{Extrinsic Memory} & Extrinsic memory refers to the influence of antecedent conditions of the environment (usually abiotic, climate factors) in determining contemporary conditions of the focal system. Also known as \textit{exogenous memory}.\cite{Ogle2015} \\ \hline
    \end{tabular}%
  \label{tab:MemTerm}%
\end{table*}

\clearpage

### Ecological Relevance
Vegetation memory is identified as the effect of antecedent conditions on current vegetation patterns\cite{Ogle2015}. The stronger and longer the memory effect, the more vegetation will be influenced by antecedent anomalies of the ecosystem and abiotic processes thus signalling higher sensitivity to these drivers\cite{DeKeersmaecker2015}. A higher sensitivity translates to lower resilience and so:
\begin{center}
\textbf{Vegetation memory has been proposed as a proxy for engineering resilience.}\cite{Liu2018,DeKeersmaecker2017}
\end{center}

Patterns and characteristics of vegetation memory are a vital information criterion for \dss aimed at conservation or management efforts due to the inverse relationship between vegetation memory and engineering resilience. 

Additionally, vegetation memory is a compound metric which may be driven via a variety of forcing factors\cite{Seddon2016}. Thus making use of the differentiation of *intrinsic* and *extrinsic* components of vegetation memory by Ogle et al.\cite{Ogle2015} aids in gaining additional understanding of what local vegetation reacts to.

### Quantifying Vegetation Memory
Vegetation memory is influenced by a multitude of processes which range from abiotic characteristics\cite{DeKeersmaecker2015,Seddon2016,Papagiannopoulou2017a} to biotic system components\cite{Johnstone2016,DeKeersmaecker2015}. Comprehensive studies of vegetation response to biotic and abiotic forcing are numerous\cite{Liu2018,Seddon2016,Papagiannopoulou2017a,Ogle2015,Cole2014,Seddon2016}. 

#### Traditional Approaches

Traditional studies of vegetation memory leverage data obtained via extensive sampling campaigns and are thus laborious to carry out. Nevertheless, a multitude of such studies exist which provide a solid foundation for the understanding of ecological memory to date. 

Some traditional approaches - like Johnstone et al.\cite{Johnstone2016} - establish theoretical frameworks of vegetation memory (i.e. as material and information legacies) which require empirical assessment through further research.

One such study identified vegetation memory as spectral reddening as a proxy of spatial correlation of ecosystem properties. Increased spatial correlation is regarded as a proxy of high memory and ecosystems approaching regime shifts\cite{Kefi2014}. Additionally, these largely field-based studies are able to make use of a host of information criteria including but not limited to seed banks, wood thickness, canopy structure, and root depth\cite{Filotas2014}. Such information is often invaluable as it highlights the functional property of vegetation memory which is often identified through vegetation responses to different disturbances but rarely explained in terms of plant function that enables memory.

Due to limited sampling effort, such traditional studies are - although vitally important for our understanding of vegetation memory pathways - limited in scope. This will often lead to an advanced causal understanding of vegetation memory but only at limited spatial and temporal extents.

#### Remote Sensing Approaches

Remote sensing studies forego tedious field work data collection efforts and rely solely on easily available data. This data may either be obtained via remote sensing methods (i.e. satellite or drone imagery) or be pulled from published data sets from the field.

Using these data sets, remote sensing studies of vegetation memory offer vast improvements in spatial and potentially temporal coverage when compared to traditional approaches. This, in turn, allows for landscape-scale patterns of vegetation memory characteristics to be identified. Unfortunately, to achieve these large spatial extents, one often has to sacrifice spatial and temporal resolution. Especially climate data can be unreliable in some regions of the world when field measurements are sparse.

Recent remote sensing studies of vegetation memory have established a multitude of approaches to delineating vegetation memory from a variety of data sets. Examples include the use of:


\begin{enumerate}
\item \textbf{Correlation coefficients} of different lags of drought indices. 
\end{enumerate}

Prominent examples of these approaches (e.g. Vicente-Serrano et al.\cite{Vicente-Serrano2013}, and Liu et al.\cite{Liu2018}), identify vegetation characteristics through time via the \ndvi (aggregated from bi-weekly records to monthly maximum composites). Drought characteristics are usually assessed either via the \spei or \spi. Additionally, data is assessed for certain quality criteria (e.g. monthly \ndvi $< .1$) and standardised. Subsequently, correlation coefficients asses how well \ndvi and drought index anomalies co-incide (strength of memory, A in figure \ref{fig:Vincente}) and at what temporal lag these coefficients are the most relevant (length of memory, B in figure \ref{fig:Vincente} and figure \ref{fig:Liu}).

\begin{figure}[h!]
\centering \includegraphics[width=1\linewidth]{3 - Figures/Vincente.png}
\caption[Drought Memory Length and Strength]{\textbf{Drought Memory Length and Strength - }Spatial patterns of drought memory length assessed via correlation coefficients. Figure lifted from Vicente-Serrano et al\cite{Vicente-Serrano2013}.}
\label{fig:Vincente}
\end{figure}

\clearpage

\begin{figure}[h!]
\centering \includegraphics[width=.9\linewidth]{3 - Figures/Liu.png}
\caption[Water Memory Length]{\textbf{Water Memory Length - } Spatial patterns of water memory length assessed via correlation coefficients. Figure lifted from Liu et al\cite{Liu2018}.}
\label{fig:Liu}
\end{figure}

\begin{enumerate}
\setcounter{enumi}{1}
\item \textbf{Mixed effect models} of antecedent vegetation and climate characteristics and subsequent model selection.
\end{enumerate}

In their 2015 paper, De Keersmaecker et al. introduced a comprehensive vegetation memory modelling approach using \ndvi, temperature, and \spei data in a linear mixed effect model. Again, certain data preparation steps such as removal of low-quality data, calculation of maximum monthly composites of \ndvi and subsequent standardisation were carried out. Climate data which did not meet the same spatial resolution as the \ndvi data was resampled using the nearest neighbour method. Study results of the **first autoregressive model** (\ndvi data regressed via \ndvi data a previous time step, also referred to as *intrinsic memory*) are presented in figure \ref{fig:DeKeers}.

\begin{figure}[h!]
\centering \includegraphics[width=1\linewidth]{3 - Figures/DeKeers.png}
\caption[Intrinsic Vegetation Memory]{\textbf{Intrinsic Vegetation Memory - } Autoregressive coefficients of intrinsic vegetation memory depicting engineering resilience (high memory scores identify low resilience). Figured lifted from De Keersmaecker et al\cite{DeKeersmaecker2015}.}
\label{fig:DeKeers}
\end{figure}

Seddon et al.\cite{Seddon2016} delineated autoregressive \ndvi patterns very similar to those presented in figure \ref{fig:DeKeers}.

<!-- Seddon et al. -->

<!-- \begin{figure}[h!] -->
<!-- \centering \includegraphics[width=.7\linewidth]{3 - Figures/Seddon.png} -->
<!-- \caption[Short]{\textbf{Short - }Long\cite{Seddon2015}} -->
<!-- \label{fig:Seddon} -->
<!-- \end{figure} -->

<!-- \begin{enumerate} -->
<!-- \setcounter{enumi}{2} -->
<!-- \item \textbf{Bayesian models} to distinguish intrinsic and extrinsic memory effects.  -->
<!-- \end{enumerate} -->

\clearpage

#### Synthesis

\paragraph*{Models}  \hspace{.5cm}

Some common modelling practices have emerged from contemporary remote sensing vegetation memory studies: 
\begin{enumerate}
\item \textbf{Intrinsic Memory} is usually identified as the relationship between vegetation properties at time step $t$ a prior time $t-1$ (usually at monthly intervals)\cite{DeKeersmaecker2015}. See figure \ref{fig:SchemaVegMem} for a visual representation.
\item \textbf{Extrinsic Memory} is attributed to combinations of temperature, precipitation, and/or drought records\cite{Liu2018,Vicente-Serrano2013,DeKeersmaecker2015,Ogle2015}. See figure \ref{fig:SchemaVegMem} for a visual representation.
\item \textbf{Model Selection} is used to determine the length of extrinsic memory effects by identifying the time window during which extrinsic forcing holds the most explanatory power of vegetation characteristics\cite{Liu2018,Vicente-Serrano2013,DeKeersmaecker2015}.
\item \textbf{Anomalies} (i.e. standardised records) of both response and predictor variables are used as these are metrics which can be linked directly to perturbation events\cite{DeKeersmaecker2015}.
\end{enumerate}

Vegetation memory models can thus usually be summarised as:

\begin{equation}
Y_t = \alpha * Y_{t-1} + \sum_{e = 1}^{E}(\beta_e * X_e)
\end{equation}

with $Y_t$ and $Y_{t-1}$ denoting anomalies of vegetation properties at times $t$ and $t-1$ respectively, $X_e$ indexing anomalies of the $e$'th extrinsic force (out of a total $E$ extrinsic drivers), and $\alpha$ and $\beta$ representing the **coeffcients** of **intrinsic** and **extrinsic** memory effects respectively. Rerunning such a model with independent, extrinsic inputs ($X_e$'s) at different time lags and subsequent model selection can then be employed to identify the length of the extrinsic vegetation memory related to the $e$'th extrinsic force.

\begin{figure}[h!]
\centering \includegraphics[width=1\linewidth]{3 - Figures/Scheme_VegMem.jpg}
\caption[Components of Vegetation Memory]{\textbf{Components of Vegetation Memory - }Conceptual layout of how intrinsic and extrinsic vegetation memory components can be identified. The concept recognises two important variables: (1) \textit{Response} - contemporary vegetation properties at time $t$, and (2) \textit{Extrinsic} - antecedent environmental data. Within this framework, vegetation memory - both intrinsic and extrinsic - is identified as the predictability of the response variable through a regression onto itself and extrinsic variables respectively. Regressions of data onto each other are visualised as dashed arrows, lag effects are identified by numbers. Some parts of this figure have been generated via \ref{rFigs}.}
\label{fig:SchemaVegMem}
\end{figure}

\clearpage

\paragraph*{Spatial Memory Patterns}  \hspace{.5cm}

Results of the studies above clearly indcate some areas of special interest: 

\begin{enumerate}
\item \textit{High Memory Coefficients} indicating regions of low resilience can be found largely in \textit{dryland regions} (e.g.: North-East Brazil, Australia, and Spain; figures \ref{fig:Vincente} and \ref{fig:DeKeers}).
\item \textit{Trends in Memory Length} signalling a change in causal patterns of memory effects can be found across the Iberian Peninsula, and the contiguous United States of America. See figures \ref{fig:Vincente} and \ref{fig:Liu}.
\end{enumerate}

Furthermore, all of these regions are characterised by gradients in vegetation memory intensity (figures \ref{fig:Vincente} and \ref{fig:DeKeers}). Remote sensing vegetation memory should thus focus on the above listed **dryland regions** characterised by **shifts in memory properties**. Finally, since vegetation memory is largely researched in terms of water limitations and precipitation events, dryland regions are expected to allow for identification of extrinsic memory effects.

\paragraph*{Data}  \hspace{.5cm}

Vegetation properties are usually assessed using \ndvi data. Additionally, indices of climate metrics are used for the calculation of extrinsic memory components. 

Contemporary studies of vegetation memory largely rely on *precipitation* or *drought* data obtained via the \spei drought index\cite{DeKeersmaecker2017,DeKeersmaecker2015}, and the \cru data set\cite{Liu2018}. These data sets are *observational* data sets as they are built from observational data often involving simple interpolation methods\cite{Trzaska2014}. Climate science has developed novel data sets which are more advanced than simple observational data sets. Thse are known as climate reanalysis products.

**Climate reanalysis** data sets are *self-consistent*, *gap-less* (in time and space) and thus **superior** to many observational data sets. One such reanalysis data set is the \textbf{\era}\cite{Era5Online}. The superiority of \era is largely due to:

\begin{enumerate}
\item The \textbf{volume of observational data} used to create the \era product with data types ranging from satellite data to weather station/independent institute data collection efforts, and station data from a wide variety of data providers\cite{ECMWF2018a}. Traditional, observational data sets are often characterised by their individual biases in sampling, and coverage representativeness. 
\item Its \textbf{sophisticated nature} building upon data assimilation procedures\cite{ECMWF2018b}, and complex models\cite{ECMWF2018} to shed light on physical processes\cite{ECMWF2018c}. As such, \era is currently the \textit{state-of-the-art} climate reanalysis product in climate science and benefits from the developments in data assimilation methodology, understanding of physics of the climate system and their interactions, which have come about in recent decades.
\end{enumerate}

Finally, \era improves on other prominent climate data sets in ecological studies like the aforementioned \cru and \spei, WorldClim (used by Garris et al.\cite{Garris2015}), or the \chelsa data set\cite{Bruelheide2018} in a multitude of ways since it offers:
\begin{enumerate}
\item Superior \textit{Temporal Resolution} (superior resolving of climate extremes)
\item Superior \textit{Spatial Resolution} (advanced resolving of local/topographical features)
\end{enumerate}

Therefore, one can reasonably expect to improve on contemporary vegetation memory studies by substituting observational climate data sets with the highly advanced \era data set.

In addition, none of the contemporary vegetation memory studies on landscape-scales include biological ground-truthed data such as the aforementioned indices of functional aspects to plants which traditional approaches can leverage through measures of **Plant Function** and thus aren't posed to identify biological causal pathways of vegetation memory

\clearpage

## Functional Aspects of Vegetation Memory
Contemporary studies identify patterns of vegetation memory but largely forego questions of causal processes to further our understanding of what enables vegetation memory capacities. Doing so could enable more refined \dss. Since vegetation memory acts as a proxy for ecosystem process functioning, I hypothesise that expressions of vegetation memory can be explained through the lens of **functional ecology**. A functional approach to ecosystem processes can potentially explain what functional expressions allow said processes to persist despite perturbations\cite{DeBoeck2017,Truchy2015,Mace2014,Lavorel2002} thus informing resilience metrics such as vegetation memory. One of the most prominent tools of such studies is the *functional trait framework*. Arguabely, the most important of these frameworks when understanding vegetation processes - such as vegetation memory - is that of \textbf{\LHT} and \textbf{\PFT} frameworks.  

### Terminology

\LHTs and \PFTs both capture crucial information of vegetation capabilities to cope with stressors. Despite recording vastly different aspects of plant function in respect to time, they should be regarded as *complementary* due to their demonstrated capabilities in explaining natural phenomena.

#### Life History Traits

\textbf{\LHT} frameworks (see table \ref{tab:LHTTerm} for definitions of bold font terms relating to \LHTs) assess plant/population characteristics through time thus mirroring the temporal aspect of vegetation memory leading up to, during, and following perutrbations. Since expressions of \LHTs explain temporal community processes and may thus be major drivers of ocal vegetation memory expressions. Prominent examples of \LHTs include measures relating to (1) **System Turnover**, (2) **Longevity**, (3) **Growth**, and (4) **Reproduction** all of which retain information of how individual biological proceses shape vegetation communities and have been found to explain a majority of variance in plant life history strategies\cite{Salguero-Gomez2015}.

Specifically, I hypothesise for vegetation memory effects to be at least partially driven by:

\begin{enumerate}
\item The \textbf{Fast-Slow Continuum (FSC)} is a \pca-based approach whose two main axes capture over 60\% of the variation in plant life history strategies\cite{Salguero-Gomez2017} and are largely made up by the \LHTs contained in table \ref{tab:LHTTerm}\cite{Salguero-Gomez2015}. I hypothesize that expressions of the \fsc will strongly interact with vegetation memory effects due to the holistic nature of the \fsc and the temporal nature of both \LHTs and vegetation memory effects. The two axes read as follows:
  \begin{enumerate}
  \item \textit{\fsca} explains around 35\% of global \LHT variation and contrasts species of low generation times, early maturity, and fast growth with species of high generation times, delayed maturity, and slow growth\cite{Salguero-Gomez2017}. Fast species rank low on this axis\cite{Salguero-Gomez2016} and possess an innate potential to recover fast from perturbations through re-population thus strengthening engineering resilience and lowering vegetation memory.
  \item \textit{\fscb} captures approximately 25\% of global \LHT variation and contrasts species low reproductive output with species that reproduce much, often, and for a long time\cite{Salguero-Gomez2017}. Species of low reproductive output rank low on this axis\cite{Salguero-Gomez2016} and are expected to struggle to return to a pre-disturbance state thus intensifying vegetation memory effects.
  \end{enumerate}
\item \textbf{Reactivity} is a \textit{first time-step} information criterion and a proxy for instantaneous biological responses\cite{Stott2011} and may thus be an important criterion in areas of high vegetation memory and thus low engineering resilience as high reactivity enables fast responses thus strngthening engineering resilience.
\item The \textbf{\crho} can be regarded as a measure of intrinsic resilience as it indicates how fast transient dynamics of a perturbation event decay; the larger \crho, the faster the population will converge\cite{Stott2011} and the higher the engineering resilience of the focal population.
\item The \textbf{\cpi} is a measure of population life cycles in periodic environments with more rapidly growing populations usually being classified by higher \cpi values\cite{Caswell2001} and theoretically higher engineering resilience.
\end{enumerate}

\renewcommand{\arraystretch}{1.2}
\begin{table*}[h!]
  \centering
  \caption[Basic vocabulary of Life History Trait frameworks]{\textbf{Basic vocabulary of Life History Trait frameworks -} A few definitions that are key to the understanding of Life History Trait frameworks. Largely influenced by Salguero-Gómez et al\cite{Salguero-Gomez2016}.}
    \begin{tabular}{|L{4cm}L{12.5cm}|}
    \hline
    \bfseries Term  & \bfseries Definition\\
    \hline
    \textbf{Life History Traits (LHTs)} & LHTs characterise life history processes of populations and thus identifying temporal aspects of their life cycles.\\ \hline  
    \textbf{System Turnover} &  \\
    \textit{Generation Time} & The time needed to fully replace a population by a new cohort. \\ \hdashline
    \textbf{Longevity} & \\
    \textit{Survivorship Curve} & Shape of age-specific survivorship curve type. \\ 
    \textit{Age at Sexual Maturity} & Time it takes for an average individual of a population to become sexually reproductive. \\ \hdashline
    \textbf{Growth} & \\ 
    \textit{Progressive} & Mean probability to advance in life stages. \\ 
    \textit{Retrogressive} & Mean probability to regress in life stages. \\ \hdashline
    \textbf{Reproduction} & \\ 
    \textit{Net Reproductive Rate} & Mean number of recruits produced by each individual in the population. \\
    \textit{Degree of Iteroparity} & Spread of reproduction during the lifespan of an individual. \\ 
    \textit{Mature Life Expectancy} & Time between age of sexual maturity and life expectancy. \\ \hline
    \end{tabular}%
  \label{tab:LHTTerm}%
\end{table*}

#### Plant Functional Traits
\PFT frameworks (see table \ref{tab:PFTTerm} for definitions of bold font terms relating to \PFTs) convey information as *snapshots* of reality as their data sets usually do not contain repeated measures of the same individuals over a period of time. These data sets have been linked to evolution\cite{Ackerly2003} and community composition patterns\cite{Laughlin2014,Lavorel2002}. A change in their expression has been found to be correlated with climate change patterns\cite{Wright2005} potentially suggesting a causal link between extrinsic vegetation memory and \PFT expressions. To classify the way in which \PFTs are related to community functions, Nock et al. present the concept of (1) \textbf{Effect Traits}, and (2) \textbf{Response Traits}\cite{Nock2016}. Classifying \PFTs according to this framework can profoundly aid the understanding of their influence on spatio-temporal patterns of vegetation performance\cite{Lavorel2002,Mori2013}. Effect traits determine how \PFTs alter ecosystem processes. Response traits affect how vegetation reacts to perturbations. Whilst effect traits predominantely drive post-disturbance recovery, response traits signify potential resistance or recovery along a continuum of individual \PFT-driven responses either influencing resitance or recovery.

Recent studies suggest that vegetation community functions are governed by integrated phenotypes, which can be regarded as combinations of \PFT ranges\cite{Bonser2006, Nock2016} thus calling for a scientific approach focussed on \textbf{\FDR} which can be identified via an approach in which \PFT values of each individual are placed within a multidimensional system with each axis representing the range of values for one specific \PFT\cite{Ordonez2015}. Additonally, one may also want to use a measure of evenness which, in a functional biology setting, can be referred to as \textbf{\FDD} which is representative of how evenly dispersed data records are in multidimensional space.

Identifying \FDR and \FDD requires a lot of indivudal \PFT data and so contemporary studies in \PFT research have focussed heavily on methods of dimensionality reduction by identifying the \PFTs which capture a vast part of the global variation of plant function\cite{Laughlin2014,Diaz2015}. One such framework has been established in theory by Westoby \& Wright in which three important \PFT dimensions are recognised: (1) the leaf economic spectrum, (2) the seed size/mass spectrum, and (3) the height of the canopy at maturity\cite{Westoby2006}. 

<!-- \clearpage -->

\renewcommand{\arraystretch}{1.2}
\begin{table*}[h!]
  \centering
  \caption[Basic vocabulary of Plant Functional Trait frameworks]{\textbf{Basic vocabulary of Plant Functional Trait frameworks -} A few definitions that are key to the understanding of Plant Functional Trait frameworks.}
    \begin{tabular}{|L{3.5cm}L{13cm}|}
    \hline
    \bfseries Term  & \bfseries Definition\\
    \hline
    \textbf{Plant Functional Traits (PFTs)} & Plant Functional traits characterise morphological, biochemical, physiological, structural, phenological and/or behavioural aspects of organisms which influence the fitness of said organisms\cite{Nock2016}.\\ \hdashline  
    \textbf{Effect Traits} & These determine a species influence on ecosystem processes\cite{Nock2016}.\\ \hdashline  
    \textbf{Response Traits} & These determine a species ability to colonise a certain habitat and persist despite environmental pressures\cite{Nock2016}.\\ \hline  
    \textbf{Functional Diversity Richness (FDR)} & Functional diversity richness measures the range of the PFT spectrum of a given study region/species assembly in multivariate trait space via a multivariate convex hull effectively measuring niche space\cite{Ordonez2015}.\\ \hdashline
    \textbf{Functional Diversity Dispersion (FDD)} & Functional diversity dispersion measure the dispersion of PFT values in multivariate trait space with respect to the local functional space centre effectively measuring niche segregation\cite{Ordonez2015}.\\ \hline
    \end{tabular}%
  \label{tab:PFTTerm}%
\end{table*}

Using an empirical approach similar to the aforementioned FSC, Díaz et al. identified:
\begin{enumerate}
\item \textit{Vegetative height} ($H$) - an important criterion to accessing light resources
\item \textit{Stem specific density} ($SSD$) - reflecting a trade-off between growth potential and mortality risk
\item \textit{Leaf area} ($LA$) - vital consequences for leaf water balance
\item \textit{Leaf mass per area} ($LMA$) - a proxy for the trade-off between carbon gain and leaf longevity
\item \textit{\nmass} - reflects a trade-off between photosynthetic potential and acquiring nitrogen
\item \textit{Diaspore mass} ($Dmass$) - reflects a trade-off between seedling survival and colonization ability
\end{enumerate}
as the most important \PFTs to understanding the global spectrum of plant functioning\cite{Diaz2015}. Recovery rates of vegetation post-disturbance (i.e. vegetation memory) is influenced by energy and biomass availability. Resource allocation and hence recovery potential using the above six traits is best understood employing $H$, $lMA$, and \nmass due to their direct link to realising photosynthetic potential. Resistance potential, on the other hand, is influenced heavily by the physical toughness of plant material, presence of storage organs, and many other aspects of plant function captured by \PFTs and so $SSD$, $LMA$, and \nmass are especially promising as drivers of ecosystem resistance.

<!-- \clearpage -->

### Ecological Relevance  
The diverse range in which measures of plant function can be expressed are representative of the diverse strategies for establishing, growing and reproducing of plants\cite{Laughlin2014}. Hence, understanding how plant functioning enables plants to persist despite (a)biotic forcing (i.e. vegetation memory) is a promising first step to understanding ecosystem-scale responses to climate change. This is due to the positive effect of biodiversity on ecological stability which has long been recorded\cite{DeBoeck2017} and even led to the formulation of prominent concepts like Yacchi's insurance hypothesis which postulates that the loss of a subset of species can be compensated for by the presence of other species given a sufficient overlap in functional aspects of both thus leading to a stabilisation of ecosystem processes\cite{Yachi1999}. 

\begin{center}
\textbf{\PFTs and \LHTs capture information about a variety of ecosystem processes.}\cite{Butler2017}
\end{center}

Most studies to date have focussed on species diversity\cite{Vasilakopoulos2015,Cote2010,Brown2015}. Some made use of the concept of functional species\cite{Gunderson2000} which presents researchers with a species classification system that is vague at best due to loose definitions of where to draw the lines between functional species. Functional trait biology, which captures the functional diversity of biological systems, is often employed as an improvement to the functional species/type concept\cite{Munne-Bosch2013,Walter2013} as it eliminates the necessity of phylogenetic analyses\cite{Nock2016} and enables studies to capture intra-specific variation\cite{Violle2012,Dantas2013,Kattge2011} thus making landscape-scale studies (such as remote sensing approaches) of vegetation memory patterns and their links to functional diversity possible. 

\begin{center}
\textbf{\PFTs and \LHTs can be captured irrespective of species relationships.}\cite{Dantas2013}
\end{center}

Thus, \PFTs and \LHTs could make for \textit{highly informative} proxies of \textit{ecosystem functioning} which can be recorded across \textit{large spatial and temporal scales} since studies aren't constrained to a handful of species. Additionally, \PFTs and represent an improved understanding of functional expressions of plant communities by \textit{expressing information at sub-species level}\cite{Violle2012}. Recent research based upon \LHT data, for example, has revealed robust trade-off axes in plant\cite{Salguero-Gomez2016,Salguero-Gomez2017} as well as animal life histories\cite{Capdevila2018,Healy2018}. Information about \LHTs has been demonstrated to be of use in trying to understand biological responses to temporal phenomena\cite{Paniw2018} and should thus prove crucial in delineating causal, biological pathways to establishing vegetation memory. 


<!-- \clearpage -->

### Unifying Information on Plant Functional Traits
\PFTs are usually recorded through individual trait campaigns or for single-study purposes. Combining \PFT information from these individual data sets can prove challenging due to different measurement practices and understandings of \PFTs. A comprehensive handbook on \PFT data collection practices by Pérez-Harguindeguy et al.\cite{Perez-Harguindeguy2013} presents an elegant solution to making \PFT data sets more comparable. Additionally, \PFT data sets have been aggregated into large data bases within online repositories such as:
\begin{itemize}
\item The \textbf{\TRY}\cite{Kattge2011} is data base of \PFT records connecting vegetation scientists across the globe and hosted by the \idiv. Within it's current release version (version 4) \TRY contains almost seven million \PFT records for 1,800 traits with about half of all records being geo-referenced\cite{TRYOnline}.
\item The \textbf{\BIEN}\cite{Enquist2009} is a repository of global plant diversity, function, and distribution. Its current release (version 4.1) contains over 200 million records at global coverage\cite{BIENOnline}.
\end{itemize}

<!-- \begin{minipage}[t]{.5\linewidth} -->
<!-- \begin{itemize} -->
<!-- \item The \textbf{\TRY}\cite{Kattge2011} is data base of \PFT records hosted by the \idiv. Its current release (version 4) \TRY contains almost seven million \PFT records for 1,800 traits with about half of all records being geo-referenced\cite{TRYOnline}. -->
<!-- \end{itemize} -->
<!-- \end{minipage} -->
<!-- \begin{minipage}[t]{.5\linewidth} -->
<!-- \begin{itemize} -->
<!-- \item The \textbf{\BIEN}\cite{Enquist2009} is a repository of global plant diversity, function, and distribution. Its current release (version 4.1) contains over 200 million records at global coverage\cite{BIENOnline}. See figure \ref{fig:BIEN4} for an overview of \TRY and \BIEN data availability. -->
<!-- \end{itemize} -->
<!-- \end{minipage} -->

<!-- \begin{figure}[h!] -->
<!-- \resizebox{.9\textwidth}{!}{\includegraphics[width=\linewidth]{3 - Figures/bien4.jpg}} -->
<!-- \caption[BIEN PFT Coverage]{\textbf{\BIEN \PFT Coverage - }Geo-referenced records within version 4.1 of the \BIEN data base at logarithmic scale\cite{BIENOnline}.} -->
<!-- \label{fig:BIEN4} -->
<!-- \end{figure} -->

\begin{itemize}
\item The \textbf{\COMPADRE}\cite{Salguero-Gomez2015} contains \LHT, a subclass of \PFTs pertaining to life history characteristics (e.g. longevity, reproductive mode, etc.), driven matrix population models which produce important information about community processes through time based on records of different \LHTs\cite{Salguero-Gomez2016}. In its current release (version 5.0.0) it contains over 7,00 matrix models\cite{COMPADREOnline}.
\end{itemize}

Combining information from these data bases should result in a holistic view of global plant function as such an approach would unify \PFTs and \LHTs to further a spatio-temporal understanding of global plant function.

\clearpage

### Putting Plant Function on the Map
Vegetation memory patterns are inherently spatial phenomena\cite{DeKeersmaecker2015,Ogle2015,Vicente-Serrano2013,Liu2018}. So are patterns of plant functioning\cite{Ordonez2015}. Whilst the above mentioned data bases (\TRY, \BIEN, and \COMPADRE) contain vast amounts of geo-referenced \PFT and \LHT records, almost no comprehensive, gapless, and internally consistent global products of plant function are available\cite{Butler2017,Bruelheide2018}. Currently, the most commonly used method for extrapolating \PFT records to local/global map products follows the methodology layed out by Ordonez \& Svenning\cite{Ordonez2015} which has species-specific \PFT means being combined with geo-referenced species occurrences (a conceptual depiction of this can be seen in figure \ref{fig:PFTCombining}).

\begin{figure}[h!]
\includegraphics[width=1\linewidth]{3 - Figures/PFTCombiningbw.png}
\caption[Concept of Combining Plant Functional Trait Information with Species-Distribution Maps]{\textbf{Concept of Combining Plant Functional Trait Information with Species-Distribution Maps - }Conceptual framework of mapping plant function from \PFTs and species distribution maps into gridded map products of mean \PFT expressions. Inspired by Ordonez \& Svenning\cite{Ordonez2015}. Red cells indicate presence of a species, blue and yellow cells depict the average \PFT of species A and B respectively. Green cells represent the average of \PFT means of species A and B whilst white cells denote the absence of species and thus \PFT data.} 
\label{fig:PFTCombining}
\end{figure}

Species occurrence data - referred to as **floral data** in the case of plant occurrences - can be obtained via the \textbf{\GBIF} data base which currently contains over 1 billion geo-referenced occurrence records of species across all kingdoms of life\cite{GBIFOnline}.

Unfortunately, this approach is heavily reliant on geo-referenced occurrence records which are subject to sampling bias\cite{Sandel2015} and renders intra-specific expressions of \PFTs virtually non-existent as species are expressed via single mean values for each \PFT. Zoological studies have resolved these issues by recording relative abundances of species in addition to occurrence records\cite{Newbold2012}.  

Recent approaches in \PFT ecology have seen the development of mapping procedures of \PFTs according to abiotic conditions through linear models with spatial components\cite{Bruelheide2018} and complex Bayesian methods\cite{Butler2017}. No such method is available for extrapolating \LHT records to broader coverage as these come with an added dimension of time.

Despite the obvious short-commings of this mapping method, including \PFT and \LHT data to remote sensing vegetation memory studies is a novel approach in itself. This is built around the notion of vegetation memory being driven not only by antecedent conditions but also by functional characteristics of the local vegetation. Making use of the above \PFT extrapolation method thus serves as an exploratory analyses of how well it performs when trying to extract causal pathways leading to vegetation memory.

\clearpage 

## Thesis Outline
Remote sensing analyses have been the key to identifying vegetation memory patterns through time and space in a multitude of settings\cite{Liu2018,Vicente-Serrano2013,DeKeersmaecker2015}. Refining such approaches will facilitate important knowledge for \dss on environmental processes in the face of climate change as well as changes in land use by mankind\cite{Prestele2016}. Considering the direct link between vegetation memory and ecosystem resilience, this will garner an advanced comprehension of resilience and, in turn, enable maintenance and enhancement of ecosystems' resilience thus aiding to stabilize natural systems. It is therefore the **first main goal** (see figure \ref{fig:Outline} for an overview of how I am planning to achieve the research goals layed out here) of this study to:
\vspace{-.7cm}
\begin{center}
\item \textbf{I. Identify vegetation memory patterns while improving on contemporary approaches.}
\end{center}

To do so, I am going to answer the following research questions while focussing on dryland regions and \era data:
\begin{enumerate}
\item \textit{Using climate reanalysis data, which variables make up robust vegetation memory metrics?}
\item \textit{How well can we distinguish between intrinsic and extrinsic memory?}
\end{enumerate}
\vspace{.1cm}

A multitude of recent studies have identified vegetation memory characteristics of a diverse cast of focal ecosystems\cite{DeKeersmaecker2017,Liu2018,Papagiannopoulou2017a,Seddon2016,Peterson2002,Walter2013,Papagiannopoulou2017,Bell2018}. However, only a few of these have also delineated the ecological processes and causal pathways which have led to the observed patterns of vegetation memory. Achieving an understanding of how functional aspects of vegetation may alter vegetation memory capabilites should serve to bolster our understanding of how resilience comes about and can be maintained. Therefore, the **second main goal** of my thesis is to:

<!-- One notable example of these research efforts is a study by Foley et al. which expanded on the drivers behind the ecosystem collapse of the Sahara and Sahel regions\cite{Foley2003}.  -->

\vspace{-.7cm}
\begin{center}
\item \textbf{II. Determine how vegetation memory and plant function are linked.}
\end{center}

Achieving this goal is possible by answering the following research questions:
\begin{enumerate}
\item \textit{Which traits of biological function (\PFT and \LHT) are related to vegetation memory characteristics?}
\item \textit{What biological traits cause areas to exert intrinsic and extrinsic memory?}
\end{enumerate}

\begin{figure}[h!]
\centering \includegraphics[width=.95\linewidth]{3 - Figures/ThesisOutlinebw.png}
\caption[Study Outline]{\textbf{Study Outline - }Conceptual study flow-chart. Data sets and products are shown in boxes with solid outlines whilst data handling and computational procedures are depicted via dashed-outline boxes.} 
\label{fig:Outline}
\end{figure}



# Material \& Methods

## Study Regions  

The spatial extent of study sites for assessing vegetation memory effects was limited to regions which were (1) suitable for remote sensing studies (i.e. receive satellite coverage year-round), (2) relatively well-sampled in terms of \PFTs, \LHTs and floral data, and (3) contain large areas classified as \textbf{drylands} (as classified via ombrotypes within Rivas-Martínez et al.\cite{Rivas-Martinez2011}) which previous studies identified as regions of strong memory effects given autoregressive approaches. Within `R`, limiting to study regions is done using shapefiles (\url{http://www.naturalearthdata.com/downloads/10m-cultural-vectors/}) and the `rgdal`\cite{R-rgdal} package (see \ref{rFunctions}).

### Iberian Region

The Iberian region - encompassing Portugal, Spain, Andorra and France within this study - has been selected as a study region due to a clear gradient in ombrotypes (see figure \ref{fig:OmbroEU}), its high density of \TRY \PFT and \COMPADRE \LHT data availability, and previously reported clear patterns of vegetation memory effects\cite{DeKeersmaecker2015} and vegetation sensitivity\cite{Seddon2016}. See figures \ref{fig:IBPDataOverview} and \ref{fig:IBPTRY} for an overview of \gimms \ndvi, \era data, and \TRY \PFT data (both raw and extrapolated) across the Iberian region.

\begin{figure}[h!]
\centering \includegraphics[width=.82\linewidth]{3 - Figures/Ombro_EU.png}
\caption[European Ombrotpyes]{\textbf{European Ombrotpyes - }Regions of mean precipitation rates of biological relevance across Europe according to Rivas-Martínez et al.\cite{Rivas-Martinez2011} and retrieved via the Worldwide Bioclimatic Classification System\cite{OmbroEU}. The Iberian Region is marked with a red rectangle.}
\label{fig:OmbroEU}
\end{figure}

\clearpage

### Caatinga, Brazil

The Caatinga in Brazil - a dryland region located within northeastern Brazil - has been selected as a study region due to a predominance in dry ombrotypes and gradients of ombrotypes at its edges  (see figure \ref{fig:OmbroSA}) as well as previously identified strong vegetation memory effects\cite{DeKeersmaecker2015}. Additionally, Seddon et al. identified strong vegetation sensitvity towards water availability across this region\cite{Seddon2016}. 

\begin{figure}[h!]
\centering \includegraphics[width=1\linewidth]{3 - Figures/Ombro_SA.png}
\caption[South-American Ombrotpyes]{\textbf{South-American Ombrotpyes - }Regions of mean precipitation rates of biological relevance across South-America according to Rivas-Martínez et al.\cite{Rivas-Martinez2011} and retrieved via the Worldwide Bioclimatic Classification System\cite{OmbroSA}. The Caatinga is marked with a red rectangle.}
\label{fig:OmbroSA}
\end{figure}

See figures \ref{fig:CaatDataOverview} and \ref{fig:CaatTRY} for an overview of \gimms \ndvi, \era data, and \TRY \PFT data (both raw and extrapolated) across the Caatinga.

\clearpage

### Australia

Australia has been selected as a study region due to a predominance in dry and even arid ombrotypes as well as gradients of ombrotypes on its eastern coast  (see figure \ref{fig:OmbroAU}). Previous studies have identified clear patterns of vegetation memory (overall strong memory with the strongest vegetation memory throughout the outback\cite{DeKeersmaecker2017,DeKeersmaecker2015}), vegetation sensitivity (highest autoregressive coefficients in western Australia, and strongest vegetation-water sensitivity in western Australia\cite{Seddon2016}), and water memory length and strength (strongest water memory in northern Australia, shortest memory in eastern Australia\cite{Vicente-Serrano2013}) across Australia.

\begin{figure}[h!]
\centering \includegraphics[width=1\linewidth]{3 - Figures/Ombro_AU.png}
\caption[Australasian Ombrotpyes]{\textbf{Australasian Ombrotpyes - }Regions of mean precipitation rates of biological relevance across Australasia according to Rivas-Martínez et al.\cite{Rivas-Martinez2011} and retrieved via the Worldwide Bioclimatic Classification System\cite{OmbroAU}.}
\label{fig:OmbroAU}
\end{figure}

See figures \ref{fig:AUDataOverview} and \ref{fig:AUTRY} for an overview of \gimms \ndvi, \era data, and \TRY \PFT data (both raw and extrapolated) across Australia.

\clearpage

## Identifying Vegetation Memory 
<!-- Identifying vegetation memory requires intrinsic data (e.g. proxies of vegetation performance), and extrinsic data (e.g. climate/weather indices)\cite{Ogle2015,DeKeersmaecker2015}. Measures of plant function or life histories (i.e. \PFTs and \LHTs) of local vegetation may be useful in uncovering causal pathways leading to vegetation memory behaviour. -->

### Data
#### Vegetation Indices
Patterns of vegetation characteristics - both in time and space - can be readily assessed using remote sensing approaches\cite{Seddon2016,Nioti2015,Prince1995,Garroutte2016,DeKeersmaecker2017,Cammarano2014,Friedl2002}.  A \vi is a remote sensing proxy for different vegetation characteristics depending on the choice of \vi. \vis have seen various applications in remote sensing including deriving vegetation dynamics on the scale of countries\cite{Evrendilek2008,Colditz2012,Prasad2007} or regions\cite{Cammarano2014,Stow2004}, and analysing resilience of vegetation assemblages to short-term climate anomalies\cite{DeKeersmaecker2015}. Biome classifications have undoubtedly been one of the most prominent usages of the \vis\cite{Chen2007,Friedl2002, Lieng2002,Friedl2010} as have applications in agriculture\cite{Devadas2009,Ares2001}.

Whilst a vast arsenal of \vis are available to macroecologists (see Cammarano et al. for an overview\cite{Cammarano2014}), one of the main considerations in  choosing an appropriate \vi is that of **spatial resolution versus length of time series**. As satellite-born sensors receive hardware updates or other improvements - e.g. \avhrr versus \modis sensors - spatial resolution capabilities of \vis increase. However, we can't enhance the resolution of older records of \vis and are thus limited to lower resolution \vis if longer time series are desired. Since vegetation memory is a temporal phenomenon first and foremost, I have prioritised **time series length** over spatial resolution. Within the confines of my thesis, \vis represent the intrinsic characteristics of vegetation systems which will be used both as response and explanatory variables as outlined in figure \ref{fig:SchemaVegMem}.

\paragraph*{Normalised Difference Vegetation Index (NDVI)}  \hspace{.5cm}

The \ndvi has been selected as a proxy of vegetation characteristics in this study due to (1) its nature as an information criterion of biomass\cite{Fuller1996} and vegetation cover\cite{Cammarano2014} (indicators of vegetation performance and composition), (2) the availability of a long time series data with global coverage\cite{Pinzon2014}, and (3) its demonstrated utility in various ecosystem studies\cite{Garroutte2016} including assessments of vegetation sensitivity and memory\cite{Vicente-Serrano2013,Seddon2016,DeKeersmaecker2015}. See table \ref{tab:NDVICore} for an overview of the core characteristics of the \ndvi data set.

Rouse et al.\cite{Rouse1974} first introduced the \ndvi in 1974 and initially coined it 'Vegetation Index'. The \ndvi is a composite \vi that factors in measurements in the near infra-red wave band (NIR, 0.58-0.68 $\mu$m) and the red wave band (RED, 0.75-1.10 $\mu$m). These bands belong to the spectrum of light that is absorbed by chlorophyll and thus provide information on green vegetation\cite{Hao2008}. The formula for \ndvi is as follows\cite{Evrendilek2008,Hao2008}:

\begin{equation}
NDVI = \frac{\rho\textsubscript{NIR} - \rho\textsubscript{RED}}{\rho\textsubscript{NIR} + \rho\textsubscript{RED}}
\end{equation}

with $\rho_{NIR}$ being the reflection in the NIR band (reflectance from vegetation) and $\rho_{RED}$ being the reflection in the RED band (background/dead biomass reflectance). The \ndvi is bound between 0 and 1 with higher values representing denser vegetation. For a more detailed mathematical background on the calculation of \ndvi scores see Matsushita et al\cite{Matsushita2007}.  

\renewcommand{\arraystretch}{1}
\begin{table*}[h!]
  \centering
  \caption[Core Information about NDVI data]{\textbf{Core Information about NDVI data -} Characteristics of the \gimms NDVI3g data set (v.1).}
    \begin{tabular}{|L{4cm}L{12.5cm}|}
    \hline
    \bfseries Characteristic  & \bfseries Data\\
    \hline
    \textit{Resolution} & $0.083^\circ \times 0.083^\circ \sim 9.27km \times 9.27km$\\
    \textit{Time Series} & Bi-weekly intervals from January 1982 to December 2015 \\
    \textit{Source} & \url{https://ecocast.arc.nasa.gov/data/pub/gimms/3g.v1/} \\
    \hline
    \end{tabular}
  \label{tab:NDVICore}
\end{table*}

\clearpage

\ndvi data sets are readily available via the \gimms. For this study the GIMMS3g data set was used (available at \url{https://ecocast.arc.nasa.gov/data/pub/gimms/3g.v1/}), which provides \avhrr NDVI data as 15-day maximum-value composites from 1982 to 2015 at $0.083^\circ \times 0.083^\circ$ resolution\cite{Higgins2016}. The data was processed in `R`, downloaded and compiled into monthly composites using the raster\cite{R-Raster} and `gimms` package\cite{R-Gimms}. See figure \ref{fig:NDVIOverview} for a representation of one such global monthly composite. \ref{rGimms} contains the `R`-code used to process the data. 

```{r NDVIOverview, echo = FALSE, fig.width = 17, fig.height = 9.5, fig.cap="\\textbf{Global Representation of the Normalised Difference Vegetation Index (NDVI) -} Mean of monthly maximum composite representations of \\ndvi from January 1982 to December 2015 at global coverage. Higher values of \\ndvi indicate higher vegetation coverage, plant biomass, and primary production. Figure established via \\ref{rNDVIOverview}. \\label{fig:NDVIOverview}", fig.scap="Global Representation of the Normalised Difference Vegetation Index (NDVI)", out.extra='',fig.pos = 'h', cache = TRUE, cache.lazy=FALSE}
setwd(Dir.Gimms.Monthly)
NDVIMean_ras <- mean(brick(list.files()[1:7]), na.rm = TRUE)
plot(NDVIMean_ras, colNA = "black", main = "Mean NDVI 1982 - 2015", cex.main = 2, 
     legend.width = 1.5, legend.shrink=1, axis.args=list(cex.axis=1.5), cex.axis = 1.5
     )
```


\clearpage

#### European Centre for Medium-range Weather Forecasts ReAnalysis 5 (ERA5)
\label{sEra}

Extrinsic memory effects have largely been understood through processes of drought and water limitation\cite{Rudgers2018,Munne-Bosch2013,Gazol2018,Walter2013,Liu2018}. Hence a large number of contemporary studies of vegetation memory have included some form of water availability proxy, through precipitation records\cite{Papagiannopoulou2017a,Seddon2016}, or drought indices\cite{Liu2018,DeKeersmaecker2017,DeKeersmaecker2015}. Additionally, temperature has been found to be a major driver of drought severity, plant morphology, and vegetation memory effects\cite{Esper2015,Papagiannopoulou2017a,Seddon2016}. \era data is implemented into my analyses of vegetation memory using two environmental characteristics: (1) Soil Moisture (in four layers), and (2) Air Temperature (at a height of 2m above the ground). See table \ref{tab:ERA5Core} for an overview of core characteristics of the \era data set. See \ref{ObtainEra5}, \ref{ProcessEra5}, and \ref{RegridEra5} for the codes used to download \era data from the \ecmwf servers, aggregate data to full time series and fix gridding mismatches to be comparable to \gimms data.

\renewcommand{\arraystretch}{1}
\begin{table*}[h!]
  \centering
  \caption[Core Information about ERA5 data]{\textbf{Core Information about ERA5 data -} Characteristics of the ERA5 data set.}
    \begin{tabular}{|L{4cm}L{12.5cm}|}
    \hline
    \bfseries Characteristic  & \bfseries Data\\
    \hline
    \textit{Resolution} & $\sim 30km \times 30km$\\
    \textit{Time Series} & Hourly intervals from January 1950 to TODAY \\
    \textit{Source} & \url{https://apps.ecmwf.int/data-catalogues/era5} \\
    \hline
    \end{tabular}
  \label{tab:ERA5Core}
\end{table*}

\paragraph*{Air Temperature recorded in $K$}  \hspace{.5cm}

Temperature indices have been linked successfully to vegetation sensitivity\cite{Seddon2016}, tree-ring growth\cite{Esper2015,Pagotto2015}, global primary production\cite{Prince1995}, as well as severe drought events with possibly devastating consequences to local vegetation\cite{Allen2010}. \era incudes several temperature variables (e.g. soil, snow and air temperature)\cite{ECMWF2018c}. Within this study, I  use \tair as contained within the \era data set, due to the demonstrated impact of \tair on different aspects of plant physiology and plant morphology which may manifest in vegetation memory effects. See figure \ref{fig:ATOverview} for an overview of the \era \tair data.

```{r ATPlot, echo = FALSE, fig.width = 17, fig.height = 9, fig.cap="\\textbf{Overview of air temperature data -} Air temperature data presented as obtainable via the ERA5 reanalysis product (\\tair). Figure established via \\ref{rATOverview}. \\label{fig:ATOverview}", fig.scap="Overview of air temperature data", out.extra='',fig.pos = 'h', cache = TRUE, cache.lazy=FALSE}
Variable <- c("Tair")
colour = col.tair
setwd(Dir.ERA)
Era5ras <- mean(brick(list.files()[grep(pattern = Variable, list.files())]), na.rm = TRUE)
values(Era5ras)[which(is.na(values(Elevation)))] <- NA
plot(Era5ras, colNA = "black", main = paste("Mean", SR_Titles[2], "1980 - 2015"), 
     cex.main = 2, legend.width = 1.5, legend.shrink=1, 
     axis.args=list(cex.axis=1.5), cex.axis = 1.5, col = colour, legend = TRUE)
```

\clearpage

\paragraph*{Soil Moisture (Qsoil) recorded in $\frac{m^3_{H_2O}}{m_{soil}^3}$}  \hspace{.5cm}

\vspace{.2cm}

My study uses \textit{\qsoil} as a proxy of local water regimes. I suggest that water-dependent vegetation memory largely relies on water availabilit to root systems. Precipitation events are subject to further soil processes such as pore connectivity for precipitation water to be available to plant roots\cite{Smith2017}. Soil moisture should thus serve as a much more direct proxy of local water regimes. Additionally, \era includes four distinct layers in the soil for the calculation of \qsoil indices (see figure \ref{fig:QsoilOverview} for an overview): (1) \qsoila, (2) \qsoilb, (3) \qsoilc, and (4) \qsoild. Typical drought indices (i.e. \spei) do not allow for this additional distinction.

Within \era, unfrozen ground water ($\theta$) across all four soil layers ($k$) is defined as:

\begin{equation}
\overline{\theta} = \sum_{k=1}^4 (R_k * max[f_{liq;k}\theta_k, \theta_{pwp}])
\end{equation}

with $R_k$ being the root fraction of soil layer $k$ which is a fixed metric according to \lccss, and the statement $max[f_{liq;k}\theta_k, \theta_{pwp}]$ calculating the amount of unfrozen soil water in soil layer $k$. $f_{liq;k}$ is a parametrised function of soil temperature; $\theta_{pwp}$ denotes the permanent wilting point according to soil texture. For a more in-depth explanation of how \qsoil is calculated within \era, see the IFS Documentation CY45R1 Chapter 4 \textit{Physical Processes}\cite{ECMWF2018c}.

```{r QsoilPlot, echo = FALSE, fig.width = 17, fig.height = 10.2, cache = TRUE, cache.lazy=FALSE}
Variable <- c("Qsoil1", "Qsoil2", "Qsoil3", "Qsoil4")
colour = col.qsoil
par(mfrow = c(2,2))
setwd(Dir.ERA)
Era_list <- list(NA, NA, NA, NA)
for(i in 1:4){
  Era5ras <- mean(brick(list.files()[grep(pattern = Variable[i], list.files())]), na.rm = TRUE)
  values(Era5ras)[which(is.na(values(Elevation)))] <- NA
  Era_list[[i]] <- Era5ras
}
Era5ras <- brick(Era_list)
Era5ras[1] <- max(Era5ras)@data@max
for(i in 1:4){
  plot(Era5ras[[i]], colNA = "black", main = paste("Mean", SR_Titles[i+2], "1980 - 2015"), 
       cex.main = 2, legend.width = 1.5, legend.shrink=1, 
       axis.args=list(cex.axis=1.5), cex.axis = 1.5, col = colour, legend = FALSE)
}
```

\vspace{-1.5cm}
```{r QsoilPlot2, echo = FALSE, fig.width = 17, fig.height = 2, fig.cap="\\textbf{Overview of soil moisture data -} Soil moisture data presented in layers as obtainable via the ERA5 reanalysis product (\\tair, \\qsoila, \\qsoilb, \\qsoilc, \\qsoild). Figure established via \\ref{rQsoilOverview}. \\label{fig:QsoilOverview}", fig.scap="Overview of soil moisture data", out.extra='',fig.pos = 'h', cache = TRUE, cache.lazy=FALSE}
par(mfrow = c(1,1))
plot(Era5ras[[4]], legend.only=TRUE, smallplot=c(0.05,.95,.2,.35), horizontal = TRUE, axis.args=list(cex.axis=2.5), col = col.qsoil, legend.args = list(text='Soil Moisture', side = 3, line = .1, cex = 2))
```

\clearpage

#### Digital Elevation Models

\dem data preparation as outlined in section \ref{S:DataPrep} To this end, I am using \dem data obtained via the  \hwsd which contains different \dem outputs at 3 and 30 arc-second resolution\cite{Ele30,Ele3}. See table \ref{tab:HWSDCore} for an overview of \hwsd \dem data characteristics. For an overview of all variables from the \hwsd used within this study see table \ref{tab:HWSDOverview}. See figure \ref{fig:EleOverview} for a global representation of \hwsd \dem data and figure \ref{fig:HWSDAOverview} and \ref{fig:HWSDIOverview} for an overview of \hwsd slope aspect and incline data respectively as described in table \ref{tab:HWSDOverview}. These haven been rescaled to match \gimms resolution (see table \ref{tab:NDVICore}).

\renewcommand{\arraystretch}{1}
\begin{table*}[h!]
  \centering
  \caption[Core Information about HWSD data]{\textbf{Core Information about HWSD data -} Characteristics of the HWSD data set.}
    \begin{tabular}{|L{4cm}L{12.5cm}|}
    \hline
    \bfseries Characteristic  & \bfseries Data\\
    \hline
    \textit{Resolution} & $3arc \times 3arc \sim 31m \times 31m$\\
    \textit{Source} & \url{http://www.fao.org/soils-portal/soil-survey/soil-maps-and-databases/harmonized-world-soil-database-v12/en/} \\
    \hline
    \end{tabular}
  \label{tab:HWSDCore}
\end{table*}

```{r CovPlot, echo = FALSE, fig.width = 17, fig.height = 9.5, fig.cap="\\textbf{DEM elevation data -} \\hwsd elevation data at \\gimms resolution. Figure established via \\ref{rEleOverview}. \\label{fig:EleOverview}", fig.scap="DEM elevation data", out.extra='',fig.pos = 'h', cache = TRUE, cache.lazy=FALSE}
plot(ElevationF, colNA = "black", cex.main = 2, legend.width = 1.5, legend.shrink=1, axis.args=list(cex.axis=1.5), cex.axis = 1.5, legend = TRUE, col = terrain.colors(100), main = "DEM at GIMMs native resolution")
```

\clearpage

### Analyses

#### Data Preparation
\label{S:DataPrep}

\paragraph*{Monthly Maximum Composites}  \hspace{.5cm}
After retrieving \gimms \ndvi 3g data using the `gimms` package in `R`, bi-weekly \ndvi data is aggregated to monthly composites using the *maximum composite* method (see \ref{rGimms}). Doing so is a method for removing data uncertainty due to atmospheric interference which has seen application in recent remote-sensing-based studies of vegetation memory and resilience\cite{Gazol2018,Liu2018,Vicente-Serrano2013}.

\paragraph*{Downscaling} \hspace{.5cm}
In order to calculate vegetation memory effects (**first research goal**), vegetation data and abiotic data should be represented at the same spatial and temporal resolution. Whilst both \ndvi and \era data are available at monthly intervals (after pre-processing as already described), their spatial resolutions differ (e.g. $\sim 9.27km \times \sim 9.27km$, vs. $30km \times 30km$, respectively; see tables \ref{tab:NDVICore} and \ref{tab:ERA5Core}).  

There are two ways of remedying this spatial mismatch: (1) aggregating \gimms data to the coarser resolution of \era data, or (2) downscaling of \era data to \gimms resolution. Whilst aggregating data to coarser resolutions is much easier and less computationally expensive, I have opted to apply **downscaling** to the \era data used within my study so as to retain valuable information within the \gimms \ndvi 3g data set. This will allow more precise vegetation memory identification and result in more biologically relevant patterns of vegetation memory characteristics.  

A large host of downscaling methods are available and before choosing any method one has to settle on whether to perform *statistical* or *dynamic* downscaling\cite{Trzaska2014,Onyutha2016}:

\begin{enumerate}
\item \textit{Statistical Downscaling} makes use of statistical links between global and local climate patterns\cite{Maraun2010}, comparatively computationally cheap and easily transferable to different study regions, but suffers from a strong dependency on the choice of predictors/co-variates\cite{Fowler2007}.
\item \textit{Dynamic Downscaling} is built around regional climate models being implemented into global climate models\cite{Maraun2010} (in this case, dynamical models with boundary conitions obtained via \era), produces results based on physically consistent processes but computationally expensive\cite{Fowler2007}.
\end{enumerate}

This study is focussed on three study regions (i.e. the Iberian Region, the Caatinga, and Australia) and five \era variables (\tair, \qsoila, \qsoilb, \qsoilc, and \qsoild) in monthly intervals from 1981 to 2015. \era data from 1981 is being downscaled to match \gimms resolution to calculate cumulative lags of memory effect drivers (see section \ref{sMemMods}). With this, downscaling needs to be performed three times (study regions), for five variables, each with 420 individual time steps (twelve months per year times 35 years). In total, the downscaling process is thus required to be run 6,300 times. Using a computationally expensive method such as dynamical downscaling is thus undesireable and I have elected to employ a **statistical downscaling** method to match \era data with \gimms resolution.  

More specifically, I am using **Kriging** - a method that is well-understood and has long been used in non-biological sciences for geostatistical interpolation purposes\cite{Hengl2011}. Kriging is a two-step process. First, one establishes statistical relationships between data which is to be kriged at its native resolution with covariate data at the same resolution. The second step sees the extrapolation of these relationships using  covariate data at the  target resolution. The way in which Kriging marks an improvement over other statistical downscaling methods centred around these two steps lies in the fact that the Kriging methodology not only *extrapolates* relationships but *residuals* as well (see figure \ref{fig:Krig} for a visual representation).

\clearpage

Therefore, Kriging within my analyses requires three inputs: (1) \era data at native resolution, (2) \hwsd covariates (see table \ref{tab:HWSDOverview}) at \era resolution, and (3) \hwsd covariates (see table \ref{tab:HWSDOverview}) at \gimms resolution to produce sets of \era data at \gimms resolution. Kriging operations are built around formulae which establish response and predictor relationships. My kriging approaches are specified as follows:

\begin{equation}
\label{eKrig}
Var_{ERA5} = \alpha + \sum_{i = 1}^{14}(\beta_i * Cov_{HWSD;i})
\end{equation}

with $Var_{ERA5}$ identifying any of the five \era variables \tair, \qsoila, \qsoilb, \qsoilc, or \qsoild at any given monthly interval between January 1981 and December 2015. $Cov_{HWSD;i}$ indexes the $i^{th}$ \hwsd covariate ranging from elevation and slope aspects to slope incline levels. Due to computational expense the kriging procedure only considers interaction effects between slope incline levels and slope aspects (not shown in equation \ref{eKrig}, see \ref{rEra5}).

\begin{figure}[h!]
\centering \includegraphics[width=1\linewidth]{3 - Figures/Kriging.jpg}
\caption[Kriging Concept]{\textbf{Kriging Concept - } Statistical downscaling effects of Tair for the time step of January 1981 using \hwsd covariate data across the Iberian Region. Diagram source: Le Riche et al., 2012\cite{LeRiche2012}. Some parts of this figure have been generated via \ref{rFigs}.}
\label{fig:Krig}
\end{figure}

For an in-depth mathematical explanation of the Kriging methodology, see Hengl, 2011\cite{Hengl2011}. A practical example of its use can be retrieved in Lichtenstern, 2013\cite{Lichtenstern2013}.

\clearpage

#### Memory Models
\label{sMemMods}

\begin{enumerate}
  \item \textit{Vegetation Memory Coefficients} to identify intrinsic/extrinsic forcing factors answering \textit{research question I.1}. 
  \item \textit{Model Comparisons} and \textit{Variance Partitioning} to assess relative importance of different factors answering \textit{research question I.1} and \textit{I.2}.
\end{enumerate}

\paragraph*{Vegetation Memory Coefficients}  \hspace{.5cm}
The vegetation memory analyses in this study have been informed heavily by DeKeersmaecker et al\cite{DeKeersmaecker2015}. Vegetation memory models of this study are built upon the following basic specification:
\vspace{-.2cm}
\begin{equation}
\label{eqMemMod}
NDVI_t = \beta_{t-1}*NDVI_{[t-1]} + \beta_{Qsoil}*Qsoil_{k;m} + \beta_{Tair}*Tair_{t}
\end{equation}
with $NDVI_t$ and the \ndvil being standardised \ndvi anomalies at time step $t$ and $t-1$, respectively; $Qsoil_{k;m}$ denoting \qsoil data at depth level $k$ (translating to \qsoila - \qsoild) and cumulative lag of standardised anomalies of lag $m$, and $Tair_t$ denoting \tair data at time $t$. See table \ref{tab:CoeffsOverview} for an interpretation of the model coefficients. The duality of memory effects as *intrinsic* and *extrinsic* as proposed by Ogle et al.\cite{Ogle2015} is embraced as follows:

\begin{enumerate}
\item \textbf{Intrinsic Memory} is identified as coefficients of \ndvil\cite{DeKeersmaecker2015,Liu2018} (see model formula \ref{eqMemMod}).
\item \textbf{Extrinsic Memory} are implemented via \era data. See section \ref{sEra} for the rationale behind the inclusion of the different variables and model formula \ref{eqMemMod} for how they are included in vegetation memory models.
  \begin{enumerate}
  \item \textit{\tair} is implemented as an \textit{instantaneous} effect on plant performance.
  \item \textit{\qsoila - \qsoild} effects are implemented as \textit{cumulative lag} effects ranging from instantaneous impacts to lags on annual time windows\cite{Vicente-Serrano2013}.
  \end{enumerate}
\end{enumerate}

\renewcommand{\arraystretch}{1}
\begin{table*}[h!]
  \centering
  \caption[Interpretation of Memory Model Coefficients]{\textbf{Interpretation of Memory Model Coefficients -} Biological Interpretation of Vegetation Memory Coefficients as portrayed in model formula \ref{eqMemMod}.}
    \begin{tabular}{|L{1.7cm}L{5.5cm}L{9cm}|}
    \hline
    \bfseries Coefficient  & \bfseries Magnitude & \bfseries Sign \\
    \hline
    $\mathbf{\beta_{t-1}}$ & Absolute values depict the speed at which systems return to equilibrium/pre-disturbance state. Large absolute values indicate low resilience (i.e. slow return). & \textit{Positive} - \ndvi anomalies resemble previous ones. \ndvi anomalies gradually diminish over time. \linebreak
\textit{Negative} - \ndvi anomalies resemble previous ones, but with the opposite sign. The return to pre-disturbance is characterised through oscillations. \\
    $\mathbf{\beta_{Qsoil}}$ & Absolute values depict the resistance to anomalies in \qsoil. Large absolute values indicate low resistance (i.e. strong vegetation responses) to \qsoil anomalies. & \textit{Positive} - Wetter soil conditions than average induce positive \ndvi anomalies; drier soil conditions than average induce negative \ndvi anomalies. \linebreak
\textit{Negative} - Drier soil conditions than average induce positive \ndvi anomalies; wetter soil conditions than average induce negative \ndvi anomalies. \\
  $\mathbf{\beta_{Tair}}$ & Absolute values depict the resistance to anomalies in air temperature. Large absolute values indicate low resistance (i.e. strong vegetation responses) to air temperature anomalies. & \textit{Positive} - Warmer air temperature than average induces positive \ndvi anomalies; colder air temperature than average induces negative \ndvi anomalies. \linebreak
\textit{Negative} - Colder air temperature than average induces positive \ndvi anomalies; warmer air temperature than average induces negative \ndvi anomalies. \\
    \hline
    \end{tabular}%
  \label{tab:CoeffsOverview}%
\end{table*}

Additionally, $\mathbf{\beta_{t-1}}$ is indicative of *intrinsic vegetation memory*\cite{DeKeersmaecker2015}.

\clearpage

The coefficients of the above drivers of vegetation memory (see table \ref{tab:CoeffsOverview} and formula \ref{eqMemMod}) are identified for each data pixel in the data rasters of the three study regions in four separate models (one for each \qsoil layer). A visual representation of the automated modelling approach used within this study can be seen in figure \ref{fig:ModScheme}. This approach is carried out for each pixel as follows using the code contained within \ref{rVegMem}:

\begin{enumerate}
\item Data for each variable (\ndvi, \tair, \qsoil) is \textbf{extracted and detrended} using linear detrending with the pracma package in `R` to avoid effects of changing abiotic conditions over long time-series\cite{DeKeersmaecker2015}.
\item Detrended data is \textbf{standardised to Z-Scores} to obtain deviations of monthly means/monthly anomalies for each variable\cite{DeKeersmaecker2015}:
\begin{equation}
Anomaly_{i} = \frac{Detrended_{i} - \overline{Detrended_{month}}}{SD_{Detrended, month}}
\end{equation}
with $i$ indexing individual, detrended data records. In the case of \ndvi, one additionally calculates monthly means of untreated \ndvi data across the entire data range. See figure \ref{fig:NDVIMemMod} for an examplary overview of \ndvi data treatment.
\item Calculation of \textbf{lagged effects}:
\begin{enumerate}
  \item \ndvil is calculated from Z-Score \ndvi data.
  \item Cumulative lags of \qsoil data are established for lags ranging from 0 (instantaneous effects) to annual effects (aggregated over twelve months of detrended \qsoil records) in steps on one month at a time. These lagged effects are subsequently standardised to Z-Scores. See figure \ref{fig:QsoilMemMod} for an examplary overview of \qsoil data treatment.
  \item \tair data is implemented as instantaneous effects and so no lagged effects have to be calculated. Technically, this means that \tair-driven vegetation responses aren't memory effects in the sense of antecedent conditions influencing present ones. I will refer to these effects as memory effects nonetheless for the sake of brevity. 
  \end{enumerate}
\item Variables in nature are often collinear\cite{Butler2017,Goldsmith2018}. Failing to address this issue results in masking of information which might influence our understanding of processes in nature significantly\cite{Zuur2007}. One method of circumventing this issue lies with \textit{\pca}. More specifically, if regression modelling is the target, one may wish to employ \textbf{\pca regression} as a three-step process\cite{Zuur2007} for each of the cumulative \qsoil lags across all four \qsoil layers, effectively adding the necessity for a model selection step:
  \begin{enumerate}
  \item Z-Score data for \ndvi, \tair, and \qsoil are fed to \pca via the vegan package in R. See figure \ref{fig:ExMod} for an examplary overview of data and a \pca result.
  \item Regression is performed as follows:
  \begin{equation}
  NDVI_t = \beta_1 * PC_1 + \beta_2 * PC2 + \beta_3 * PC3
  \end{equation}
  with $NDVI_t$ representing NDVI anomalies which have been set to NA (skipped in models) in months for which $Thresholds_{i} < 0.1$ with $Thresholds_{i} = \overline{Raw_{NDVI, month}}$\cite{Liu2018}. $PC_1$ through $PC_3$ and $\beta_1$ through $\beta_3$ indicate principal components 1 through 3 and coefficients of their effects in the model respectively.
  \item Model selection is performed to identify the cumulative soil lag which presents the most explanatory power through comparison of model \aic values. The model with the \aic closest to 0 is determined to be performing the best\cite{Cailleret2016}. This results in a proxy of \qsoil memory length of local vegetation.
  \item The regression coefficients $\beta_1$ through $\beta_3$ can be back-transformed to represent \pca input variable effects (see formula \ref{eqMemMod}) using \pca loadings and \pca model coefficients (see figure \ref{fig:PCAREG}).
  \end{enumerate}
\end{enumerate}

\clearpage

\begin{figure}[t!]
\centering \includegraphics[width=1\linewidth]{3 - Figures/ModScheme.jpg}
\caption[Vegetation Memory Model Flowchart]{\textbf{Vegetation Memory Model Flowchart - } Visual workflow of pixel-wise iterated vegetation memory model. $m$ denotes the currently considered cumulative lag of \qsoil data with $M$ being the maximum cumulative lag. \qsoil layers \qsoila - \qsoild are identified via $k$. $L_1$ through $L_3$ are the loadings of each detrended and standardised variable (\ndvi, \tair, and \qsoil) onto the principal components 1 through 3, respectively. \pca model coefficients are identified as $\beta_1$ through $\beta_3$. $l$ denotes the cumulative \qsoil lag offering the most explanatory power in terms of \aic values of \pca regression models and is thus a proxy for vegetation memory in terms of \qsoil.}
\label{fig:ModScheme}
\end{figure}

\vspace{-4cm}

```{r VegMemNDVI, echo = FALSE, fig.width = 17, fig.height = 8, fig.subcap=c('NDVI Time-Series (Untreated and Detrended)', 'Monthly Means of Untreated NDVI Data with 0.1 Threshold', 'Standardised Detrended NDVI Data (Z-Scores)', 'Plotting Colour Reference'), fig.ncol = 2, out.width='.5\\linewidth', fig.cap="\\textbf{Memory Model NDVI Data Treatment -} Overview of \\ndvi data treatment as outlined in figure \\ref{fig:ModScheme} and explained above. The data presented here represents a single pixel in the Iberian dryland region (see figure \\ref{fig:ExMod}). Figure established via \\ref{rVegMemNDVI}. \\label{fig:NDVIMemMod}", fig.scap="Memory Model NDVI Data Treatment", cache = TRUE, cache.lazy=FALSE, fig.pos = 'h!'}
## load data
IbRas <- grep(list.files(Dir.Gimms.Monthly), pattern = "Iberian Region")
IBNDVI <- brick(paste(Dir.Gimms.Monthly, list.files(Dir.Gimms.Monthly)[IbRas], sep="/"))
## extract data
NDVI_vecraw <- as.vector(IBNDVI[35363])
NDVI_vecdet <- detrend(NDVI_vecraw, tt = 'linear') # linear detrending
NDVI_df <- data.frame(Month = rep(1:12, length(NDVI_vecraw)/12), NDVI_raw = NDVI_vecraw, NDVI_de = NDVI_vecdet) # create NDVI data frame
## calculate anomalies (Z-scores) and monthly means
NDVI_df <- transform(NDVI_df,
                     NDVI_Anomalies = ave(NDVI_de, Month, FUN=scale),
                     NDVI_Threshold = ave(NDVI_raw, Month, FUN=function(t) mean(t, na.rm=TRUE)))
## plotting data frame
NDVIplot_df <- data.frame(NDVI = c(NDVI_vecraw, NDVI_vecdet, 
                                   NDVI_df$NDVI_Anomalies,
                                   NDVI_df$NDVI_Threshold[1:12]),
                          Ident = c(rep("Raw Data", length(NDVI_vecraw)),
                                    rep("Detrended", length(NDVI_vecraw)),
                                    rep("Z-Scores", length(NDVI_vecraw)),
                                    rep("Monthly Means", 12)),
                          Months = c(rep(1:length(NDVI_vecraw), 3), 1:12))
## raw and detrended
ggplot(NDVIplot_df[1:(length(NDVI_vecraw)*2),], aes(x = Months, y = NDVI, col = Ident)) + geom_line(size = 2) + theme_bw(base_size = 35) + theme(legend.position = "none") + scale_color_manual(values=c("orange", "forestgreen"))
## monthly means
ggplot(NDVIplot_df[(length(NDVI_vecraw)*3+1):(dim(NDVIplot_df)[1]),], aes(x = as.factor(Months), y = NDVI, col = Ident)) + geom_bar(stat="identity", fill = "forestgreen") + theme_bw(base_size = 35) + theme(legend.position = "none") + scale_color_manual(values=c("forestgreen")) + xlab("Months") + geom_hline(aes(yintercept=.1), size = 1.5)
## z-scores
ggplot(NDVIplot_df[(length(NDVI_vecraw)*2+1):(length(NDVI_vecraw)*3),], aes(x = Months, y = NDVI, col = Ident)) + geom_line(size = 2) + theme_bw(base_size = 35) + theme(legend.position = "none") + scale_color_manual(values=c("purple"))
## legend
leg <- ggplot(NDVIplot_df[1:(length(NDVI_vecraw)*3),], aes(x = Months, y = NDVI, col = Ident)) + geom_line(size = 2) + scale_color_manual(values=c("orange", "forestgreen", "purple")) + theme_bw(base_size = 65) + 
  guides(colour = guide_legend(override.aes = list(size=20))) + labs(col='GIMMs NDVI 3g data')
legend <- cowplot::get_legend(leg)
grid.newpage()
grid.draw(legend)
```

\clearpage

```{r VegMemQsoil, echo = FALSE, fig.width = 17, fig.height = 8, fig.subcap=c('Qsoil1 Time-Series (Untreated and Detrended)', 'Standardised Detrended Qsoil1 Data (Z-Scores)', 'Cummulative Qsoil1 Lags', 'Plotting Colour Reference'), fig.ncol = 2, out.width='.5\\linewidth', fig.cap="\\textbf{Memory Model Qsoil Data Treatment -} Overview of \\qsoil data treatment as outlined in figure \\ref{fig:ModScheme} and explained above. Only \\qsoila data is represented. The data presented here represents a single pixel in the Iberian dryland region (see figure \\ref{fig:ExMod}). Figure established via \\ref{rVegMemQsoil}. \\label{fig:QsoilMemMod}", fig.scap="Memory Model Qsoil Data Treatment", cache = TRUE, cache.lazy=FALSE, fig.pos = 'h!'}
setwd(Dir.ERA.Monthly)
Qsoil <- brick(list.files()[grep(list.files(), pattern = "Iberian Region_11981_122015.nc")[1]])
load(paste(Dir.Data,"ModData_df.RData", sep ="/")) # model data for pixel 35363
Clim <- as.vector(Qsoil[35363])[1:dim(ModData_df)[1]]
Clim_vec <- detrend(Clim, tt = 'linear') # linear detrending
## raw and detrended
plot1_df <- with(ModData_df, data.frame(
  Months = rep(1:dim(ModData_df)[1], 2),
  Qsoil = c(Clim, Clim_vec),
  Ident = rep(c("Raw Data", "Detrened"), each = dim(ModData_df)[1])
))
ggplot(plot1_df, aes(x = Months, y = Qsoil, col = Ident)) + geom_line(size = 2) + theme_bw(base_size = 35) + theme(legend.position = "none") + scale_color_manual(values=c("orange", "navyblue"))
## raw and detrended
plot2_df <- with(ModData_df, data.frame(
  Months = rep(1:dim(ModData_df)[1], 1),
  Qsoil = c(Clim_raw),
  Ident = rep(c("Z-Scores"), each = dim(ModData_df)[1])
))
ggplot(plot2_df, aes(x = Months, y = Qsoil, col = Ident)) + geom_line(size = 2) + theme_bw(base_size = 35) + theme(legend.position = "none") + scale_color_manual(values=c("brown"))
## Cummulative soil moisture lags
plot3_df <- with(ModData_df, data.frame(
  Months = rep(1:dim(ModData_df)[1], 13),
  Qsoil = c(ClimCum_0, ClimCum_1, ClimCum_2, ClimCum_3, ClimCum_4, ClimCum_5, ClimCum_6, ClimCum_7, ClimCum_8, ClimCum_9, ClimCum_10, ClimCum_11, ClimCum_12),
  Ident = as.factor(rep(c("Z-Scores", "Lag 01", "Lag 02", "Lag 03", "Lag 04", "Lag 05", "Lag 06", "Lag 07", "Lag 08", "Lag 09", "Lag 10", "Lag 11", "Lag 12"), each = dim(ModData_df)[1]))
))
ggplot(plot3_df, aes(x = Months, y = Qsoil, col = Ident)) + geom_line(size = 1) + theme_bw(base_size = 35) + theme(legend.position = "none") +  scale_color_manual(values=c(rainbow(12), "brown"))
## legend
Qsoilplot_df <- rbind(plot1_df, plot3_df)
leg <- ggplot(Qsoilplot_df, aes(x = Months, y = Qsoil, col = Ident)) + geom_line(size = 2) + scale_color_manual(values=c("orange", "navyblue", rainbow(12), "brown")) + theme_bw(base_size = 65) + guides(colour = guide_legend(ncol=3, override.aes = list(size=20))) + labs(col='ERA5 Qsoil1 data')
legend <- cowplot::get_legend(leg)
grid.newpage()
grid.draw(legend)
```

\begin{figure}[h!]
\centering \includegraphics[width=.9\linewidth]{3 - Figures/ExMod.jpg}
\caption[examplary Vegetation Memory PCA]{\textbf{examplary Vegetation Memory PCA - } Overview of Z-Score data for \ndvil, $Qsoil_{1;6}$, and $Tair$ for a single pixel in the dryland region of the Iberian study region (red colouring on \ndvi background in central plot) as well as their representation in a \pca. Also pictured: $NDVI_t$ Z-Scores required for \pca regression models (see figure \ref{fig:ModScheme} and \ref{fig:PCAREG}). Some parts of this figure have been generated via \ref{rFigs}.}
\label{fig:ExMod}
\end{figure}

\clearpage

\begin{figure}[t!]
\centering \includegraphics[width=1\linewidth]{3 - Figures/PCAREG.jpg}
\caption[PCA Regression Coefficients]{\textbf{PCA Regression Coefficients - } Theoretical back-calculation of regression coefficients from \pca regression coefficients as lined out by Zuur et al\cite{Zuur2007}. The data presented here (\pca loadings, \pca model coefficients, and final variable coefficients) represents a single pixel in the Iberian dryland region (see figure \ref{fig:ExMod}).}
\label{fig:PCAREG}
\end{figure}

By following the vegetation memory modelling procedure outlined in figures \ref{fig:ModScheme} and \ref{fig:PCAREG} and explained above for each study region one obtains rasters containing the following information for each pixel:

\begin{enumerate}
\item \textbf{Vegetation Memory Coefficients} as established in formula \ref{eqMemMod} jused to identify meainingful drivers of vegetation memory (\textit{research question I.1}).
\item \textbf{Vegetation Memory Length} in regards to \qsoila, \qsoilb, \qsoilc, and \qsoild again being used to answer \textit{research question I.1}.
\end{enumerate}

\vspace{.5cm}

\paragraph*{Model Comparisons}  \hspace{.5cm}

Assessments of differences in relative importance of vegetation memory coefficients in individual models and between models serve to answer the following questions:

\begin{enumerate}
\item \textbf{Which model variable exerts the greatest influence on vegetation anomalies?} - To answer this question, I am comparing absolute values of variable coefficients across all pixels \textit{within} each \textit{model} individually, separately for each study region. Doing so serves to answer \textit{research question I.1} and \textit{I.2}.
\item \textbf{Which \qsoil layer is the most biologically influential?} - The answer to this question can be retrieved by comparing absolute values of \qsoil coefficients for all pixel per model \textit{between} all four \textit{models} for each study region which answers \textit{research question I.1}.
\end{enumerate}

Differences in absolute variable coefficient values within and between models has been assessed using Mann-Whitney-U Test (`wilcox.test(..., paired = FALSE)` in `R`). I have chosen the Mann-Whitney U-Test, since vegetation memory coefficient data cannot be expected to be normal distributed, nor to fall onto symmetrical distributions (hence, one should contrast median values rather than mean values). The code for these assessments can be retrieved in \ref{rVegMem} (`CoeffScaling`).

Although allowing for region-wide generalisations, these assessments of statistical significance can not be used to identify or display spatial patterns of relative memory coefficient importance.

\clearpage

\paragraph*{Variance Partitioning}  \hspace{.5cm}

Variance partitioning is a model-driven method of assessing relative importance of vegetation memory model variables. As opposed to Mann-Whitney U model comparisons, variance partitioning can be carried out for each pixel in my study region data rasters individually. This, in turn, results in the identification of patterns of relative model predictor importance.  

It was my goal to assess the relative importance of intrinsic and extrinsic vegetation memory components (\textit{research question I.2}). I have identified \qsoil layers to be of special interest in representing extrinsic vegetation memory (see section \ref{sResults}). Therefore, I am assessing the relative information contained in the vegetation memory model predictors \ndvil (intrinsic memory) and $Qsoil_{k;m}$ (extrinsic soil moisture memory of layer $k$ and cumulative lag $m$).  

Zuur et al.\cite{Zuur2007} present a method developed by Legendre \& Legendre\cite{Legendre1998} for the purpose of variance partitioning between two explanatory variables. This approach (represented in figure \ref{fig:VarPar}) is carried out as follows:

\begin{enumerate}
\item Apply the full regression model $Z_{NDVI} = NDVI_{t-1} + Qsoil_{k;m}$ and obtain $R^2$ (the coefficient of determination). This is $R^2_{Full}$ and equal to all explained variance. Unexplained variance can then be calculated as $1 - R^2_{Full}$
\item Obtain $R^2$ of $Z_{NDVI} = NDVI_{t-1}$. This is $R^2_{NDVI_{t-1}}$ and equal to all variance explained by \ndvil.
\item Obtain $R^2$ of $Z_{NDVI} = Qsoil_{k;m}$. This is $R^2_{Qsoil_{k;m}}$ and equal to all variance explained by $Qsoil_{k;m}$.
\end{enumerate}

The variance shared between \ndvil and $Qsoil_{k;m}$ - $R^2_{Shared}$ can then be calculated as:

\vspace{-.4cm}
\begin{equation}
R^2_{Shared} = R^2_{NDVI_{t-1}} + R^2_{Qsoil_{k;m}} - R^2_{Full}
\end{equation}
\vspace{-.6cm}

The pure information contained within \ndvil ($R^2_{t-1}$) and $Qsoil_{k;m}$ ($R^2_{k;m}$) can then be calculated as follows:

\vspace{-.4cm}
\begin{minipage}[t]{.5\linewidth}
\begin{equation}
R^2_{t-1} = R^2_{NDVI_{t-1}} - R^2_{Shared}
\end{equation}
\end{minipage}
\begin{minipage}[t]{.5\linewidth}
\begin{equation}
R^2_{k;m} = R^2_{Qsoil_{k;m}} - R^2_{Shared}
\end{equation}
\end{minipage}
\vspace{-.2cm}

\begin{figure}[h!]
\centering \includegraphics[width=.9\linewidth]{3 - Figures/VarParScheme.jpg}
\caption[Variance Partitioning]{\textbf{Variance Partitioning - } Partitioning of variance in pure influence of \ndvil (Pure $[t-1]$), $Qsoil_{k;m}$ (Pure $Qsoil$, with $k$ identifying the \qsoil layer, and $m$ denoting the cumulative lag of \qsoil data), shared variance between the two (Shared), and residuals (Unexplained). The figure concept has been lifted from Zuur et al.\cite{Zuur2007} and adjusted to reflect the purpose of this study. Model specifications are contained within dashed boxes.}
\label{fig:VarPar}
\end{figure}

This form of variance partitioning is carried out for each pixel across all study regions and contained in the vegetation memory model output of \ref{rVegMem} alongside \pca regression models.

#### Vegetation Memory Sensitivity

Following the notion of climate adaptation leading to altered disturbance-responses of local vegetation\cite{Walter2013} I am assessing the relationship of vegetation memory characteristics and the mean value of their drivers across the entire time period from 1981 to 2015. This is done using linear regression and useful in answering \textit{research question I.1}.

\clearpage

## Functional Aspects of Vegetation Memory

### Data
Contemporary studies of vegetation memory largely describe memory effects in terms of spatial patterns and effect sizes, but forego analyses of plant physiology or morphology to **explain causal pathways** leading to vegetation memory. Expressions of plant morphology and physiology are manifold and so one may wish to enlist multiple different proxies of these biological properties to rationalise vegetation memory effects.

#### COMPADRE
\LHT information for plants and animals can be retrieved via \COMPADRE; an extensive data base of different species and plot-scale ecosystems at different locations around the Earth\cite{Salguero-Gomez2015}. \COMPADRE is built around observational data and matrix models\cite{COMPADREGuide} which can be used to extract valuable information about temporal processes in biological communities\cite{Jongejans,DeKroon2008}. The outputs of \COMPADRE matrix models are manifold\cite{Salguero-Gomez2017} offering access to a host of biologically relevant proxies of population processes.

For this study, I have selected the following \COMPADRE outputs as the most likely to be related to vegetation memory characteristics alongside hypotheses of proposed relationships to vegetation memory:

\begin{enumerate}
\item The \textbf{Fast-Slow Continuum (FSC)}.
  \begin{enumerate}
  \item \textit{\fsca} - Species of fast life histories exert shorter/weaker vegetation memory.
  \item \textit{\fscb} - Species of low reproductive output show longer/stronger vegetation memory.
  \end{enumerate}
\item \textbf{Reactivity} - Species of higher reactivity exert shorter/weaker vegetation memory.
\item \textbf{\crho} - Species of higher \crho exert shorter/weaker vegetation memory.
\item \textbf{\cpi} - Species of higher \cpi show shorter/weaker vegetation memory.
\end{enumerate}

With \COMPADRE, data for almost all variables contained within \COMPADRE can be retrieved for all locations contained within the current release of the data base. Sampling effort for \LHTs within the \COMPADRE scheme can only cover a limited range of geological locations (hence I am not presenting a global data overview). The best sampled for regions on Earth - in terms of \COMPADRE sites - are the Iberian Peninsula and the contiguous United States of America. To date, no mapping approach beyond the rasterising of plot-level data of \COMPADRE \LHTs has been proposed.

```{r ShowCOMPADRE, echo = FALSE, fig.width = 17, fig.height = 9, fig.cap="\\textbf{COMPADRE sites available to this study -} Data availability within \\COMPADRE 4.0.1 aggregated to a raster of \\gimms resolution. Presence of data per grid cell is indicated with red shading. \\label{fig:COMPADREOverview}. Figure established via \\ref{rCOMPADREOverview}", fig.scap="COMPADRE sites available to this study", out.extra='',fig.pos = 'h', cache = TRUE, cache.lazy=FALSE}
# # DATA
# Compadre_df <- read.csv(paste(Dir.Compadre, "/allCOMPADREOutput.csv", sep="")) # load data frame
# setwd(Dir.Gimms.Monthly)
# Back_ras <- mean(brick(list.files()[1:7]), na.rm = TRUE) # background raster for later plots
# values(Back_ras)[which(!is.na(values(Back_ras)))] <- 8888
# # RASTERISING
# pts <- na.omit(data.frame(y = Compadre_df$Lat, x = Compadre_df$Lon, z = rep(1, dim(Compadre_df)[1])))
# coordinates(pts) = ~x+y # convert x and y to coordinates
# rast <- raster(ext=extent(Back_ras), resolution=res(Back_ras)) # create raster to be filled
# rasOut<-rasterize(x = pts, y = rast, field = pts$z, fun = mean) # rasterize irregular points
# # PLOTTING
# plot(Back_ras, col = "grey", colNA = "black", main = "COMPADRE Data Locations", cex.main = 2, legend = FALSE)
# plot(rasOut, col = "red", add = TRUE, legend = FALSE, axis.args=list(cex.axis=1.5), cex.axis = 1.5)
```

#### TRY
Here, I test the relationships between vegetation memory effects and two different \PFTs which have been selected because they represent two important plant characteristics/trade-off axes in plant function (1) Vegetative Height, and (2)  Leaf nitrogen content per leaf dry mass\cite{Diaz2015}. 

Additionally, these two \PFTs correspond to two of the three \PFT domains (i.e. stems and leaves) layed out in Westoby \& Wright's \PFT framework\cite{Westoby2006}. Examining \PFTs of multiple aspects of plant function in the face of adverse events is especially important as plant performance levels during and after disturbances often incur responses of all aspects of individual plant functional domains\cite{Bonser2006}.  

\TRY (and other \PFT data bases) suffer from the same limitations as \COMPADRE - sampling bias and effort\cite{Sandel2015}. Certain regions of the earth are well-sampled for \PFTs (e.g. the Pyrenees) although these sampling schemes are often limited to plot-level sampling campaigns. This data limitation highlights the potential importance of a mapping approach as lined out in figure \ref{fig:PFTCombining}. The \TRY data used for my thesis has been obtained via \TRY on 07/08/2018.

<!-- For visualisations of the raw data, see figures \ref{fig:HOverview} and \ref{fig:NOverview}. These plots clearly depict the l -->
<!-- \clearpage -->

<!-- \begin{enumerate} -->
<!-- \item \textbf{\vh} recorded in $cm$. Taller plants are better at pre-empting light resources and dispersing diaspores\cite{Diaz2015}. -->
<!-- \end{enumerate} -->
<!-- \vspace{-.5cm} -->
<!-- ```{r ShowTRYH, echo = FALSE, fig.width = 17, fig.height = 9, fig.cap="\\textbf{Global Vegetative Height ($H$) data as obtained via TRY -} \\vh data obtained via \\TRY, aggregated to rasters at \\gimms resolution. Grey pixels indicate terrestrial regions for which no \\vh data is available. Figure established via \\ref{rHOverview}. \\label{fig:HOverview}", fig.scap="Global Vegetative Height (H) data as obtained via TRY", out.extra='',fig.pos = 'h', cache = TRUE, cache.lazy=FALSE} -->
<!-- # Data -->
<!-- setwd(Dir.Gimms.Monthly) -->
<!-- Back_ras <- mean(brick(list.files()[1:7]), na.rm = TRUE) # background raster for later plots -->
<!-- values(Back_ras)[which(!is.na(values(Back_ras)))] <- 8888 -->
<!-- RawTry_ras <- brick(paste(Dir.TRY,"/RawTRY-Global.nc", sep="")) -->
<!-- # Height plot -->
<!-- plot(Back_ras, col = "grey", colNA = "black", main = "Mean Vegetative Height", cex.main = 2, legend = FALSE) -->
<!-- plot(RawTry_ras[[1]], col = col.tair, add = TRUE, legend.width = 1.5, legend.shrink=1, axis.args=list(cex.axis=1.5), cex.axis = 1.5) -->
<!-- ``` -->

<!-- \begin{enumerate} -->
<!-- \setcounter{enumi}{1} -->
<!-- \item \textbf{\nmass} recorded in $\frac{mg_{N}}{g_{leaf}}$. This is a valuable proxy for different strategies of resource allocation to leaf longevity vs. photosynthetic potential\cite{Diaz2015}. -->
<!-- \end{enumerate} -->
<!-- \vspace{-.5cm} -->
<!-- ```{r ShowTRYN, echo = FALSE, fig.width = 17, fig.height = 9, fig.cap="\\textbf{Global Leaf Nitrogan Content ($N_{mass}$) data as obtained via TRY -} \\nmass data obtained via \\TRY, aggregated to rasters at \\gimms resolution. Grey pixels indicate terrestrial regions for which no \\nmass data is available. Figure established via \\ref{rNOverview}. \\label{fig:NOverview}", fig.scap="Global Leaf Nitrogan Content ($N_{mass}$) data as obtained via TRY", out.extra='',fig.pos = 'h', cache = TRUE, cache.lazy=FALSE} -->
<!-- # Nmass plot -->
<!-- plot(Back_ras, col = "grey", colNA = "black", main = "Mean Leaf Nitrogen Mass", cex.main = 2, legend = FALSE) -->
<!-- plot(RawTry_ras[[2]], col = col.tair, add = TRUE, legend.width = 1.5, legend.shrink=1, axis.args=list(cex.axis=1.5), cex.axis = 1.5) -->
<!-- ``` -->

\clearpage

#### Floral Data

Extrapolating \PFT records from species-referenced records to spatial products using species-specific \PFT means and species occurence records as layed out by Ordonoez \& Svenning\cite{Ordonez2015} (see figure \ref{fig:PFTCombining}) may prove to overcome the data limitations of \TRY \PFT data.

Plant species occurence records can be obtained via floral data repositories such as \GBIF (see figure \ref{fig:GBIFOverview} for a representation of \GBIF plant occurence data). Data in \GBIF are stored as geo-referenced records of species presence. Generating maps from geo-referenced data points can be achieved by aggregating data points to rasters of a desired extent and resolution (i.e. \gimms resolution).

\begin{figure}[h!]
\centering \includegraphics[width=1\linewidth]{3 - Figures/Gbif.png}
\caption[GBIF \textit{Plantae} Occurrence Overview]{\textbf{GBIF \textit{Plantae} Occurrence Overview - }Global representation of occurence records for species within the \textit{plantae} kingdom available via \GBIF\cite{GBIFOnline} as of 21/04/19. Figure generated using the \GBIF occurence data exploration tool\cite{GbifRetrieve} obtaining records from 1982 to 2015 (same as \gimms data availability). Polygons have been drawn to omit occurence records of marine plantae species. Larger red plotting symbols indicate greater amounts of geo-referenced occurence records.}
\label{fig:GBIFOverview}
\end{figure}

The floral data used within this study have been obtained for the time period of 1982 to 2015 (the same time span as the data availability for \gimms \ndvi data) via \GBIF on 19/04/19 through to 21/04/19.


\clearpage

## Analyses

### Life History Traits

\LHT data has been obtained via \COMPADRE on 28/01/19 in geo-referenced table format and is used to achieve \textit{research goal 2}.

\paragraph*{Data Extraction}  \hspace{.5cm}

Target \COMPADRE \LHTs are extracted using \ref{rCOMPADRE} by aggregating geo-referenced \LHT records to rasters of \gimms resolution using a mean function for each study region.

\paragraph*{Models}  \hspace{.5cm}

I use regression models to assess causal links between \LHTs expressions (both raw and mean-extrapolated).

### Plant Functional Traits

\PFT data has been obtained via \TRY on 07/08/18 in geo-referenced data table format and is used to achieve \textit{research goal 2}.

\paragraph*{Data Extraction}  \hspace{.5cm}
Vegetation memory characteristics are stored as raster data sets to retain spatial patterns of memory coefficients. Therefore, \PFT data needs rasterising for comparability. \PFT data is extracted and rasterised in two ways:
\begin{enumerate}
\item \textbf{Raw geo-referenced \PFT records}. Geo-referenced \TRY data points are aggregated to rasters of \gimms resolution using a mean function (if multiple \PFT records fall onto the same raster cell, the mean value of these is assigned to the cell). This results in rasters of low data-coverage but peer-reviewed data records.
\item \textbf{Species-specific mean \PFT records}. These are extracted for each species within the \TRY data set to enable \PFT mapping as depicted in figure \ref{fig:PFTCombining}.
\end{enumerate}

Data extraction of \PFT records is handled via \ref{rPFTs}.


\paragraph*{Data Mapping}  \hspace{.5cm}

Data mapping is carried out via \ref{rPFTs} and extrapolates species-specific \PFT mean values according to \GBIF occurence data (see figure \ref{fig:PFTCombining}). Using the approach presented by Ordonez \& Svenning\cite{Ordonez2015}, I am establishing rasters of mean \PFT expressions by:

\begin{enumerate}
\item Assigning species-specific mean \PFT values to all cells of individual species occurence according to \GBIF.
\item Computing the mean \PFT value for each cell in the rasters.
\item Removing all cells whose values exceed the upper 95\% quantile of mean \PFT records in these final mean rasters to remove outliers which may be due to sampling bias. The lower 5\% quantile remains unaltered to retain grassland regions which are typical of dryland regions and characterised by low \vh records.
\end{enumerate}

This results in rasters of high data coverage but at a loss of data reliability.

\paragraph*{Models}  \hspace{.5cm}

Like with \LHTs, I use regression models to assess causal links between \PFT expressions (both raw and mean-extrapolated).

\clearpage

# Results
\label{sResults}

## Identifying Vegetation Memory
### Vegetation Memory Models

#### Iberian Region

I am only presenting \qsoila results here as I have identified \qsoila to be the most informative \qsoil layer (see figure \ref{fig:IBLayers} and table \ref{tab:IBRQsoilU}). \qsoilb, \qsoilc, and \qsoild results can be found in figures \ref{fig:IBRVegMem2}, \ref{fig:IBRVegMem3}, and \ref{fig:IBRVegMem4}. Additionally, patterns of $NDVI[t-1]$ and \tair coefficients do not change (quantitatively or qualitatively) between different soil layer models and are thus reported only in figure \ref{fig:IBRVegMem1}. The memory patterns are as follows:

<!-- Vegetation memory coefficients of \ndvil and extrinsic memory (\tair and \qsoila) across the Iberian region are represented in figure \ref{fig:IBRVegMem1}. Additionally, figure \ref{fig:IBRVegMem1} depicts \qsoila memory length across the Iberian region.  -->
\begin{enumerate}
\item \qsoila memory length (identified as cumulative lags according to \aic values) exhibits low values (short memory) in the region of the Pyrenees with a noticeable shift towards slightly longer memory lengths when moving to dryland regions. Particularly across Spain, this manifests in a nort-west to south-east gradient of increasing \qsoila memory length.
\item \ndvil memory follows the same pattern as presented by De Keersmaecker et al.\cite{DeKeersmaecker2015} with strong, positive memory effects in the south of the Iberian region which diminish but remain positive towards the north. Across Spain, the \ndvil pattern is a close match of the \qsoila memory length pattern with longest \qsoila memory being associated with stronger \ndvil memory effects and cive versa.
\item \qsoila memory is predominantly positive in sign meaning that vegetation will react positively (increased \ndvi values) to positive anomalies in \qsoila conditions (wetter conditions). A notable exception of this are the Pyrenees. Especially strong \qsoila memory can be observed in the dryland regions of Spain and Portugal. \qsoila emory patterns closely resemble \ndvil memory patterns.
\item \tair memory falls onto a clear latitudinal gradient with positive memory effects in the north to negative memory effects of almost equal absolute values in the south. Additionally, there seems to be an altitudinal gradient with negative memory effects in the Pyrenees.
\end{enumerate}

\ndvil memory is stronger than \qsoila memory which, in turn, is stronger than \tair memory (see table \ref{tab:IBRU1}). Again, only \qsoila results are presented here. The hierarchy of memory coefficients remains unaltered when considering other \qsoil layers (see tables \ref{tab:IBRU2}, \ref{tab:IBRU3}, \ref{tab:IBRU4}).

```{r IBRU1, echo = FALSE, results = 'asis'}
Ures(Region = "Iberian Region", SoilLayer = 1)
```

\clearpage

```{r IBRVegMem1, echo = FALSE, fig.width = 17, fig.height = 20, fig.subcap=c('SoilLag', 't-1', 'Qsoil', 'Tair'), fig.ncol = 2, out.width='.5\\linewidth', fig.cap="\\textbf{Vegetation Memory Coefficients (Iberian Region; Qsoil1) -} Coefficients of vegetation memory obtained via model selection (figure \\ref{fig:ModScheme}) and \\pca regression (figure \\ref{fig:PCAREG}). For an interpretation of these coefficients, see table \\ref{tab:CoeffsOverview}. Figure established via \\ref{rModelRes}. \\label{fig:IBRVegMem1}", fig.scap="Vegetation Memory Coefficients (Iberian Region; Qsoil1)", cache = TRUE, cache.lazy=FALSE, fig.pos = 'h!'}
ModelRes(Region = "Iberian Region", SoilLayer = 1)
```

\clearpage

#### Caatinga
Again, I am only presenting \qsoila results here as I have identified \qsoila to be the most informative \qsoil layer (see figure \ref{fig:CALayers} and table \ref{tab:CAQsoilU}). Results pertaining to \qsoilb, \qsoilc, and \qsoild can be found in figures \ref{fig:CAVegMem2}, \ref{fig:CAVegMem3}, and \ref{fig:CAVegMem4} respectively. Additionally, patterns of $NDVI[t-1]$ and \tair coefficients do not change between different soil layer models and are thus reported only in figure \ref{fig:CAVegMem1}. The memory patterns are as follows:
\begin{enumerate}
\item \qsoila memory length (identified as cumulative lags according to \aic values) exhibits lower values (shorter memory) in the north-eastern dryland regions (this is the Caatinga region itself) as well as the south-western sub-humid and humid regions (althogh not part of the Caatinga itself, these have been included to show exactly such patterns).
\item \ndvil memory depicts a different pattern pattern as the vegetation sensitivity index developed by Seddon et al\cite{Seddon2016} with the north-eastern dryland region being characterised by strong intrinsic memory effects with a marked drop-off towards the south-west. Notice the negligible coverage of negative \ndvil memory effects as well as their minute absolute values when compared to positive \ndvil memory effect values. Additionally, \ndvil memory patterns closely resemble an inverse of \qsoila memory length patterns with increased \ndvil effects in areas of short \qsoila memory length.
\item \qsoila memory is mostly positive across the entire Caatinga range with the highest absolute values being found in the north-eastern dryland region. Take note that the maximum \qsoila memory coefficient is larger than the absolute of the corresponding minimum value. Additionally, there are some changes in \qsoil memory effect sign between \qsoila and \qsoilb, and \qsoilc and \qsoild with negative \qsoil effects being identified around the region of Brasilia in the latter two layers. Overall, the \qsoila memory pattern closely resembles that of \ndvil effects.
\item \tair memory patterns follow a pattern that is close to the inverse of the \qsoila pattern with large negative values in the north-eastern dryland region. Take note that the absolute of the minimum \tair memory coefficient is larger than the corresponding maximum value. \tair memory patterns are a close match to an inverse \qsoila memory pattern.
\end{enumerate}

\ndvil memory is stronger than \qsoila memory which, in turn, is stronger than \tair memory (see table \ref{tab:CAU1}). Again, only \qsoila results are presented here. The hierarchy of memory coefficients remains unaltered when considering other \qsoil layers (see tables \ref{tab:CAU2}, \ref{tab:CAU3}, \ref{tab:CAU4}).


```{r CAU1, echo = FALSE, results = 'asis'}
Ures(Region = "Caatinga", SoilLayer = 1)
```

\clearpage

```{r CAVegMem1, echo = FALSE, fig.width = 17, fig.height = 20, fig.subcap=c('SoilLag', 't-1', 'Qsoil', 'Tair'), fig.ncol = 2, out.width='.5\\linewidth', fig.cap="\\textbf{Vegetation Memory Coefficients (Caatinga; Qsoil1) -} Coefficients of vegetation memory obtained via model selection (figure \\ref{fig:ModScheme}) and \\pca regression (figure \\ref{fig:PCAREG}). For an interpretation of these coefficients, see table \\ref{tab:CoeffsOverview}. Figure established via \\ref{rModelRes}. \\label{fig:CAVegMem1}", fig.scap="Vegetation Memory Coefficients (Caatinga; Qsoil1)", cache = TRUE, cache.lazy=FALSE, fig.pos = 'h!'}
ModelRes(Region = "Caatinga", SoilLayer = 1)
```

\clearpage

#### Australia
Once more, I am only presenting \qsoila results here as I have identified \qsoila to be the most informative \qsoil layer (see figure \ref{fig:AULayers} and table \ref{tab:AUQsoilU}). Results pertaining to \qsoilb, \qsoilc, and \qsoild can be found in figures \ref{fig:AUVegMem2}, \ref{fig:AUVegMem3}, and \ref{fig:AUVegMem4} respectively. Additionally, patterns of $NDVI[t-1]$ and \tair coefficients do not change between different soil layer models and are thus reported only in figure \ref{fig:AUVegMem1}. The memory patterns are as follows:
\begin{enumerate}
\item \qsoila memory length (identified as cumulative lags according to \aic values) exhibits larger values (longer memory) in the western regions whilst lower memory length indices in the eastern regions of Australia identify shorter memory. Take note that these patterns do not overlap well with the previously identified memory lags of Vicente-Serrano et al.\cite{Vicente-Serrano2013}, or Liu et al.\cite{Liu2018}. However, this pattern closely mimics that of the autoregressive coefficient (\ndvil) employed by Seddon et al\cite{Seddon2016}.
\item \ndvil memory follows the same pattern as presented by De Keersmaecker et al.\cite{DeKeersmaecker2015} with strong, positive memory effects all across Australia with stronger \ndvil memory effects in the Outback and lower effects across the coastlines. Notice the negligible (although ecologicaly not unfeasable) coverage of negative \ndvil memory effects as well as their minute absolute values when compared to positive \ndvil memory effect values. Unlike before, there is no obvious match between \ndvil memory patterns and \qsoila memory length.
\item \qsoila memory effects are mostly positive across the entirety of Australia with the highest values being located in the Outback and negative \qsoila memory effects being found on Tasmania, along coastlines and south of the St. George Ranges. Take note that the maximum \qsoila memory coefficient is larger than the absolute of the corresponding minimum value. Additionally, there are some changes in \qsoil memory effect sign between \qsoila and \qsoilb, and \qsoilc and \qsoild with negative \qsoil effects being identified throughout the entire Outback particularly within the \qsoild layer. Again, the \qsoila memory pattern closely resembles that of \ndvil memory effects.
\item \tair memory patterns follow a pattern that is close to the inverse of the \qsoila pattern with large negative values across all of Australia. Take note that the absolute of the minimum \tair memory coefficient is larger than the corresponding maximum value.
\end{enumerate}

\ndvil memory is stronger than \qsoila memory which, in turn, is stronger than \tair memory (see table \ref{tab:AUU1}). Again, only \qsoila results are presented here. The hierarchy of memory coefficients remains unaltered when considering other \qsoil layers (see tables \ref{tab:AUU2}, \ref{tab:AUU3}, \ref{tab:AUU4}).

```{r AUU1, echo = FALSE, results = 'asis'}
Ures(Region = "Australia", SoilLayer = 1)
```

\clearpage

```{r AUVegMem1, echo = FALSE, fig.width = 17, fig.height = 20, fig.subcap=c('SoilLag', 't-1', 'Qsoil', 'Tair'), fig.ncol = 2, out.width='.5\\linewidth', fig.cap="\\textbf{Vegetation Memory Coefficients (Australia; Qsoil1) -} Coefficients of vegetation memory obtained via model selection (figure \\ref{fig:ModScheme}) and \\pca regression (figure \\ref{fig:PCAREG}). For an interpretation of these coefficients, see table \\ref{tab:CoeffsOverview}. Figure established via \\ref{rModelRes}. \\label{fig:AUVegMem1}", fig.scap="Vegetation Memory Coefficients (Australia; Qsoil1)", cache = TRUE, cache.lazy=FALSE, fig.pos = 'h!'}
ModelRes(Region = "Australia", SoilLayer = 1)
```

\clearpage

### Variance Partitioning
Whilst the above region-wide Mann-Whitney U analyses allow for region-encompassing comparisons of relative importance of model components, variance partitioning allows for far more advanced spatial analyses of relative model coefficient importance. As mentioned previously, I have elected to analyse only \ndvil and \qsoila variance as these two have been identified as the most important intrinsic and extrinsic vegetation memory metrics across all three study regions (see tables \ref{tab:IBRU1}, \ref{tab:CAU1}, and \ref{tab:AUU1}).

Comparing variance partitioning results across study regions (see figure \ref{fig:VarParOverview}) patterns of different ecological system processes emerge. Whilst \qsoil and \ndvil share little to no variance across the Iberian Region, a moderate amount of variance is shared by these two variables when analysing the Caatinga range. Across Australia, however, large amounts of variance are shared by \ndvil and \qsoila. Overall, \ndvil explains more variation in records of \ndvi than \qsoila. Overall, \ndvil and \qsoila explain the most variation in \ndvi anomalies in dryland regions across all three study regions (see figures \ref{fig:IBRVarPar2}, \ref{fig:CAVarPar2}, and \ref{fig:AUVarPar2}). 
\vspace{-.3cm}
```{r VarParOverview, echo = FALSE, fig.width = 17, fig.height = 13, fig.subcap=c('Iberian Region', 'Caatinga', 'Australia', 'Plotting Colour Reference'), fig.ncol = 2, out.width='.5\\linewidth', fig.cap="\\textbf{Variance Partitioning Across Study Regions -} Variance in \ndvi explained by \\ndvil and \\qsoila records across all three study regions. A representation of how these were calculated can be retrieved in figure \\ref{fig:VarPar}. Figure established via \\ref{rVarParRes}. \\label{fig:VarParOverview}", fig.scap="Variance Partitioning Across Study Regions", cache = TRUE, cache.lazy=FALSE, fig.pos = 'h!'}
VarParRes(Region = "Iberian Region", SoilLayer = 1, Plot = 1, Legend = FALSE)
VarParRes(Region = "Caatinga", SoilLayer = 1, Plot = 1, Legend = FALSE)
VarParRes(Region = "Australia", SoilLayer = 1, Plot = 1, Legend = FALSE)
leg <- VarParRes(Region = "Iberian Region", SoilLayer = 1, Plot = 1)
leg <- leg + theme_bw(base_size = 90) + guides(fill = guide_legend(override.aes = list(size = 30)))
legend <- cowplot::get_legend(leg)
grid.newpage()
grid.draw(legend)
```
\vspace{-.3cm}
Finally, variance partitioning also highlights the overall importance of \qsoila when compared to the variance explained by \qsoilb, \qsoilc, and \qsoild (see figures \ref{fig:IBRVarPar1}, \ref{fig:CAVarPar1}, and \ref{fig:AUVarPar1}).

\clearpage

### Vegetation Memory Sensitivity
Vegetation memory sensitivity has been assessed as linear relationships of vegetation memory coefficients (obtained via models) and environmental mean conditions. This should serve as an information criterion of adaptation of vegetation to local conditions.

#### $NDVI_{[t-1]}$
Sensitivity relationships of \ndvil are depicted alongside raw data in figure \ref{fig:PatCauseNDVI}. Linear regression coefficients of these sensitivity relationships have been assessed per study region and are depicted in table \ref{tab:PatCauseTabNDVI}.

```{r PatCauseNDVI, echo = FALSE, fig.width = 17, fig.height = 11, fig.cap="\\textbf{Intrinsic Vegetation Memory Sensitivity -} \\ndvil vegetation memory coefficients of figure \\ref{fig:IBRVegMem1}, \\ref{fig:CAVegMem1}, and \\ref{fig:AUVegMem1} plotted against mean intrinsic drivers (see figure \\ref{fig:IBPDataOverview}, \\ref{fig:CaatDataOverview}, and \\ref{fig:AUDataOverview}). Figure established via \\ref{rPatCausRes}. \\label{fig:PatCauseNDVI}", fig.scap="Intrinsic Vegetation Memory Sensitivity", out.extra='',fig.pos = 'h', cache = TRUE, cache.lazy=FALSE}
PatCauseNDVI <- PatcausRes(SoilLayer = 1, X = "ENDVI", Y = "NDVI")
```

In general, \ndvil memory effects decrease as mean \ndvi records increase. Take note that \ndvi records are bound between zero and one. Given the intercepts and slopes of the linear regressions protrayed in table \ref{tab:PatCauseTabNDVI}, \ndvil memory effects will not dip below zero in areas of high mean \ndvi.

```{r PatCauseTabNDVI, results = 'asis', echo = FALSE}
PatCauseTab(ModelCoeffs = unlist(PatCauseNDVI), SoilLayer = 1, X = "ENDVI", Y = "NDVI")
```

\clearpage

#### Air Temperature
Sensitivity relationships of \tair are depicted alongside raw data in figure \ref{fig:PatCauseTair}. Linear regression coefficients of these sensitivity relationships have been assessed per study region and are depicted in table \ref{tab:PatCauseTabTair}.
```{r PatCauseTair, echo = FALSE, fig.width = 17, fig.height = 11, fig.cap="\\textbf{Tair Vegetation Memory Sensitivity -} \\tair vegetation memory coefficients of figure \\ref{fig:IBRVegMem1}, \\ref{fig:CAVegMem1}, and \\ref{fig:AUVegMem1} plotted against mean \\tair drivers (see figure \\ref{fig:IBPDataOverview}, \\ref{fig:CaatDataOverview}, and \\ref{fig:AUDataOverview}). Figure established via \\ref{rPatCausRes}. \\label{fig:PatCauseTair}", fig.scap="Tair Vegetation Memory Sensitivity", out.extra='',fig.pos = 'h', cache = TRUE, cache.lazy=FALSE}
PatCauseTair <- PatcausRes(SoilLayer = 1, X = "ETair", Y = "Tair")
```
Overall, values of \tair memory effects decrease as mean \tair records increase. This relationship is most pronounced across the Iberian Region and least pintense across Australia. This may be due to the presence of altitudinal gradients across the Iberian Region which are largely absent from Australia thus limitting the range of mean \tair values. On the other hand, this may be indicative of different patterns of vegetation adaptation to \tair conditions. Take note that most \tair memory effects are negative across the selected dryland study regions.
```{r PatCauseTabTair, results = 'asis', echo = FALSE}
PatCauseTab(ModelCoeffs = unlist(PatCauseTair), SoilLayer = 1, X = "ETair", Y = "Tair")
```

\clearpage

#### Soil Moisture (0-7cm)
Sensitivity relationships of \qsoila are depicted alongside raw data in figure \ref{fig:PatCauseQsoil1}. Linear regression coefficients of these sensitivity relationships have been assessed per study region and are depicted in table \ref{tab:PatCauseTabQsoil1}.
```{r PatCauseQsoil1, echo = FALSE, fig.width = 17, fig.height = 11, fig.cap="\\textbf{Qsoil1 Vegetation Memory Sensitivity -} \\qsoila vegetation memory coefficients of figure \\ref{fig:IBRVegMem1}, \\ref{fig:CAVegMem1}, and \\ref{fig:AUVegMem1} plotted against mean \\qsoila drivers (see figure \\ref{fig:IBPDataOverview}, \\ref{fig:CaatDataOverview}, and \\ref{fig:AUDataOverview}). Figure established via \\ref{rPatCausRes}. \\label{fig:PatCauseQsoil1}", fig.scap="Qsoil1 Vegetation Memory Sensitivity", out.extra='',fig.pos = 'h', cache = TRUE, cache.lazy=FALSE}
PatCauseQsoil1 <- PatcausRes(SoilLayer = 1, X = "EQsoil", Y = "Qsoil")
```

Whilst values of \qsoila memory effect decrease as mean \qsoila increaes, the rate at which they do differ hugely between study regions. \qsoila memory effects across Australia seem largely de-coupled from from \qsoila conditions. Across the Iberian Region and Caatinga, on the other hand, the negative relationship between \qsoila memory effects and mean \qsoila records are pronounced with \qsoila memory effects dipping into the negative range across the Iberian Region.

```{r PatCauseTabQsoil1, results = 'asis', echo = FALSE}
PatCauseTab(ModelCoeffs = unlist(PatCauseQsoil1), SoilLayer = 1, X = "EQsoil", Y = "Qsoil")
```

\clearpage

#### Memory Length
Sensitivity relationships of \qsoila memory length (assessed via lags) are depicted alongside raw data in figure \ref{fig:PatCauseMem}. Linear regression coefficients of these sensitivity relationships have been assessed per study region and are depicted in table \ref{tab:PatCauseTabMem}.
```{r PatCauseMem, echo = FALSE, fig.width = 17, fig.height = 11, fig.cap="\\textbf{Qsoil1 Vegetation Memory Length Sensitivity -} \\qsoila vegetation memory length coefficients of figure \\ref{fig:IBRVegMem1}, \\ref{fig:CAVegMem1}, and \\ref{fig:AUVegMem1} plotted against mean \\qsoila drivers (see figure \\ref{fig:IBPDataOverview}, \\ref{fig:CaatDataOverview}, and \\ref{fig:AUDataOverview}). Take note that the above trend-lines are smoothers and not the linear regresseions outlined in table \\ref{tab:PatCauseTabMem}. Figure established via \\ref{rPatCausRes}. \\label{fig:PatCauseMem}", fig.scap="Qsoil1 Vegetation Memory Length Sensitivity", out.extra='',fig.pos = 'h', cache = TRUE, cache.lazy=FALSE}
PatCauseMem <- PatcausRes(SoilLayer = 1, X = "EQsoil", Y = "Memory")
```

Across all three study regions, \qsoila vegetation memory length decreases as mean \qsoila increases. This effect is most pronounced across the Iberian Region, followed by Australia, and the Caatinga (see regression slopes in table \ref{tab:PatCauseTabMem}). The intercepts of these linear regressions follow the same hierarchy, effectively suggesting a stronger influence of \qsoila conditions on memory length across the Iberian Region and Australia when compared to the Caatinga.

```{r PatCauseTabMem, results = 'asis', echo = FALSE}
PatCauseTab(ModelCoeffs = unlist(PatCauseMem), SoilLayer = 1, X = "EQsoil", Y = "Memory")
```

\clearpage

#### $NDVI_{[t-1]}$ and Memory Length
Patterns of \ndvil and \qsoila memory length have been identified to overlap in region-specific manners. Relationships of the two are depicted alongside raw data in figure \ref{fig:PatCauseNDVIMem}. Linear regression coefficients of these sensitivity relationships have been assessed per study region and are depicted in table \ref{tab:PatCauseTabNDVIMem}.
```{r PatCauseNDVIMem, echo = FALSE, fig.width = 17, fig.height = 11, fig.cap="\\textbf{Intrinsic Vegetation Memory and Qsoil1 Memory Length -} \\ndvil vegetation memory coefficients of figure \\ref{fig:IBRVegMem1}, \\ref{fig:CAVegMem1}, and \\ref{fig:AUVegMem1} plotted against \\qsoila vegetation memory length of the same figures. Figure established via \\ref{rPatCausRes}. \\label{fig:PatCauseNDVIMem}", fig.scap="Intrinsic Vegetation Memory and Qsoil1 Memory Length", out.extra='',fig.pos = 'h', cache = TRUE, cache.lazy=FALSE}
PatCauseNDVIMem <- PatcausRes(SoilLayer = 1, X = "Memory", Y = "NDVI")
```

As \qsoila memory length increases across the Iberian Region, \ndvil memory effects increase as well. Across Australia and the Caatinga, the reverse is true and \ndvil memory effects decrease as \qsoila memory length increases. These relationships are strongestacross the Iberian Region and the Caatinga.

```{r PatCauseTabNDVIMem, results = 'asis', echo = FALSE}
PatCauseTab(ModelCoeffs = unlist(PatCauseNDVIMem), SoilLayer = 1, X = "Memory", Y = "NDVI")
```

\clearpage

### Summary

#### Vegetation Memory Models
Across all three study regions, the \textbf{\qsoila} layer has been \textbf{identified as the most informative} of all the \qsoil layers.

Some persistent vegetation memory patterns have emerged across all three study regions:
\begin{enumerate}
\item In general, \textbf{\qsoila memory length} (identified as cumulative lags according to \aic values) exhibits \textbf{shorter} values \textbf{in drylands} (according to ombrotypes) when compared to adjacent non-dryland regions.
\item \textbf{\ndvil memory} follows similar patterns as identified in previous studies\cite{DeKeersmaecker2015,Seddon2016} with \textbf{strong and positive} memory effects \textbf{across dryland regions}.
\item \textbf{\qsoila memory} is \textbf{strong and positive across dryland regions}, largely coinciding with strong and positive \ndvil effects.
\item \textbf{\tair memory} patterns are usually \textbf{strong and negative in dryland regions}.
\end{enumerate}

Across the Iberian Region, \qsoila memory length is shortest for regions of negative \qsoila memory effect impacts and short (but slightly longer) across dryland regions. Short \qsoila memory overlaps with regions of high positive \qsoila memory effects across the Caatinga. Across Australia (almost entirely made up of dryland regions), no such overlap of patterns can be found.

Additionally, model coefficient comparison via Mann-Whitney U-Tests revealed that \ndvil is a larger memory component than \qsoil coefficients which, in turn, are larger components than \tair.

Variance partitioning of \ndvil and \qsoil identified a \textbf{subsiding effect of \qsoil effects through soil layers}. Overall, \textbf{\ndvil explains more variance in \ndvi z-scores than \qsoil data} or variance shared by \ndvil or \qsoil data at different rates across the three study regions.

\vspace{1cm}

#### Vegetation Memory Sensitivity

In terms of vegetation memory sensitivity:
\begin{enumerate}
\item \textbf{\ndvil} memory coefficients are \textbf{negatively correlated} to mean \ndvi records.
\item \textbf{\tair} memory coefficients are \textbf{negatively correlated} to mean \tair records.
\item \textbf{\qsoil} memory coefficients are \textbf{negatively correlated} to mean \qsoil records at differing intensities across the three study regions.
\item \textbf{\qsoil memory length} is \textbf{correlated negatively} with mean \qsoil records. Again, noticeable differences arise across the study regions.
\end{enumerate}

Overall, whilst **general patterns of vegetation memory sensitivity** can be identifed, the intensity of these **can vary strongly from region to region**.

\clearpage

## Functional Aspects of Vegetation Memory
Due to \LHT and \PFT data limitations across two of my three study regions - the Caatinga and Australia (see figures \ref{fig:CaatTRY} and \ref{fig:AUTRY}) - I am focussing my analysis of how functional aspects of vegetation and vegetation memory are linked on the Iberian Region.

```{r CompadPre, echo = FALSE}
leg1 <- Comres(Region = "Iberian Region", Variable = "FSC-1")
leg2 <- Comres(Region = "Iberian Region", Variable = "FSC-2")
leg3 <- Comres(Region = "Iberian Region", Variable = "Pi")
leg4 <- Comres(Region = "Iberian Region", Variable = "Rho")
leg5 <- Comres(Region = "Iberian Region", Variable = "Reactivity")
leg <- Comres(Region = "Iberian Region", Variable = "Reactivity", Legend = TRUE)
```

### Life History Traits

\paragraph*{Fast-Slow Continuum}  \hspace{.5cm}

Relationships of vegetation memory coefficients and \fsca (life history speed) records across the Iberian region are represented in figure \ref{fig:IBCOMPAD1} (I am showing the vegetation memory characteristics for each geo-referenced \fsca record across the Iberian Region). These relationships have been assessed through linear regressions, the coefficients of which are depicted in table \ref{tab:IBCOMPADTab1}.

```{r IBCOMPADTab1, results = 'asis', echo = FALSE}
CompadTab(Region = "Iberian Region", ModelCoeffs = c(unlist(leg1[[2]])), Variable = "FSC-1")
```

Linear relationships of \fsca and vegetation memory coefficients across the Iberian region are built on `r leg1[[3]]` data points each. Whilst most intercepts of these regressions are statistically significant, only the regression slope of \tair memory coefficients and \fsca is statistically significant but minute in nature.

Relationships of vegetation memory coefficients and \fscb (reproductive strategy) records across the Iberian region are represented in figure \ref{fig:IBCOMPAD2}. These relationships have been assessed through linear regressions, the coefficients of which are depicted in table \ref{tab:IBCOMPADTab2}.

```{r IBCOMPADTab2, results = 'asis', echo = FALSE}
CompadTab(Region = "Iberian Region", ModelCoeffs = c(unlist(leg2[[2]])), Variable = "FSC-2")
```

Linear relationships of \fscb and vegetation memory coefficients across the Iberian region are built on `r leg2[[3]]` data points each. Whilst all intercepts of these regressions are statistically significant, only the regression slopes of \ndvil and \tair memory coefficients and \fscb. \ndvil memory decreases with increasing \fscb records. \tair memory increases with increasing \fscb records.


\paragraph*{Period of Oscillation ($\pi$)}  \hspace{.5cm}

Relationships of vegetation memory coefficients and \cpi records across the Iberian region are represented in figure \ref{fig:IBCOMPAD3}. These relationships have been assessed through linear regressions, the coefficients of which are depicted in table \ref{tab:IBCOMPADTab3}.

```{r IBCOMPADTab3, results = 'asis', echo = FALSE}
CompadTab(Region = "Iberian Region", ModelCoeffs = c(unlist(leg3[[2]])), Variable = "Pi")
```

Linear relationships of \cpi and vegetation memory coefficients across the Iberian region are built on `r leg3[[3]]` data points each. Only intercepts of \qsoila memory length and \ndvil regressions are statistically significant.

\paragraph*{Damping Ratio ($\rho$)}  \hspace{.5cm}
Relationships of vegetation memory coefficients and \crho records across the Iberian region are represented in figure \ref{fig:IBCOMPAD4}. These relationships have been assessed through linear regressions, the coefficients of which are depicted in table \ref{tab:IBCOMPADTab4}.

```{r IBCOMPADTab4, results = 'asis', echo = FALSE}
CompadTab(Region = "Iberian Region", ModelCoeffs = c(unlist(leg4[[2]])), Variable = "Rho")
```

Linear relationships of \crho and vegetation memory coefficients across the Iberian region are built on `r leg4[[3]]` data points each. Only the intercepts of \ndvil, \qsoila, and \qsoila memory length are statistically significant.

\paragraph*{Reactivity}  \hspace{.5cm}
Relationships of vegetation memory coefficients and reactivity records across the Iberian region are represented in figure \ref{fig:IBCOMPAD5}. These relationships have been assessed through linear regressions, the coefficients of which are depicted in table \ref{tab:IBCOMPADTab5}.

```{r IBCOMPADTab5, results = 'asis', echo = FALSE}
CompadTab(Region = "Iberian Region", ModelCoeffs = c(unlist(leg5[[2]])), Variable = "Reactivity")
```

Linear relationships of reactivity and vegetation memory coefficients across the Iberian region are built on `r leg5[[3]]` data points each. Whilst \COMPADRE reactivity is not linked statistically significantly to \qsoil memory length, relationships of \tair vegetation memory coefficients and \COMPADRE reactivity are. \tair memory effects increase with increasing \COMPADRE reactivity. Whilst relationships of \ndvil, and \qsoila memory effects and \COMPADRE reactivity aren't statistically significant, their patterns link up with what I hypothesised. \ndvil and \qsoil memory effects decrease with increasing \COMPADRE reactivity. 

\clearpage

\paragraph*{Overview}  \hspace{.5cm}
```{r IBCOMPAD, echo = FALSE, fig.width = 17, fig.height = 12.6, fig.subcap=c('FSC-1', 'FSC-2', 'Period of Oscillation', 'Damping Ratio', 'Reactivity', 'Potting Colour Reference'), fig.ncol = 2, out.width='.5\\linewidth', fig.cap="\\textbf{Short -} Linear regression coefficients of COMPADRE variables and vegetation memory coefficients. Figure established via \\ref{rCOMRes}. \\label{fig:IBCOMPAD}", fig.scap="Short", cache = TRUE, cache.lazy=FALSE, out.extra='', fig.pos = 'h!'}
leg1[[1]]
leg2[[1]]
leg3[[1]]
leg4[[1]]
leg5[[1]]
leg <- leg[[1]] + theme_bw(base_size = 90) + guides(color = guide_legend(override.aes = list(size = 20)))
legend <- cowplot::get_legend(leg)
grid.newpage()
grid.draw(legend)
```

\clearpage

### Plant Functional Traits
\paragraph*{Intrinsic Memory}  \hspace{.5cm}
Relationships of \ndvil vegetation memory coefficients and \vh, and \nmass records across the Iberian region are represented in figure \ref{fig:IBPFT1}. These relationships have been assessed through linear regressions the coefficients of which are represented in table \ref{tab:IBPFTTab1}.
```{r IBPFT1, echo = FALSE, fig.width = 17, fig.height = 14, fig.subcap=c('Height', 'Nitrogen'), fig.ncol = 2, out.width='.5\\linewidth', fig.cap="\\textbf{PFTs and Intrinsic Memory (Iberian Region) -} Intrinsic Memory (NDVI t-1, figure \\ref{fig:IBRVegMem1}) plotted against expressions of (a) \\vh, and (b) \\nmass both via geo-referenced \\TRY records and mapped species-specific trait means (figure \\ref{fig:IBPTRY}). Figure established via \\ref{rTRYRes}. \\label{fig:IBPFT1}", fig.scap="PFTs and Intrinsic Memory (Iberian Region)", cache = TRUE, cache.lazy=FALSE, fig.pos = 'h!'}
IBPFT1 <- Tryres(Region = "Iberian Region", SoilLayer = 1, Variable = "t-1")
```

Untreated geo-referenced records of \vh and \nmass are correlated positively with \ndvil memory effects. This is not in accordance with my earlier hypotheses but based on the most reliable data.

Using the \PFT maps obtained via the \PFT mapping approach outlined in figure \ref{fig:PFTCombining}, one obtains negative correlations of \vh, and \nmass with \ndvil memory effects. These relationships can arguabely be seen as synonymous with the \ndvil vegetation memory sensitivity relationship: Areas of lower biomass (low mean \ndvi, low \vh, and low \nmass) exhibit tronger intrinsic vegetation memory.

```{r IBPFTTab1, results = 'asis', echo = FALSE}
TryTab(Region = "Iberian Region", ModelCoeffs = IBPFT1, SoilLayer = 1, Variable = "$NDVI_{[t-1]}$")
```

\clearpage

\paragraph*{Air Temperature}  \hspace{.5cm}
Relationships of \tair vegetation memory coefficients and \vh, and \nmass records across the Iberian region are represented in figure \ref{fig:IBPFT2}. These relationships have been assessed through linear regressions the coefficients of which are represented in table \ref{tab:IBPFTTab2}.
```{r IBPFT2, echo = FALSE, fig.width = 17, fig.height = 14, fig.subcap=c('Height', 'Nitrogen'), fig.ncol = 2, out.width='.5\\linewidth', fig.cap="\\textbf{PFTs and Tair Memory (Iberian Region) -} Tair Memory (figure \\ref{fig:IBRVegMem1}) plotted against expressions of (a) \\vh, and (b) \\nmass both via geo-referenced \\TRY records and mapped species-specific trait means (figure \\ref{fig:IBPTRY}). Figure established via \\ref{rTRYRes}. \\label{fig:IBPFT2}", fig.scap="PFTs and Tair Memory (Iberian Region)",  cache = TRUE, cache.lazy=FALSE, fig.pos = 'h!'}
IBPFT2 <- Tryres(Region = "Iberian Region", SoilLayer = 1, Variable = "Tair")
```

Untreated, geo-referenced records of \vh, and \nmass are correlated negatively with \tair vegetation memory effects (not statistically significant in the case of the latter, though).

When using mapped species-specific mean \PFT records, these relationships are turned around again with \vh and \nmass now positive correlated with \tair vegetation memory coefficients.

```{r IBPFTTab2, results = 'asis', echo = FALSE}
TryTab(Region = "Iberian Region", ModelCoeffs = IBPFT2, SoilLayer = 1, Variable = "Tair")
```

\clearpage

\paragraph*{Soil Moisture (0-7cm)}  \hspace{.5cm}
Relationships of \qsoila vegetation memory length, and coefficients and \vh, and \nmass records across the Iberian region are represented in figure \ref{fig:IBPFT3}. These relationships have been assessed through linear regressions, the coefficients of which are depicted in table \ref{tab:IBPFTTab3}. 
```{r IBPFT3, echo = FALSE, fig.width = 17, fig.height = 14, fig.subcap=c('Height', 'Nitrogen'), fig.ncol = 2, out.width='.5\\linewidth', fig.cap="\\textbf{PFTs and Qsoil1 Memory (Iberian Region) -} \\qsoila Memory (figure \\ref{fig:IBRVegMem1}) plotted against expressions of (a) \\vh, and (b) \\nmass both via geo-referenced \\TRY records and mapped species-specific trait means (figure \\ref{fig:IBPTRY}). Figure established via \\ref{rTRYRes}. \\label{fig:IBPFT3}", fig.scap="PFTs and Qsoil1 Memory (Iberian Region)", cache = TRUE, cache.lazy=FALSE, fig.pos = 'h!'}
IBPFT3 <- Tryres(Region = "Iberian Region", SoilLayer = 1, Variable = "Qsoil")
```
My analyses identified statistically significant relationships for all \qsoila related vegetation memory coefficients (with the exception of untreated \vh records and \qsoila memory length). 

Whilst geo-referenced data records of \vh and \nmass establish themselves in positive correlations with \qsoila memory effects and \qsoila memory length in the case of \vh, mapped mean trait values of \vh and \nmass are correlated negatively to \qsoila related vegetation memory coefficients.
```{r IBPFTTab3, results = 'asis', echo = FALSE}
TryTab(Region = "Iberian Region", ModelCoeffs = IBPFT3, SoilLayer = 1, Variable = "Qsoil")
```

\clearpage

### Summary
#### Life History Traits

Linear regressions of \COMPADRE data against vegetation memory coefficients have proven **largely inconclusive**.

Making use of \COMPADRE data across the **Iberian region**, \COMPADRE \textbf{reactivity} emerged as an \textbf{important factor in explaining vegetation memory patterns}:

\begin{enumerate}
\item \ndvil memory strength decreases as reactivity increases.
\item \tair memory strength increases as reactivity increases.
\item \qsoil memory strength decreases as reactivity increases.
\end{enumerate}

Overall, **vegetation memory strength decreases** as **reactivity increases**.

\vspace{1cm}
#### Plant Functional Traits

Analyses of the relationships of \PFT expressions and vegetation memory characteristics revealed that:

\begin{enumerate}
\item \textbf{Geo-referenced \PFT records can be linked to vegetation memory characteristics} in a statistically significant way:
  \begin{itemize}
  \item \ndvil memory effects increase as \vh and \nmass increase.
  \item \tair memory effects decrease as \vh and \nmass increase.
  \item \qsoila memory effects increase as \vh and \nmass increase.
  \end{itemize}
\item \textbf{Mapped species-specific \PFT means can be linked to patterns of vegetation memory} characteristics:\begin{itemize}
  \item \ndvil memory effects decrease as \vh and \nmass increase.
  \item \tair memory effects increase as \vh and \nmass increase.
  \item \qsoila memory effects decrease as \vh and \nmass increase.
  \end{itemize}
\item There is a \textbf{mismatch between geo-referenced \PFT records and mapped species-specific trait means} in that relationships of the two towards the same vegetation memory characteristics often follow positive and negative relationships, respectively. 
\end{enumerate}

\clearpage

# Discussion
## Vegetation Memory

### Intrinsic Memory
According to my analyses, intrinsic vegetation memory (identified as \ndvil coefficients) is positive in sign across all three study regions. Thus, I conclude that vegetation returns to a post-disturbance equilibrium following a disturbance in a linear fashion.

The strongest intrinsic vegetation memory effects can be found throughout the dryland regions. Due to the proposed inverse link between intrinsic vegetation memory and engineering resilience, my study has thus identified dryland regions to exert lower engineering resilience (i.e. slower recovery rates) than surrounding non-dryland regions. These findings link up remarkably well with De Keersmaecker et al. across all study regions\cite{DeKeersmaecker2015}. Regarding the \ndvil analysis carried out by Seddon et al.\cite{Seddon2016}, I have identified similar patterns of \ndvil across the Iberian Region as well as the Caatinga. Across Australia, however, my findings of \ndvil memory patterns deviate significantly from the west-to-east drop-off in \ndvil intensity identified by Seddon et al.

The negative correlation of \ndvil memory effects to mean \ndvi records suggests that high memory/low resilience is linked to regions of low biomass (low mean \ndvi records). This effect holds true across all three study regions thus identifying a global link between vegetation memory and plant biomass reminiscent of the concept of material legacies proposed by Johnstone et al\cite{Johnstone2016}.


### Extrinsic Memory
#### Soil Moisture
\paragraph*{Soil Moisture Effects}  \hspace{.5cm}

I have identified positive effects of extrinsic \qsoil vegetation memory across the dryland portions of all three study regions. These patterns are almost identical to the distributions of arid and semi-arid ombrotypes (see figures \ref{fig:OmbroEU}, \ref{fig:OmbroSA}, and \ref{fig:OmbroAU}). Thus, dryland vegetation reacts positively to positive anomalies in soil moisture depicting the water limitation of drylands. Again, these findings closely mimic the findings by Seddon et al.\cite{Seddon2016} in showing similar patterns to the precipitation climate weight of their vegetation sensitivity index which highlights the importance of water limitations. Whilst some positive \qsoil vegetation memory effects have been identified for the sub-humid typified areas across the study regions (e.g. south-western France) these are much weaker than the \qsoil effects within the adjacent dryland regions. Conclusively, dryland vegetation reacts stronger and ore positive to positive \qsoil anomalies than plants located in sub-humid regions.

Across all three study regions \qsoila is the most informative \qsoil layer in identifying extrinsic \qsoil vegetation memory. This may be due to how accurate the different \qsoil layers can resolve local \qsoil regimes. However, I suggest that this effect is not driven through data shortcomings but rather due to biological adaptations. I postulate that vegetation in the three study regions predominately receives water from the upper 7cm of the soil thus making the \qsoila layer the most important one in determining plant performance (i.e. \ndvi). Water availability to dryland vegetation is largely influenced by precipitation events\cite{Felton2019} and soil pore connectivity\cite{Smith2017}. Therefore, water is often introduced to dryland regions to the uppermost soil layer from where residual water (water that is not directly absorbed by plants, withheld in the soil, or evaporated) descends into lower soil layers. Plants are involved in a constant competition to pre-empt water resources in which I expect a plant which obtains water from shallow soil layers to tap into a larger pool of water than a plant at lower soil layers (this scenario does not factor in ground water levels, of course). To my mind, this leads into an \ess of dryland vegetation obtaining water through soil moisture in as shallow a soil layer as possible to not be pre-empted in the race for water. Conclusively, vegetation in the three study regions has adapted to quickly respond to precipitation events thus making it so that water is mostly taken up from the first soil layer before it sinks to lower soil layers.

The negative correlation of \qsoil memory effects to mean \qsoil records highlights an increased resistance potential towards \qsoil anomalies exerted by vegetation in sub-humid regions when compared to semi-arid and arid regions. Across the humid areas and high-altitude areas of the Iberian Region as well as the western Tasmanian coastline are characterised by weakened vegetation resistance against \qsoil anomalies. This highlights a climate niche of plants with low resistance at upper and lower ends of the moisture spectrum, and high resistance to \qsoil anomalies at intermediate moisture levels. These niche patterns can be identified across the Iberian Region and the Caatinga. Throughout Australia, this relationship is much weaker ($\sim \frac{1}{10}$ of the forcing across the Caatinga and $\sim \frac{1}{20}$ of the forcing across the Iberian Region). I conclude that this is either due to a larger climatic \qsoil niche of vegetation across Australia or the fact that most of the Australian study region is made up of arid and semi-arid areas thus diminishing the chance of identifying vegetation memory sensitivity of non-dryland vegetation.

\paragraph*{Soil Moisture Memory Length}  \hspace{.5cm}

Across the Iberian Region and the Caatinga, the shortest \qsoil memory is located in regions of strong (positive or negative) memory effects. From this, I conclude that low resistance (i.e. high \qsoil memory strength) systems react fast (i.e. short \qsoil memory length) to perturbations. No such connection can be made across Australia largely because of the homogeneous pattern of strong, positive \qsoila memory effects. I postulate that this points towards different processes shaping the temporal responses of local vegetation towards \qsoil anomalies between Australia and the remaining two study regions.

In regions of strong \qsoil memory, memory length is shortest in the Caatinga, intermediate across Australia and longest across the Iberian Region. Thus, impacts of \qsoil manifest on different time-scales given geographical location and local factors (either abiotic or biological). 

Across, all three study regions, \qsoil memory length decreases as mean \qsoil conditions become wetter. This relationship is most pronounced across the Iberian Region, less so throughout Australia, and least across the Caatinga. This translates to \qsoila vegetation memory length being longer in dryland regions than in sub-humid/humid regions. Therefore, dryland vegetation is influenced by antecedent \qsoil anomalies for a longer time than non-dryland plants.

As described above, patterns of \qsoil memory length and \ndvil are positively correlated across the Iberian Region whilst the correlation is negative across the two remaining study regions. The weakest of these links can be identified for Australia. Once more, this highlights that the three study regions are subject to different processes driving the intrinsic and extrinsic components of vegetation memory.

The \qsoil memory length pattern across Australia is reminiscent of the \ndvil pattern identified by Seddon et al\cite{Seddon2016}. It is viable to assume that \ndvil serves as a catch-all variable by portraying antecedent extrinsic memory effects through intrinsic memory effects. This becomes more apparent when considering the variance partitioning results which identified \ndvil to explain the most variation in \ndvi anomalies with great shared variance between \ndvil and \qsoila across Australia. One can expect the importance of \ndvil in vegetation memory modelling approaches to decrease as more relevant antecedent extrinsic data is considered.

#### Air Temperature
Instantaneous vegetation response to positive \tair anomalies is negative across dryland areas of all three study regions. This depicts negative effects of increased evaporation and levels of aridity that are \tair-driven on dryland vegetation. In northern regions and high altitude areas of the Iberian Region, these effects are positive signalling that vegetation in cold/wet regions reacts positively to positive anomalies in \tair. This, in turn, depicts positive effects of increased solar radiation (coupled with higher \tair records) and increased speeds of biological processes in higher temperatures.

The negative correlation of instantaneous \tair effects to mean \tair records points to climate niches of plants with low resistance at upper and lower \tair spectrum, and high resistance to \tair anomalies at intermediate \tair levels.

#### Summary
According to U-Tests region-wide vegetation memory effects sizes are ranked as follows: \ndvil $>$ \qsoil (\qsoila $>$ \qsoilb $>$ \qsoilc $>$ \qsoild) $>$ \tair. This highlights that, across all three study regions, intrinsic vegetation memory drives systems more than extrinsic vegetation memory. This can be used to answer **research question 1.1**: 
\begin{center}
\textbf{\ndvil and \qsoila are the most robust intrinsic and extrinsic vegetation memory metrics, respectively.}
\end{center}
However, this is sure to depend on the study region. I have merely assessed dryland regions and hypothesise that Arctic or alpine region will be driven more by temperature than by water availability, for example.

*Plant niches and adaptive capabilites of vegetation* have been identified via vegetation memory as follows: The higher the environmental mean of a certain vegetation memory driver, the lower or the more negative the vegetation memory effect.

The clear overlap in patterns of \ndvil and \qsoila memory effects suggest that *intrinsic memory might be a masked extrinsic memory effect*. Additional support for this arguments stems from the fact that Seddon et al.'s\cite{Seddon2016} \ndvil pattern across Australia is reminiscent of the \qsoila memory length pattern identified here. Variance partitioning further underlines this by depicting great amounts of variance in my vegetation memory models being shared between \ndvil and \qsoila across Australia and less so across the other two study regions. This information can be used in answering **research question 1.2**: 
\begin{center}
\textbf{It is difficult to distinguish intrinsic and extrinsic memory in certain regions.}
\end{center}
This is due to the high portion of shared variance of \ndvil and extrinsic memory components. Further research into robust extrinsic vegetation memory metrics will undoubtedly serve to diminish the importance of \ndvil in these model approaches and aid in disentangling intrinsic and extrinsic vegetation memory.


\clearpage

## Functional Aspects of Vegetation Memory
\begin{itemize}
\item Research Question 2.1: \COMPADRE reactivity is related to vegetation memory \hfill \newline
$\rightarrow$ due to the direct link of first-time-step response to recovery rates and resistance potential
\item research Question 2.2: \COMPADRE Reactivity is the only \PFT/\LHT I can link to vegetation memory and captures information of both intrsinsic as well as extrinsic memory effects \hfill \newline
$\rightarrow$ Reactivity strongest linked to \qsoil and \tair effects \hfill \newline
$\rightarrow$ Reactivity almost as strongly linked to \ndvil effects \hfill \newline
$\rightarrow$ Assigning intrinsic/extrinsic memory effects to separate aspects of plant function/life histories is diffuclt and needs further research
\end{itemize}

### Life History Traits
\begin{itemize}
\item \COMPADRE data largely difficult to linkt o vegetation memory \hfill \newline
$\rightarrow$ because of data availability and coverage (especially across Australia and Caatinga)
\item \COMPADRE Reactivity can be linked to vegetation memory 
  \begin{itemize}
  \item Negative correlation of Reactivity and \ndvil and \qsoil memory effects \hfill \newline
$\rightarrow$ \ndvil: stronger first-time-step biological response (reactivity) decreases intrinsic vegetation memory and thus enhances recovery \hfill \newline
$\rightarrow$ \qsoil: stronger first-time-step biological response (reactivity) decreases \qsoil vegetation memory and thus ehances \qsoil anomaly resistance
\item Positive correlation of Reactivity and \tair memory effects \hfill \newline
$\rightarrow$ Increased reactivity at the cost of \tair resistance?  \hfill \newline
$\rightarrow$ Instanteneous response can't be captured by first-time-step response (reactivity) \hfill \newline
$\rightarrow$ More research needed?
  \end{itemize}
\end{itemize}

### Plant Functional Traits
\begin{itemize}
\item \PFTs can't be linked to vegetation memory in this study (this is morrored to an extent by Lauglin et al.\cite{Laughlin2018}) \hfill \newline
$\rightarrow$ because of data availability and coverage? \hfill \newline
$\rightarrow$ Due to changes in \PFT composition over time not being taken into account?
\item Mismatch in identified (non-significant) links of \PFTs and vegetation memory \hfill \newline
$\rightarrow$ suggest that the \PFT mapping approach needs further developing or data quality is subpar (probably a combination of the two)
\end{itemize}

# Conclusion

Repeat research questions and highlight significance

**Outlook**  
1. Soil moisture-driven drought indices\cite{Sohrabi2015}  
2. Use \BIEN data


<!--- ####### BIBLIOGRAPHY ---------------------------------------------------------->
\phantomsection
\addcontentsline{toc}{chapter}{Bibliography}
\titleformat{\chapter}{\normalfont\huge\bfseries}{}{0pt}{\Huge}
\titlespacing*{\chapter}{0pt}{10pt}{30pt}
\MakeBib

<!--- ####### APPENDIX ---------------------------------------------------------->
\titleformat{\chapter}{\normalfont\huge\bfseries}{}{0pt}{\Huge}
\titlespacing*{\chapter}{0pt}{-30pt}{30pt}
\appendix  

# Appendix

## Project Requirements

Following these steps ensures full reproducibility of the entire analysis. Alternatively, codes can be retrieved via \url{https://github.com/ErikKusch/M.Sc.Thesis}.

With the exception of python, bash, and matlab scripts to obtain \era data, have been carried out in `R`\cite{R} using the functionality contained within the base installation as well as the packages outlined in table \ref{tab:rPackages}. \ref{rPackages} contains the `R` commands used to install all packages needed to reproduce the analyses of this study from a base installation of `R`. Data sources and methods of data retrieval are stated for each data set individually. All codes needed to reproduce the analysis at the core of this thesis have been included to this document in section \ref{S:RAnalyses}. Note that the computation can be sped up by altering the `Cores` argument to enable parallel processing via the `foreach` and `doparallel`\cite{R-doParallel} packages.

### `R` Requirements

#### `R` Packages

\renewcommand{\arraystretch}{1}
\begin{table*}[h!]
  \centering
  \caption[R Packages]{\textbf{R Packages -} Packages which need to be loaded into R to fully reproduce the analyses within this study.}
    \begin{tabular}{|L{4cm}L{4cm}L{8.5cm}|}
    \hline
    \bfseries Package  & \bfseries Version & Use \\
    \hline
    automap\cite{R-automap} & 1.0-14 & Statistical Downscaling of \era5 data \\
    doParallel\cite{R-doParallel} & 1.0.14 & Paralell processing \\
    foreach\cite{R-foreach} &  1.4.4 &  Paralell processing \\
    gameofthrones\cite{R-GoT} &  1.0.0 &  Data visualisation\\
    ggplot2\cite{R-ggplot2} &  3.1.0 &  Data visualisation\\
    gimms\cite{R-Gimms} &  1.1.1 &  Downloading GIMMs NDVI3g data\\
    ncdf4\cite{R-ncdf4} & 1.16.1 &  Namespace for NetCDF files\\
    pracma\cite{R-pracma} & 2.2.2 &  Detrending time series\\
    raster\cite{R-Raster} & 2.8-19 &  Rasterising NetCDF data\\
    rgbif\cite{R-gbif} & 1.2.0 &  Downloading floral occurence data\\
    rgdal\cite{R-rgdal} & 1.4-2 &  Loading and using shapefiles\\
    sp\cite{R-sp} & 1.3-1 &  Converting point data to rasterised data\\
    vegan\cite{R-vegan} & 2.5-4 &  PCA approach for model building\\
    xlsx\cite{R-xlsx} & 0.6.1 &  Export of numeric results\\
    \hline
    \end{tabular}%
  \label{tab:rPackages}%
\end{table*}

\footnotesize

```{r, code = readLines('Y - Codes/S0a_Packages.R'), eval = FALSE, ref = "rPackages", codecap = "Installing and loading of R packages needed to reproduce the analyses of this study.", tidy = TRUE}
```

\clearpage

#### Project Directories

\begin{figure}[h!]
\centering \includegraphics[width=.9\linewidth]{3 - Figures/FolderHierarchy.png}
\caption[Working Directories]{\textbf{Working Directories - }An overview of working directories established/required by \ref{rDirectories}.}
\label{fig:WDs}
\end{figure}

\footnotesize
```{r, code = readLines('Y - Codes/S0b_Directories.R'), eval = FALSE, ref = "rDirectories", codecap = "Identifing and generating the folder structure used within the computational steps. A visual overview is presented in \\ref{fig:WDs}.", tidy = FALSE}
```

\clearpage

#### `R` Functions for Region Selection and Raster Names

\footnotesize
```{r, code = readLines('Y - Codes/S0c_Functions.R'), eval = FALSE, ref = "rFunctions", codecap = "User-defined functions used to optimise further functions of this analysis when (1) Limitting to study regions (RegionSelection), and (2) assigning names to model rasters (Fun\\_NamesRas).", tidy = FALSE}
```

\clearpage

### ERA5 Data
#### Obtaining ERA5 Data
\footnotesize
```{python, code = readLines('Y - Codes/ERA5/All_1980s.py'), eval = FALSE, ref = "ObtainEra5", codecap = "Obtaining ERA5 data from the \\ecmwf servers. Substitute the date statement to download the full data set. Python script.", tidy = FALSE}
```

\vspace{.7cm}

#### Pre-Processing ERA5 Data
```{bash, code = readLines('Y - Codes/ERA5/Process_raw_input.sh'), eval = FALSE, ref = "ProcessEra5", codecap = "Processing ERA5 data from local downloads to merge by time step. Bash script.", tidy = TRUE}
```

```{python, code = readLines('Y - Codes/ERA5/Regrid_the_data.m'), eval = FALSE, ref = "RegridEra5", codecap = "Regridding ERA5 data to fit \\gimms and \\hwsd extents. Matlab script.", tidy = TRUE}
```

\clearpage


## Data
### HWSD Data
\vspace{-0.3cm}
\renewcommand{\arraystretch}{.8}
\begin{table*}[h!]
  \centering
  \caption[HWSD Variables and Explanations]{\textbf{HWSD Variables and Explanations -} HWSD variables used within this study and their explanations. Slope aspects and inclines are recorded as number of 3 arc-second cells falling into 5 minute cells}
    \begin{tabular}{|L{4cm}L{12.5cm}|}
    \hline
    \bfseries HWSD Variable  & \bfseries Explanation\\ \hline
    \textit{Elevation} & Altitude in metres as measured from sea-level\\
    \textit{Slope\_aspect\_N} & $(0^\circ; 45^\circ]$; $(315^\circ; 360^\circ]$ \\
    \textit{Slope\_aspect\_E} & $(45^\circ; 135^\circ]$ \\
    \textit{Slope\_aspect\_S} & $(135^\circ; 225^\circ]$ \\
    \textit{Slope\_aspect\_W} & $(225^\circ ; 315^\circ]$ \\
    \textit{Slope\_aspect\_U} & Slope undefined or slope incline is less than $2\%$ \\
    \textit{Slopes1} & $0\% \leq$ incline $\leq 0.5\%$ \\
    \textit{Slopes2} & $0.5\% \leq$ incline $\leq 2\%$ \\
    \textit{Slopes3} & $2\% \leq$ incline $\leq 5\%$ \\
    \textit{Slopes4} & $5\% \leq$ incline $\leq 10\%$ \\
    \textit{Slopes5} & $10\% \leq$ incline $\leq 15\%$ \\
    \textit{Slopes6} & $15\% \leq$ incline $\leq 30\%$ \\
    \textit{Slopes7} & $30\% \leq$ incline $\leq 45\%$ \\
    \textit{Slopes8} & Incline $> 45\%$ \\
    \hline
    \end{tabular}
  \label{tab:HWSDOverview}
\end{table*}

\vspace{-0.7cm}

```{r CovPlota, echo = FALSE, fig.width = 16, fig.height = 12.5, fig.cap="\\textbf{HWSD slope aspect data -} \\hwsd data at \\gimms resolution divided by 1000 for displaying. Figure established via \\ref{rHWSDAOverview}. \\label{fig:HWSDAOverview}", fig.scap="HWSD slope aspect data", out.extra='',fig.pos = 'h!', cache = TRUE, cache.lazy=FALSE}
Covariates_vec <- c("Slopes1", "Slopes2", "Slopes3", "Slopes4", "Slopes5", "Slopes6", "Slopes7", "Slopes8",
                    "Slope_aspect_N", "Slope_aspect_E", "Slope_aspect_S", "Slope_aspect_W", "Slope_aspect_U", 
                    "Elevation")
Cov_fine <- list() # create empty list
for(c in 1:length(Covariates_vec)){ # cycle through all covariates and load the data
      Cov_fine[[c]] <- raster(paste(Dir.KrigCov, "/Co-variates_NativeResolution.nc", sep=""), 
                              varname = Covariates_vec[c])
      }
Cov_fine <- brick(Cov_fine) # make fine covariate data into one big brick

for(i in 1:13){
values(Cov_fine[[i]]) <- values(Cov_fine[[i]])/1000
}
par(mfrow = c(3,2))
for(i in 9:13){
  plot(Cov_fine[[i]], colNA = "black", cex.main = 2, legend.width = 1.5, legend.shrink=1, 
       axis.args=list(cex.axis=1.5), cex.axis = 1.5, legend = TRUE, col = terrain.colors(100), 
       main = Covariates_vec[[i]])
}
```

\clearpage

```{r CovPlotb, echo = FALSE, fig.width = 17, fig.height = 20, fig.cap="\\textbf{HWSD slope incline data -} \\hwsd data at \\gimms resolution. Data has been divided by 1000 for displaying. Figure established via \\ref{rHWSDIOverview}. \\label{fig:HWSDIOverview}", fig.scap="HWSD slope incline data", out.extra='',fig.pos = 'h!', cache = TRUE, cache.lazy=FALSE}
par(mfrow = c(4,2))
for(i in 1:8){
  plot(Cov_fine[[i]]/10, colNA = "black", cex.main = 2, legend.width = 1.5, legend.shrink=1, axis.args=list(cex.axis=1.5), cex.axis = 1.5, legend = TRUE, col = terrain.colors(100), main = Covariates_vec[[i]])
}
```


\clearpage

### Study Regions
#### Iberian Region
```{r SR_IBP1, echo = FALSE, fig.width = 17, fig.height = 19, out.extra='',fig.pos = 'h', cache = TRUE, cache.lazy=FALSE}
SR_Qsoil4 <- SRData("Iberian Region")
```
\vspace{-1.45cm}
```{r SR_IBP2, echo = FALSE, fig.width = 17, fig.height = 2, fig.cap="\\textbf{Data Overview (Iberian Region) -} Data required for identificiation of vegetation memory: (1) \\gimms \\ndvi 3g; and (2) ERA5: \\tair, \\qsoila, \\qsoilb, \\qsoilc, \\qsoild. Figure established via \\ref{rStudRegFun}. \\label{fig:IBPDataOverview}", fig.scap="Data Overview (Iberian Region)", out.extra='',fig.pos = 'h'}
plot(SR_Qsoil4, legend.only=TRUE, smallplot=c(0.05,.95,.2,.35), horizontal = TRUE, axis.args=list(cex.axis=2.5), col = col.qsoil, legend.args = list(text='Soil Moisture', side = 3, line = .1, cex = 2))
```

\clearpage

```{r SRIBP_TRY, echo = FALSE, fig.width = 17, fig.height = 17, fig.cap="\\textbf{TRY Data (Iberian Region) -} TRY PFT data across the Iberian Region: (1) Geo-referenced records (upper row), and (2) Extrapolated species-specific mean PFT records (lower row). Figure established via \\ref{rSRTRY}. \\label{fig:IBPTRY}", fig.scap="TRY Data (Iberian Region)", out.extra='',fig.pos = 'h', cache.lazy = FALSE}
TRYRegions(Region = "Iberian Region")
```
\clearpage

#### Caatinga, Brazil
```{r SR_Caat1, echo = FALSE, fig.width = 17, fig.height = 19, out.extra='',fig.pos = 'h', cache = TRUE, cache.lazy=FALSE}
SR_Qsoil4 <- SRData("Caatinga")
```
\vspace{-1.45cm}
```{r SR_Caat2, echo = FALSE, fig.width = 17, fig.height = 2, fig.cap="\\textbf{Data Overview (Caatinga, Brazil) -} Data required for identificiation of vegetation memory: (1) \\gimms \\ndvi 3g; and (2) ERA5: \\tair, \\qsoila, \\qsoilb, \\qsoilc, \\qsoild. Figure established via \\ref{rStudRegFun}. \\label{fig:CaatDataOverview}", fig.scap="Data Overview (Caatinga, Brazil)", out.extra='',fig.pos = 'h'}
plot(SR_Qsoil4, legend.only=TRUE, smallplot=c(0.05,.95,.2,.35), horizontal = TRUE, axis.args=list(cex.axis=2.5), col = col.qsoil, legend.args = list(text='Soil Moisture', side = 3, line = .1, cex = 2))
```

\clearpage

```{r SRCaat_TRY, echo = FALSE, fig.width = 17, fig.height = 17, fig.cap="\\textbf{TRY Data (Caatinga, Brazil) -} TRY PFT data across Caatinga, Brazil: (1) Geo-referenced records (upper row), and (2) Extrapolated sepcies-specific mean PFT records (lower row). Figure established via \\ref{rSRTRY}. \\label{fig:CaatTRY}", fig.scap="TRY Data (Caatinga, Brazil", out.extra='',fig.pos = 'h', cache.lazy = FALSE}
TRYRegions(Region = "Caatinga")
```
\clearpage

#### Australia
```{r SR_AU1, echo = FALSE, fig.width = 17, fig.height = 19, out.extra='',fig.pos = 'h', cache = TRUE, cache.lazy=FALSE}
SR_Qsoil4 <- SRData("Australia")
```
\vspace{-1.45cm}
```{r SR_AU2, echo = FALSE, fig.width = 17, fig.height = 2, fig.cap="\\textbf{Data Overview (Australia) -} Data required for identificiation of vegetation memory: (1) \\gimms \\ndvi 3g; and (2) ERA5: \\tair, \\qsoila, \\qsoilb, \\qsoilc, \\qsoild. Figure established via \\ref{rStudRegFun}. \\label{fig:AUDataOverview}", fig.scap="Data Overview (Australia)", out.extra='',fig.pos = 'h'}
plot(SR_Qsoil4, legend.only=TRUE, smallplot=c(0.05,.95,.2,.35), horizontal = TRUE, axis.args=list(cex.axis=2.5), col = col.qsoil, legend.args = list(text='Soil Moisture', side = 3, line = .1, cex = 2))
```

\clearpage

```{r SRAU_TRY, echo = FALSE, fig.width = 17, fig.height = 17, fig.cap="\\textbf{TRY Data (Australia) -} TRY PFT data across Australia: (1) Geo-referenced records (upper row), and (2) Extrapolated species-specific mean PFT records (lower row). Figure established via \\ref{rSRTRY}. \\label{fig:AUTRY}", fig.scap="TRY Data (Australia)", out.extra='',fig.pos = 'h', cache.lazy = FALSE}
TRYRegions(Region = "Australia")
```
\clearpage

## `R` Analyses Codes
\label{S:RAnalyses}

### Master File
\footnotesize
```{r, code = readLines('MScMaster.R'), eval = FALSE, ref = "rMaster", codecap = "Running the entire analysis once data has been allocated to directories. S0a\\_Packages.R can be found in \\ref{rPackages}, S0b\\_Directories.R is located in \\ref{rDirectories} whilst S0c\\_Functions.R is contained in \\ref{rFunctions}. S1\\_GIMMs.R, S2\\_ERA5.R, S3\\_VegetationMemory.R, S4\\_PFTs.R, and S4\\_COMPADRE.R are included in \\ref{rGimms}, \\ref{rEra5}, \\ref{rVegMem}, \\ref{rPFTs}, and \\ref{rCOMPADRE}, respectively.", tidy = FALSE}
```

\clearpage

### Vegetation Memory
#### GIMMs Data
\footnotesize
```{r, code = readLines('Y - Codes/S1_GIMMs.R'), eval = FALSE, ref = "rGimms", codecap = "Downloading GIMMs NDVI3g data, establishing rasters of monthly composites (RasterGIMMs), and creating NDVI raster stacks for each study region (CombineCDFs).", tidy = TRUE, cache.lazy=FALSE}
```

#### ERA5
\footnotesize
```{r, code = readLines('Y - Codes/S2_ERA5.R'), eval = FALSE, ref = "rEra5", codecap = "Kriging ERA5 data from \\era to \\gimms resolution using \\hwsd covariates (table \\ref{tab:HWSDOverview}) (RasterEra5).", tidy = FALSE, cache.lazy=FALSE}
```
#### Calculation of Vegetation Memory
\footnotesize
```{r, code = readLines('Y - Codes/S3_VegetationMemory.R'), eval = FALSE, ref = "rVegMem", codecap = "Computing vegetation memory for study regions as specified by lags, time frame, and variables to be considered (VegMem), scaling rasters of vegetation memory to be on the same scale for each study region (CoeffScaling).", tidy = FALSE, cache.lazy=FALSE}
```

\clearpage
### Plant Functional Traits
\footnotesize
```{r, code = readLines('Y - Codes/S4_PFTs.R'), eval = FALSE, ref = "rPFTs", codecap = "Calculating species-specific PFT means (PFTs), creating distribution maps from floral occurence data obtained from GBIF (DistMaps), and combine occurence maps with species trait means (PFTRasters).", tidy = FALSE, cache.lazy=FALSE}
```

\clearpage
### COMPADRE
\footnotesize
```{r, code = readLines('Y - Codes/S4_COMPADRE.R'), eval = FALSE, ref = "rCOMPADRE", codecap = "Extracting and rasterising COMPADRE data from COMPADRE data base for each study region (RasterCOMPADRE).", tidy = TRUE, cache.lazy=FALSE}
```

\clearpage  

## Results

### Vegetation Memory Models
#### Iberian Region
\vspace{.3cm}
\paragraph*{Model Coefficients (Soil Layer 2)}  \hspace{.5cm}
```{r IBRVegMem2, echo = FALSE, fig.width = 17, fig.height = 20, fig.subcap=c('SoilLag', 'Qsoil'), fig.ncol = 2, out.width='.5\\linewidth', fig.cap="\\textbf{Vegetation Memory Coefficients (Iberian Region; Qsoil2) -} Coefficients of vegetation memory obtained via model selection (figure \\ref{fig:ModScheme}) and \\pca regression (figure \\ref{fig:PCAREG}). Figure established via \\ref{rModelRes}. \\label{fig:IBRVegMem2}", fig.scap="Vegetation Memory Coefficients (Iberian Region; Qsoil2)", cache = TRUE, cache.lazy=FALSE, fig.pos = 'h!'}
ModelRes(Region = "Iberian Region", SoilLayer = 2)
```

```{r IBRU2, echo = FALSE, results = 'asis'}
Ures(Region = "Iberian Region", SoilLayer = 2)
```

\clearpage

\paragraph*{Model Coefficients (Soil Layer 3)}  \hspace{.5cm}
```{r IBRVegMem3, echo = FALSE, fig.width = 17, fig.height = 20, fig.subcap=c('SoilLag', 'Qsoil'), fig.ncol = 2, out.width='.5\\linewidth', fig.cap="\\textbf{Vegetation Memory Coefficients (Iberian Region; Qsoil3) -} Coefficients of vegetation memory obtained via model selection (figure \\ref{fig:ModScheme}) and \\pca regression (figure \\ref{fig:PCAREG}). Figure established via \\ref{rModelRes}. \\label{fig:IBRVegMem3}", fig.scap="Vegetation Memory Coefficients (Iberian Region; Qsoil3)", cache = TRUE, cache.lazy=FALSE, fig.pos = 'h!'}
ModelRes(Region = "Iberian Region", SoilLayer = 3)
```

```{r IBRU3, echo = FALSE, results = 'asis'}
Ures(Region = "Iberian Region", SoilLayer = 3)
```

\clearpage

\paragraph*{Model Coefficients (Soil Layer 4)}  \hspace{.5cm}
```{r IBRVegMem4, echo = FALSE, fig.width = 17, fig.height = 20, fig.subcap=c('SoilLag', 'Qsoil'), fig.ncol = 2, out.width='.5\\linewidth', fig.cap="\\textbf{Vegetation Memory Coefficients (Iberian Region; Qsoil4) -} Coefficients of vegetation memory obtained via model selection (figure \\ref{fig:ModScheme}) and \\pca regression (figure \\ref{fig:PCAREG}). Figure established via \\ref{rModelRes}. \\label{fig:IBRVegMem4}", fig.scap="Vegetation Memory Coefficients (Iberian Region; Qsoil4)", cache = TRUE, cache.lazy=FALSE, fig.pos = 'h!'}
ModelRes(Region = "Iberian Region", SoilLayer = 4)
```

```{r IBRU4, echo = FALSE, results = 'asis'}
Ures(Region = "Iberian Region", SoilLayer = 4)
```

\clearpage

\paragraph*{Soil Layer Comparison}  \hspace{.5cm}
```{r IBLayers, echo = FALSE, fig.width = 17, fig.height = 14, fig.subcap=c('Qsoil1', 'Qsoil2', 'Qsoil3', 'Qsoil4'), fig.ncol = 2, out.width='.5\\linewidth', fig.cap="\\textbf{Vegetation Memory Coefficients (Iberian Region, QSoil Layers) -} Vegetation memory coefficients of different \\qsoil layers. These are also contained in figures \\ref{fig:IBRVegMem1}, \\ref{fig:IBRVegMem2}, \\ref{fig:IBRVegMem3}, and \\ref{fig:IBRVegMem4} and have been scaled to be represented on the same colour axis for comparability. Figure established via \\ref{rSoilLayersRes}. \\label{fig:IBLayers}", fig.scap="Vegetation Memory Coefficients (Iberian Region, QSoil Layers)", cache = TRUE, cache.lazy=FALSE, fig.pos = 'h!'}
SoilLayersRes(Region = "Iberian Region")
```
\vspace{-.5cm}
```{r IBRQsoilU, echo = FALSE, results = 'asis'}
UQsoilres(Region = "Iberian Region")
```

\clearpage

#### Caatinga
\vspace{.3cm}
\paragraph*{Model Coefficients (Soil Layer 2)}  \hspace{.5cm}
```{r CAVegMem2, echo = FALSE, fig.width = 17, fig.height = 20, fig.subcap=c('SoilLag', 'Qsoil'), fig.ncol = 2, out.width='.5\\linewidth', fig.cap="\\textbf{Vegetation Memory Coefficients (Caatinga; Qsoil2) -} Coefficients of vegetation memory obtained via model selection (figure \\ref{fig:ModScheme}) and \\pca regression (figure \\ref{fig:PCAREG}). For an interpretation of these coefficients, see table \\ref{tab:CoeffsOverview}. Figure established via \\ref{rModelRes}. \\label{fig:CAVegMem2}", fig.scap="Vegetation Memory Coefficients (Caatinga; Qsoil2)", cache = TRUE, cache.lazy=FALSE, fig.pos = 'h!'}
ModelRes(Region = "Caatinga", SoilLayer = 2)
```
```{r CAU2, echo = FALSE, results = 'asis'}
Ures(Region = "Caatinga", SoilLayer = 2)
```

\clearpage
\paragraph*{Model Coefficients (Soil Layer 3)}  \hspace{.5cm}
```{r CAVegMem3, echo = FALSE, fig.width = 17, fig.height = 20, fig.subcap=c('SoilLag', 'Qsoil'), fig.ncol = 2, out.width='.5\\linewidth', fig.cap="\\textbf{Vegetation Memory Coefficients (Caatinga; Qsoil3) -} Coefficients of vegetation memory obtained via model selection (figure \\ref{fig:ModScheme}) and \\pca regression (figure \\ref{fig:PCAREG}). For an interpretation of these coefficients, see table \\ref{tab:CoeffsOverview}. Figure established via \\ref{rModelRes}. \\label{fig:CAVegMem3}", fig.scap="Vegetation Memory Coefficients (Caatinga; Qsoil3)", cache = TRUE, cache.lazy=FALSE, fig.pos = 'h!'}
ModelRes(Region = "Caatinga", SoilLayer = 3)
```
```{r CAU3, echo = FALSE, results = 'asis'}
Ures(Region = "Caatinga", SoilLayer = 3)
```

\clearpage
\paragraph*{Model Coefficients (Soil Layer 4)}  \hspace{.5cm}
```{r CAVegMem4, echo = FALSE, fig.width = 17, fig.height = 20, fig.subcap=c('SoilLag', 'Qsoil'), fig.ncol = 2, out.width='.5\\linewidth', fig.cap="\\textbf{Vegetation Memory Coefficients (Caatinga; Qsoil4) -} Coefficients of vegetation memory obtained via model selection (figure \\ref{fig:ModScheme}) and \\pca regression (figure \\ref{fig:PCAREG}). For an interpretation of these coefficients, see table \\ref{tab:CoeffsOverview}. Figure established via \\ref{rModelRes}. \\label{fig:CAVegMem4}", fig.scap="Vegetation Memory Coefficients (Caatinga; Qsoil4)", cache = TRUE, cache.lazy=FALSE, fig.pos = 'h!'}
ModelRes(Region = "Caatinga", SoilLayer = 4)
```

```{r CAU4, echo = FALSE, results = 'asis'}
Ures(Region = "Caatinga", SoilLayer = 4)
```

\clearpage

\paragraph*{Soil Layer Comparison}  \hspace{.5cm}
```{r CALayers, echo = FALSE, fig.width = 17, fig.height = 14, fig.subcap=c('Qsoil1', 'Qsoil2', 'Qsoil3', 'Qsoil4'), fig.ncol = 2, out.width='.5\\linewidth', fig.cap="\\textbf{Vegetation Memory Coefficients (Caatinga, QSoil Layers) -} Vegetation memory coefficients of different \\qsoil layers. These are also contained in figures \\ref{fig:CAVegMem1}, \\ref{fig:CAVegMem2}, \\ref{fig:CAVegMem3}, and \\ref{fig:CAVegMem4} and have been scaled to be represented on the same colour axis for comparability. Figure established via \\ref{rSoilLayersRes}. \\label{fig:CALayers}", fig.scap="Vegetation Memory Coefficients (Caatinga, QSoil Layers)", cache = TRUE, cache.lazy=FALSE, fig.pos = 'h!'}
SoilLayersRes(Region = "Caatinga")
```
\vspace{-.5cm}
```{r CAQsoilU, echo = FALSE, results = 'asis'}
UQsoilres(Region = "Caatinga")
```
\clearpage

#### Australia
\vspace{.3cm}
\paragraph*{Model Coefficients (Soil Layer 2)}  \hspace{.5cm}
```{r AUVegMem2, echo = FALSE, fig.width = 17, fig.height = 20, fig.subcap=c('SoilLag', 'Qsoil'), fig.ncol = 2, out.width='.5\\linewidth', fig.cap="\\textbf{Vegetation Memory Coefficients (Australia; Qsoil2) -} Coefficients of vegetation memory obtained via model selection (figure \\ref{fig:ModScheme}) and \\pca regression (figure \\ref{fig:PCAREG}). For an interpretation of these coefficients, see table \\ref{tab:CoeffsOverview}. Figure established via \\ref{rModelRes}. \\label{fig:AUVegMem2}", fig.scap="Vegetation Memory Coefficients (Australia; Qsoil2)", cache = TRUE, cache.lazy=FALSE, fig.pos = 'h!'}
ModelRes(Region = "Australia", SoilLayer = 2)
```
```{r AUU2, echo = FALSE, results = 'asis'}
Ures(Region = "Australia", SoilLayer = 2)
```

\clearpage
\paragraph*{Model Coefficients (Soil Layer 3)}  \hspace{.5cm}
```{r AUVegMem3, echo = FALSE, fig.width = 17, fig.height = 20, fig.subcap=c('SoilLag', 'Qsoil'), fig.ncol = 2, out.width='.5\\linewidth', fig.cap="\\textbf{Vegetation Memory Coefficients (Australia; Qsoil3) -} Coefficients of vegetation memory obtained via model selection (figure \\ref{fig:ModScheme}) and \\pca regression (figure \\ref{fig:PCAREG}). For an interpretation of these coefficients, see table \\ref{tab:CoeffsOverview}. Figure established via \\ref{rModelRes}. \\label{fig:AUVegMem3}", fig.scap="Vegetation Memory Coefficients (Australia; Qsoil3)", cache = TRUE, cache.lazy=FALSE, fig.pos = 'h!'}
ModelRes(Region = "Australia", SoilLayer = 3)
```
```{r AUU3, echo = FALSE, results = 'asis'}
Ures(Region = "Australia", SoilLayer = 3)
```

\clearpage
\paragraph*{Model Coefficients (Soil Layer 4)}  \hspace{.5cm}
```{r AUVegMem4, echo = FALSE, fig.width = 17, fig.height = 20, fig.subcap=c('SoilLag', 'Qsoil'), fig.ncol = 2, out.width='.5\\linewidth', fig.cap="\\textbf{Vegetation Memory Coefficients (Australia; Qsoil4) -} Coefficients of vegetation memory obtained via model selection (figure \\ref{fig:ModScheme}) and \\pca regression (figure \\ref{fig:PCAREG}). For an interpretation of these coefficients, see table \\ref{tab:CoeffsOverview}. Figure established via \\ref{rModelRes}. \\label{fig:AUVegMem4}", fig.scap="Vegetation Memory Coefficients (Australia; Qsoil4)", cache = TRUE, cache.lazy=FALSE, fig.pos = 'h!'}
ModelRes(Region = "Australia", SoilLayer = 4)
```
```{r AUU4, echo = FALSE, results = 'asis'}
Ures(Region = "Australia", SoilLayer = 4)
```

\clearpage

\paragraph*{Soil Layer Comparison}  \hspace{.5cm}
```{r AULayers, echo = FALSE, fig.width = 17, fig.height = 14, fig.subcap=c('Qsoil1', 'Qsoil2', 'Qsoil3', 'Qsoil4'), fig.ncol = 2, out.width='.5\\linewidth', fig.cap="\\textbf{Vegetation Memory Coefficients (Australia, QSoil Layers) -} Vegetation memory coefficients of different \\qsoil layers. These are also contained in figures \\ref{fig:AUVegMem1}, \\ref{fig:AUVegMem2}, \\ref{fig:AUVegMem3}, and \\ref{fig:AUVegMem4} and have been scaled to be represented on the same colour axis for comparability. Figure established via \\ref{rSoilLayersRes}. \\label{fig:AULayers}", fig.scap="Vegetation Memory Coefficients (Australia, QSoil Layers)", cache = TRUE, cache.lazy=FALSE, fig.pos = 'h!'}
SoilLayersRes(Region = "Australia")
```
\vspace{-.5cm}
```{r AUQsoilU, echo = FALSE, results = 'asis'}
UQsoilres(Region = "Australia")
```

\clearpage

### Variance Partitioning
\normalsize
#### Iberian Region
Variance partitioning of \ndvil and \qsoil has been assessed for all \qsoil layers. These results are presented in figure \ref{fig:IBRVarPar1} and show a clear pattern of \ndvil explaining an overwhelming majority of \ndvi z-scores. Variance explained by \qsoil and variance shared by \qsoil and \ndvil decrease through the soil layers.

Spatial patterns of explained variance (see figure \ref{fig:IBRVarPar2}) reveal that \ndvil and \qsoil are the most valuable as predictors \ndvi across the southern dryland regions of Spain and Portugal.

```{r IBVarPar1, echo = FALSE, fig.width = 17, fig.height = 14, fig.subcap=c('Soil Layer 1', 'Soil Layer 2', 'Soil Layer 3', 'Soil Layer 4'), fig.ncol = 2, out.width='.5\\linewidth', fig.cap="\\textbf{Variance Partitioning (Iberian Region; Qsoil1) -} Variance of \\ndvi anomalies explained by (a) full models of intrinsic and extrinsic memory, (b) intrinsic memory, (c) shared variance, and (d) extrinsic memory. A representation of how these were calculated can be retrieved in figure \\ref{fig:VarPar}. Figure established via \\ref{rVarParRes}. \\label{fig:IBRVarPar1}", fig.scap="Variance Partitioning (Iberian Region; Qsoil1)", cache = TRUE, cache.lazy=FALSE, fig.pos = 'h!'}
VarParRes(Region = "Iberian Region", SoilLayer = 1, Plot = 1)
VarParRes(Region = "Iberian Region", SoilLayer = 2, Plot = 1)
VarParRes(Region = "Iberian Region", SoilLayer = 3, Plot = 1)
VarParRes(Region = "Iberian Region", SoilLayer = 4, Plot = 1)
```
\clearpage
```{r IBRVarPar2, echo = FALSE, fig.width = 17, fig.height = 12.5, fig.subcap=c('Total', 't-1', 'Shared', 'Qsoil'), fig.ncol = 3, out.width='.33\\linewidth', fig.cap="\\textbf{Variance Partitioning (Iberian Region) -} Variance of \\ndvi anomalies explained by (a,d,g,j) full models of intrinsic and extrinsic memory, (b,e,h,k) intrinsic memory, (c,f,i,l) shared variance, and (d) extrinsic memory across soil layers \\qsoila to \\qsoild. A representation of how these were calculated can be retrieved in figure \\ref{fig:VarPar}. Figure established via \\ref{rVarParRes}. \\label{fig:IBRVarPar2}", fig.scap="Variance Partitioning (Iberian Region; Qsoil1)", cache = TRUE, cache.lazy=FALSE, fig.pos = 'h!'}
VarParRes(Region = "Iberian Region", SoilLayer = 1, Plot = 2)
VarParRes(Region = "Iberian Region", SoilLayer = 2, Plot = 2)
VarParRes(Region = "Iberian Region", SoilLayer = 3, Plot = 2)
VarParRes(Region = "Iberian Region", SoilLayer = 4, Plot = 2)
```

\clearpage

#### Caatinga
Variance partitioning of \ndvil and \qsoil has been assessed for all \qsoil layers. These results are presented in figure \ref{fig:CAVarPar1} and show a clear pattern of \ndvil explaining an overwhelming majority of \ndvi z-scores. Variance explained by \qsoil and variance shared by \qsoil and \ndvil decrease through the soil layers.

Spatial patterns of explained variance (see figure \ref{fig:CAVarPar2}) reveal that \ndvil and \qsoil are the most valuable as predictors \ndvi across the north-eastern dryland region.


```{r CAVarPar1, echo = FALSE, fig.width = 17, fig.height = 14, fig.subcap=c('Soil Layer 1', 'Soil Layer 2', 'Soil Layer 3', 'Soil Layer 4'), fig.ncol = 2, out.width='.5\\linewidth', fig.cap="\\textbf{Variance Partitioning (Caatinga; Qsoil1) -} Variance of \\ndvi anomalies explained by (a) full models of intrinsic and extrinsic memory, (b) intrinsic memory, (c) shared variance, and (d) extrinsic memory. A representation of how these were calculated can be retrieved in figure \\ref{fig:VarPar}. Figure established via \\ref{rVarParRes}. \\label{fig:CAVarPar1}", fig.scap="Variance Partitioning (Caatinga; Qsoil1)", cache = TRUE, cache.lazy=FALSE, fig.pos = 'h!'}
VarParRes(Region = "Caatinga", SoilLayer = 1, Plot = 1)
VarParRes(Region = "Caatinga", SoilLayer = 2, Plot = 1)
VarParRes(Region = "Caatinga", SoilLayer = 3, Plot = 1)
VarParRes(Region = "Caatinga", SoilLayer = 4, Plot = 1)
```
\clearpage
```{r CAVarPar2, echo = FALSE, fig.width = 17, fig.height = 12.5, fig.subcap=c('Total', 't-1', 'Shared', 'Qsoil'), fig.ncol = 3, out.width='.33\\linewidth', fig.cap="\\textbf{Variance Partitioning (Caatinga) -} Variance of \\ndvi anomalies explained by (a,d,g,j) full models of intrinsic and extrinsic memory, (b,e,h,k) intrinsic memory, (c,f,i,l) shared variance, and (d) extrinsic memory across soil layers \\qsoila to \\qsoild. A representation of how these were calculated can be retrieved in figure \\ref{fig:VarPar}. Figure established via \\ref{rVarParRes}. \\label{fig:CAVarPar2}", fig.scap="Variance Partitioning (Caatinga; Qsoil1)", cache = TRUE, cache.lazy=FALSE, fig.pos = 'h!'}
VarParRes(Region = "Caatinga", SoilLayer = 1, Plot = 2)
VarParRes(Region = "Caatinga", SoilLayer = 2, Plot = 2)
VarParRes(Region = "Caatinga", SoilLayer = 3, Plot = 2)
VarParRes(Region = "Caatinga", SoilLayer = 4, Plot = 2)
```

\clearpage

#### Australia

Variance partitioning of \ndvil and \qsoil has been assessed for all \qsoil layers. These results are presented in figure \ref{fig:AUVarPar1} and show a clear pattern of \ndvil explaining an overwhelming majority of \ndvi z-scores. Variance explained by \qsoil and variance shared by \qsoil and \ndvil decrease through the soil layers.

Spatial patterns of explained variance (see figure \ref{fig:AUVarPar2}) reveal that \ndvil and \qsoil are the most valuable as predictors \ndvi across the Outback with patchy distributions.

```{r AUVarPar1, echo = FALSE, fig.width = 17, fig.height = 14, fig.subcap=c('Soil Layer 1', 'Soil Layer 2', 'Soil Layer 3', 'Soil Layer 4'), fig.ncol = 2, out.width='.5\\linewidth', fig.cap="\\textbf{Variance Partitioning (Australia; Qsoil1) -} Variance of \\ndvi anomalies explained by (a) full models of intrinsic and extrinsic memory, (b) intrinsic memory, (c) shared variance, and (d) extrinsic memory. A representation of how these were calculated can be retrieved in figure \\ref{fig:VarPar}. Figure established via \\ref{rVarParRes}. \\label{fig:AUVarPar1}", fig.scap="Variance Partitioning (Australia; Qsoil1)", cache = TRUE, cache.lazy=FALSE, fig.pos = 'h!'}
VarParRes(Region = "Australia", SoilLayer = 1, Plot = 1)
VarParRes(Region = "Australia", SoilLayer = 2, Plot = 1)
VarParRes(Region = "Australia", SoilLayer = 3, Plot = 1)
VarParRes(Region = "Australia", SoilLayer = 4, Plot = 1)
```
\clearpage
```{r AUVarPar2, echo = FALSE, fig.width = 17, fig.height = 12.5, fig.subcap=c('Total', 't-1', 'Shared', 'Qsoil'), fig.ncol = 3, out.width='.33\\linewidth', fig.cap="\\textbf{Variance Partitioning (Australia) -} Variance of \\ndvi anomalies explained by (a,d,g,j) full models of intrinsic and extrinsic memory, (b,e,h,k) intrinsic memory, (c,f,i,l) shared variance, and (d) extrinsic memory across soil layers \\qsoila to \\qsoild. A representation of how these were calculated can be retrieved in figure \\ref{fig:VarPar}. Figure established via \\ref{rVarParRes}. \\label{fig:AUVarPar2}", fig.scap="Variance Partitioning (Australia; Qsoil1)", cache = TRUE, cache.lazy=FALSE, fig.pos = 'h!'}
VarParRes(Region = "Australia", SoilLayer = 1, Plot = 2)
VarParRes(Region = "Australia", SoilLayer = 2, Plot = 2)
VarParRes(Region = "Australia", SoilLayer = 3, Plot = 2)
VarParRes(Region = "Australia", SoilLayer = 4, Plot = 2)
```

\clearpage

<!-- ### Functional Aspects of Vegetation Memory -->
<!-- ```{r IBPFTTabRaw, results = 'asis', echo = FALSE} -->
<!-- options(digits=2, width = 90) -->
<!-- PFTTab(ModelCoeffs = c(unlist(IBPFT1)[c(1:4, 9:12)], unlist(IBPFT2)[c(1:4, 9:12)],  -->
<!--                  unlist(IBPFT3)[c(1:4, 9:12)], unlist(IBPFT4)[c(1:4, 9:12)],  -->
<!--                  unlist(IBPFT5)[c(1:4, 9:12)], unlist(IBPFT6)[c(1:4, 9:12)]), Region = "Iberian Region", Data = "Geo-referenced") -->
<!-- ``` -->

<!-- ```{r IBPFTTabMapped, results = 'asis', echo = FALSE} -->
<!-- options(digits=2, width = 90) -->
<!-- PFTTab(ModelCoeffs = c(unlist(IBPFT1)[c(5:8, 13:16)], unlist(IBPFT2)[c(5:8, 13:16)],  -->
<!--                  unlist(IBPFT3)[c(5:8, 13:16)], unlist(IBPFT4)[c(5:8, 13:16)],  -->
<!--                  unlist(IBPFT5)[c(5:8, 13:16)], unlist(IBPFT6)[c(5:8, 13:16)]), Region = "Iberian Region", Data = "Mapped species-specific mean") -->
<!-- ``` -->


<!-- #### Caatinga -->


<!-- ```{r CAPFTTabRaw, results = 'asis', echo = FALSE} -->
<!-- options(digits=2, width = 90) -->
<!-- PFTTab(ModelCoeffs = c(unlist(CAPFT1)[c(1:4, 9:12)], unlist(CAPFT2)[c(1:4, 9:12)],  -->
<!--                  unlist(CAPFT3)[c(1:4, 9:12)], unlist(CAPFT4)[c(1:4, 9:12)],  -->
<!--                  unlist(CAPFT5)[c(1:4, 9:12)], unlist(CAPFT6)[c(1:4, 9:12)]), Region = "Caatinga", Data = "Geo-referenced") -->
<!-- ``` -->

<!-- ```{r CAPFTTabMapped, results = 'asis', echo = FALSE} -->
<!-- options(digits=2, width = 90) -->
<!-- PFTTab(ModelCoeffs = c(unlist(CAPFT1)[c(5:8, 13:16)], unlist(CAPFT2)[c(5:8, 13:16)],  -->
<!--                  unlist(CAPFT3)[c(5:8, 13:16)], unlist(CAPFT4)[c(5:8, 13:16)],  -->
<!--                  unlist(CAPFT5)[c(5:8, 13:16)], unlist(CAPFT6)[c(5:8, 13:16)]), Region = "Caatinga", Data = "Mapped species-specific mean") -->
<!-- ``` -->

<!-- \clearpage -->

<!-- #### Australia -->

<!-- ```{r AUPFTTabRaw, results = 'asis', echo = FALSE} -->
<!-- options(digits=2, width = 90) -->
<!-- PFTTab(ModelCoeffs = c(unlist(AUPFT1)[c(1:4, 9:12)], unlist(AUPFT2)[c(1:4, 9:12)],  -->
<!--                  unlist(AUPFT3)[c(1:4, 9:12)], unlist(AUPFT4)[c(1:4, 9:12)],  -->
<!--                  unlist(AUPFT5)[c(1:4, 9:12)], unlist(AUPFT6)[c(1:4, 9:12)]), Region = "Australia", Data = "Geo-referenced") -->
<!-- ``` -->

<!-- ```{r AUPFTTabMapped, results = 'asis', echo = FALSE} -->
<!-- options(digits=2, width = 90) -->
<!-- PFTTab(ModelCoeffs = c(unlist(AUPFT1)[c(5:8, 13:16)], unlist(AUPFT2)[c(5:8, 13:16)],  -->
<!--                  unlist(AUPFT3)[c(5:8, 13:16)], unlist(AUPFT4)[c(5:8, 13:16)],  -->
<!--                  unlist(AUPFT5)[c(5:8, 13:16)], unlist(AUPFT6)[c(5:8, 13:16)]), Region = "Australia", Data = "Mapped species-specific mean") -->
<!-- ``` -->

\clearpage

## `R` Data Visualisation Codes

### Preamble
\footnotesize
```{r PreambShow, eval = FALSE, ref = "rPreambsShow", codecap = "Preamble needed for processing the following chunks within this manuscript.", tidy = TRUE}
source("S0a_Packages.R") # loading packages
source("S0b_Directories.R") # setting directories
source("S0c_Functions.R") # Loading miscellaneous functions
col.NDVI <- rev(terrain.colors(100))
col.qsoil <- colorRampPalette(c("yellow", "burlywood", "beige", "turquoise", "deepskyblue"))(100)
col.tair <- colorRampPalette(c("blue","turquoise", "yellow", "orange", "red"))(100)
SR_cols <- list(col.NDVI, col.tair, col.qsoil, col.qsoil, col.qsoil, col.qsoil)
SR_Titles <- list("NDVI", "Air Temperature", "Soil Moisture (0-7cm)", "Soil Moisture (7-28cm)", "Soil Moisture (28-100cm)", "Soil Moisture (100-255cm)")
setwd(Dir.KrigCov)
Elevation <- raster(list.files()[2], varname = "Elevation")
ElevationF <- raster(list.files()[1], varname = "Elevation")
```

### Data Overview

#### NDVI
\footnotesize
```{r ref.label='NDVIOverview', eval = FALSE, ref = "rNDVIOverview", codecap = "Plotting global NDVI mean for the time frame of 1982 - 2015.", tidy = TRUE}
```

#### ERA5
\footnotesize
```{r ref.label='QsoilPlot', eval = FALSE, ref = "rQsoilOverview", codecap = "Two by two plotting of global soil moisture indices across four different soil layers all on the same scale.", tidy = FALSE}
```
\footnotesize
```{r ref.label='ATPlot', eval = FALSE, ref = "rATOverview", codecap = "Plotting mean air temperature from 1982 - 2015 globally.", tidy = FALSE}
```

\clearpage

#### HWSD 
\footnotesize

```{r ref.label='CovPlot', eval = FALSE, ref = "rEleOverview", codecap = "Plotting HWSD elevation data.", tidy = TRUE}
```

\footnotesize
```{r ref.label='CovPlota', eval = FALSE, ref = "rHWSDAOverview", codecap = "Loading HWSD data and plotting HWSD slope incline data.", tidy = FALSE}
```

\footnotesize
```{r ref.label='CovPlotb', eval = FALSE, ref = "rHWSDIOverview", codecap = "Plotting HWSD slope aspect data", tidy = TRUE}
```

\clearpage

<!-- #### TRY -->
<!-- \footnotesize -->
<!-- ```{r ref.label='ShowTRYH', eval = FALSE, ref = "rHOverview", codecap = "Plotting global \\vh \\TRY data with a background plot of land mass.", tidy = TRUE} -->
<!-- ``` -->
<!-- \footnotesize -->
<!-- ```{r ref.label='ShowTRYN', eval = FALSE, ref = "rNOverview", codecap = "Plotting global \\nmass \\TRY data with a background plot of land mass.", tidy = TRUE} -->
<!-- ``` -->

<!-- #### COMPADRE -->

<!-- \footnotesize -->
<!-- ```{r ref.label='ShowCOMPADRE', eval = FALSE, ref = "rCOMPADREOverview", codecap = "Plotting global locations of COMPADRE data availability at \\gimms resolution.", tidy = TRUE} -->
<!-- ``` -->

<!-- \clearpage -->

#### Study Regions

\footnotesize
```{r ref.label='StudRegFun', eval = FALSE, ref = "rStudRegFun", codecap = "Function for plotting data overviews in three-by-two plots for study regions.", tidy = TRUE}
```

\clearpage

\footnotesize
```{r ref.label='SRTRY', eval = FALSE, ref = "rSRTRY", codecap = "Function for plotting TRY data overviews in two-by-two plots for study regions.", tidy = TRUE}
```

\clearpage

### Vegetation Memory Models

\footnotesize
```{r ref.label='VegMemNDVI', eval = FALSE, ref = "rVegMemNDVI", codecap = "Plotting \\ndvi data treatment in two-by-two plots.", tidy = TRUE, tidy.opts=list(width.cutoff=50)}
```

\clearpage

\footnotesize
```{r ref.label='VegMemQsoil', eval = FALSE, ref = "rVegMemQsoil", codecap = "Plotting \\qsoil1 data treatment in two-by-two plots.", tidy = TRUE, tidy.opts=list(width.cutoff=50)}
```

\clearpage

### Results

#### Memory Models
\footnotesize
```{r ref.label='ModelRes', eval = FALSE, ref = "rModelRes", codecap = "Plotting vegetation memory model outputs.", tidy = TRUE}
```
\footnotesize
```{r ref.label='URes', eval = FALSE, ref = "rUresChunk", codecap = "Loading U-Test results of model coefficients and displaying as a table.", tidy = TRUE}
```

\clearpage

#### Variance Partitioning
\footnotesize
```{r ref.label='VarParRes', eval = FALSE, ref = "rVarParRes", codecap = "Plotting variance partitioning results.", tidy = TRUE}
```

\clearpage

#### Soil Layer Comparison
\footnotesize
```{r ref.label='SoilLayersRes', eval = FALSE, ref = "rSoilLayersRes", codecap = "Comparing soil layer memory coefficients.", tidy = TRUE}
```
\footnotesize
```{r ref.label='UQsoilRes', eval = FALSE, ref = "rUQsoilRes", codecap = "Loading U-Test results of soil layer comparison and displaying as a table.", tidy = TRUE}
```

\clearpage

#### Vegetation Memory Sensitivity
\footnotesize
```{r ref.label='PatCausRes', eval = FALSE, ref = "rPatCausRes", codecap = "Vegetation sensitivity plots.", tidy = TRUE}
```
\footnotesize
```{r ref.label='Patcaustab', eval = FALSE, ref = "rPatcaustab", codecap = "Linear regression coefficients of vegetation memory sensitivity.", tidy = TRUE}
```
<!-- \footnotesize -->
<!-- ```{r ref.label='PatCausAnova', eval = FALSE, ref = "rPatCausAnova", codecap = "ANOVAs of Qsoil layer and Memory length models.", tidy = TRUE} -->
<!-- ``` -->

\clearpage

### Plant Function

#### Life History Traits
\footnotesize
```{r ref.label='COMRes', eval = FALSE, ref = "rCOMRes", codecap = "Plotting COMPADRE data against vegetation memory coefficients.", tidy = TRUE}
```
\footnotesize
```{r ref.label='COMPADTab', eval = FALSE, ref = "rCOMPADTab", codecap = "Linear regression coefficients of COMPADRE data and vegetation memory coeffcients.", tidy = TRUE}
```

\clearpage

#### Plant Functional Traits
\footnotesize
```{r ref.label='TRYRes', eval = FALSE, ref = "rTRYRes", codecap = "Plotting TRY data against vegetation memory coefficients.", tidy = TRUE}
```
\footnotesize
```{r ref.label='TRYresTab', eval = FALSE, ref = "rTRYresTab", codecap = "Linear regression coefficients of TRY data and vegetation memory coeffcients.", tidy = TRUE}
```
<!-- \footnotesize -->
<!-- ```{r ref.label='PFTTab', eval = FALSE, ref = "rPFTTab", codecap = "Overview of linear regression coefficients of TRY data and vegetation memory coeffcients.", tidy = TRUE} -->
<!-- ``` -->

\clearpage

### Miscellaneous Figures
\footnotesize
```{r, code = readLines('3 - Figures/RFigures.R'), eval = FALSE, ref = "rFigs", codecap = "Producing miscellaneous figures used for flow charts and scheme overviews.", tidy = TRUE, cache.lazy=FALSE}
```


\clearpage

## Declaration Of Authorship  
\noindent\fbox{
    \parbox{\textwidth}{
I, Erik Kusch, hereby declare that this thesis and the work presented in it is entirely my own. Where I have consulted the work of others, this is always clearly stated.\\

\noindent \namesigdate{Erik Kusch}
    }

}